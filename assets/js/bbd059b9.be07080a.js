"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[66310],{47905:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>a,frontMatter:()=>d,metadata:()=>l,toc:()=>o});var t=s(74848),n=s(28453);const d={id:"backend-amqp-subscribe-to-delivery-response",title:"Monitor a delivery request progress",sidebar_label:"Subscribe to responses",slug:"/development/backend/services/delivery/guides/amqp/subscribe-to-delivery-responses"},i=void 0,l={id:"development/backend/regards/delivery/api-guides/amqp/backend-amqp-subscribe-to-delivery-response",title:"Monitor a delivery request progress",description:"This section describes how to subscribe to delivery response events with AMQP message.",source:"@site/versioned_docs/version-1.14/development/backend/regards/delivery/api-guides/amqp/amqp-subscribe-response.md",sourceDirName:"development/backend/regards/delivery/api-guides/amqp",slug:"/development/backend/services/delivery/guides/amqp/subscribe-to-delivery-responses",permalink:"/docs/1.14/development/backend/services/delivery/guides/amqp/subscribe-to-delivery-responses",draft:!1,unlisted:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/versioned_docs/version-1.14/development/backend/regards/delivery/api-guides/amqp/amqp-subscribe-response.md",tags:[],version:"1.14",frontMatter:{id:"backend-amqp-subscribe-to-delivery-response",title:"Monitor a delivery request progress",sidebar_label:"Subscribe to responses",slug:"/development/backend/services/delivery/guides/amqp/subscribe-to-delivery-responses"},sidebar:"dev",previous:{title:"Publish a request",permalink:"/docs/1.14/development/backend/services/delivery/guides/amqp/publish-a-delivery-request"},next:{title:"Configure settings",permalink:"/docs/1.14/development/backend/services/delivery/guides/rest/configure-settings"}},c={},o=[{value:"Exchange",id:"exchange",level:2},{value:"AMQP message format",id:"amqp-message-format",level:2},{value:"Headers",id:"headers",level:3},{value:"GRANTED body",id:"granted-body",level:3},{value:"DONE body",id:"done-body",level:3},{value:"DENIED body",id:"denied-body",level:3},{value:"ERROR body",id:"error-body",level:3}];function h(e){const r={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.p,{children:"This section describes how to subscribe to delivery response events with AMQP message."}),"\n",(0,t.jsx)(r.h2,{id:"exchange",children:"Exchange"}),"\n",(0,t.jsxs)(r.p,{children:["Subscribe to the following exchange to receive delivery responses on vhost ",(0,t.jsx)(r.code,{children:"regards.multitenant.manager"}),":",(0,t.jsx)(r.br,{}),"\n",(0,t.jsx)(r.code,{children:"regards.broadcast.fr.cnes.regards.modules.ltamanager.amqp.output.DeliveryResponseDtoEvent"})]}),"\n",(0,t.jsx)(r.admonition,{title:"Get delivery requests response",type:"info",children:(0,t.jsx)(r.p,{children:"The REGARDS administrator must create for you a dedicated queue bound to this exchange and allow your RabbitMQ user to\naccess to that queue. By doing so, it let you access to messages from that exchange."})}),"\n",(0,t.jsx)(r.h2,{id:"amqp-message-format",children:"AMQP message format"}),"\n",(0,t.jsx)(r.h3,{id:"headers",children:"Headers"}),"\n",(0,t.jsx)(r.p,{children:"Headers are the same for all type of responses."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n  "app_id": "xxx",\n  "timestamp": "xxx",\n  "correlation_id": "xxx",\n  "priority": xxx,\n  "delivery_mode": 2,\n  "content_encoding": "UTF-8",\n  "content_type": "application/json",\n  "headers": {\n    "regards.tenant": "xxx"\n  }\n}\n'})}),"\n",(0,t.jsx)(r.h3,{id:"granted-body",children:"GRANTED body"}),"\n",(0,t.jsx)(r.p,{children:"REGARDS publishes a granted notification when the delivery request is valid and ready to be processed."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n  "correlationId": "xxx",\n  "status": "GRANTED"\n}\n'})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{style:{textAlign:"center"},children:"Optional"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"correlationId"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Request identifier."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"status"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"The request is granted."})]})]})]}),"\n",(0,t.jsx)(r.h3,{id:"done-body",children:"DONE body"}),"\n",(0,t.jsx)(r.p,{children:"REGARDS publishes a done notification when the delivery has been processed successfully, i.e, the zip with files ordered\nhas been uploaded to the S3 server."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n  "correlationId": "xxx",\n  "status": "DONE",\n  "url": "xxx",\n  "md5": "xxx"\n}\n'})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{style:{textAlign:"center"},children:"Optional"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"correlationId"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Request identifier."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"status"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"The delivery request has been processed successfully."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"url"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"S3 formatted zip location (s3://bucket/correlationId/zipName.zip)."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"md5"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Zip checksum in MD5 format."})]})]})]}),"\n",(0,t.jsx)(r.h3,{id:"denied-body",children:"DENIED body"}),"\n",(0,t.jsx)(r.p,{children:"REGARDS publishes a denied notification when the request is not valid."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n  "correlationId": "xxx",\n  "status": "DENIED",\n  "message": "xxx",\n  "errorType": "xxx"\n}\n'})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{style:{textAlign:"center"},children:"Optional"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"correlationId"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Request identifier."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"status"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"The request cannot be processed."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"message"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(r.td,{children:"Description of the error."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"errorType"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Associated error code."})]})]})]}),"\n",(0,t.jsx)(r.p,{children:"A request can be invalid, if the delivery request is not well-formed."}),"\n",(0,t.jsx)(r.admonition,{title:"How to handle it?",type:"info",children:(0,t.jsxs)(r.p,{children:["See the ",(0,t.jsx)(r.a,{href:"/docs/1.14/development/backend/services/delivery/guides/amqp/publish-a-delivery-request",children:"request format"}),", fix your payload and submit a new request."]})}),"\n",(0,t.jsx)(r.h3,{id:"error-body",children:"ERROR body"}),"\n",(0,t.jsx)(r.p,{children:"After request has been granted by REGARDS, internal errors may occur. In such case, an error response will be published\non the response exchange."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n  "correlationId": "xxx",\n  "status": "ERROR",\n  "message": "xxx",\n  "errorType": "xxx"\n}\n'})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{style:{textAlign:"center"},children:"Optional"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"correlationId"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Request identifier."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"status"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"The request cannot be processed."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"message"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(r.td,{children:"Description of the error."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"errorType"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Associated error code."})]})]})]}),"\n",(0,t.jsx)(r.p,{children:"There are several error types:"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Error Type"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"INVALID_CONTENT"}),(0,t.jsx)(r.td,{children:"The delivery request is malformed."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"FORBIDDEN"}),(0,t.jsx)(r.td,{children:"The provided user is not allowed to access delivery features."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"ORDER_LIMIT_REACHED"}),(0,t.jsx)(r.td,{children:"The order requested is too big and cannot be performed."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"TOO_MANY_SUBORDERS"}),(0,t.jsx)(r.td,{children:"The order returns more than one sub-order for a given delivery request. Only one sub-order is allowed for now."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"EMPTY_ORDER"}),(0,t.jsx)(r.td,{children:"The order requested contains no data to order."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"EXPIRED"}),(0,t.jsx)(r.td,{children:"The delivery request has expired."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"INTERNAL_ERROR"}),(0,t.jsx)(r.td,{children:"An internal error occurred during the processing of the order."})]})]})]}),"\n",(0,t.jsx)(r.admonition,{title:"How to handle it?",type:"info",children:(0,t.jsx)(r.p,{children:"Retry later with a new request or contact REGARDS administrators."})})]})}function a(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},28453:(e,r,s)=>{s.d(r,{R:()=>i,x:()=>l});var t=s(96540);const n={},d=t.createContext(n);function i(e){const r=t.useContext(d);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),t.createElement(d.Provider,{value:r},e.children)}}}]);