"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[83598],{76990:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>c});var t=n(74848),s=n(28453);const i={id:"backend-downloader-conception",title:"REGARDS storage microservice",sidebar_label:"How it works",sidebar_position:2,slug:"/development/services/downloader/conception/"},r=void 0,d={id:"development/services/downloader/backend-downloader-conception",title:"REGARDS storage microservice",description:"Introduction",source:"@site/docs/development/services/downloader/conception.md",sourceDirName:"development/services/downloader",slug:"/development/services/downloader/conception/",permalink:"/docs/next/development/services/downloader/conception/",draft:!1,unlisted:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/docs/development/services/downloader/conception.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"backend-downloader-conception",title:"REGARDS storage microservice",sidebar_label:"How it works",sidebar_position:2,slug:"/development/services/downloader/conception/"},sidebar:"dev",previous:{title:"Overview",permalink:"/docs/next/development/backend/services/downloader/overview/"},next:{title:"All endpoints (OpenAPI)",permalink:"/docs/next/development/backend/services/downloader/api-swagger"}},a={},c=[{value:"Introduction",id:"introduction",level:2},{value:"How to download a file",id:"how-to-download-a-file",level:2}];function l(e){const o={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsxs)(o.p,{children:["The Downloader microservice is developed using exactly the ",(0,t.jsx)(o.a,{href:"https://github.com/RegardsOss/regards-backend/tree/master/rs-storage",children:"same source code"})," as the Storage microservice."]}),"\n",(0,t.jsx)(o.admonition,{type:"warning",children:(0,t.jsxs)(o.p,{children:["Contrary to other micro-services, Downloader does not use its own schema and database: it uses the same ones as the\nStorage microservice. This means that there is not specific\n",(0,t.jsx)(o.a,{href:"/docs/next/development/services/admin-instance/conception/#module--project-instance",children:"project connection"})," for it."]})}),"\n",(0,t.jsxs)(o.p,{children:["The difference between the two microservices lies in the activation or non-activation of a ",(0,t.jsx)(o.strong,{children:"downloader"})," profile."]}),"\n",(0,t.jsx)(o.p,{children:"The \u201cdownloader\u201d profile enables you to disable all Storage service functions that are not dedicated to downloading."}),"\n",(0,t.jsxs)(o.p,{children:["For example, in the ",(0,t.jsx)(o.a,{href:"https://github.com/RegardsOss/regards-backend/blob/775a8fa39e12333446dde7703c04d892ff52554d/rs-storage/storage/storage-rest/src/main/java/fr/cnes/regards/modules/storage/rest/FileReferenceController.java#L78",children:"FileReferenceController"})," controller, the annotation below indicates that this REST controller is not active, and therefore the functionality is not enabled in the service."]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-java",children:'@Profile({ "!downloader" })\n@RestController\n@RequestMapping(FileReferenceController.FILE_PATH)\npublic class FileReferenceController {\n   ...\n}\n'})}),"\n",(0,t.jsxs)(o.p,{children:["The downloader profile is enabled in the ",(0,t.jsx)(o.strong,{children:"boostrap-downloader"})," module, which represents the main module of the spring-boot downloader service."]}),"\n",(0,t.jsx)(o.p,{children:"This profile is simply not enabled in the boostrap-storage module, which represents the main module of the spring-boot storage service."}),"\n",(0,t.jsx)(o.h2,{id:"how-to-download-a-file",children:"How to download a file"}),"\n",(0,t.jsxs)(o.p,{children:["The microservice downloader offers a single functional endpoint: ",(0,t.jsx)(o.strong,{children:"downloading a file"}),"."]}),"\n",(0,t.jsx)(o.p,{children:"Download scalability therefore depends solely on the size of the Jetty application server thread pool."}),"\n",(0,t.jsxs)(o.p,{children:["By default, the size of this pool is set to ",(0,t.jsx)(o.strong,{children:"200"})," in deployment inventories."]}),"\n",(0,t.jsxs)(o.p,{children:["If you want to be able to do more downloads in parallel, you can deploy more instances of the service or increase the size of the pool as indicated in the ",(0,t.jsx)(o.a,{href:"/docs/next/setup/swarm/advanced/microservice-setup#scale-up-microservices",children:"installation manual"}),"."]}),"\n",(0,t.jsx)(o.p,{children:"To download files, this service only requires the unique key of the file to be downloaded, i.e. the file checksum."}),"\n",(0,t.jsx)(o.p,{children:"Using this checksum, the service queries the database to retrieve the storage space where the file is located."}),"\n",(0,t.jsx)(o.p,{children:"If the file is located on more than one storage space, the hot storage with the highest priority is selected first. If there is no hot storage, then the cold storage with the highest priority is selected."}),"\n",(0,t.jsx)(o.p,{children:"Once the file storage space has been determined, the associated plugin is instantiated and the file upload interface is called."}),"\n",(0,t.jsx)(o.p,{children:"As a reminder, the plugins used by the downloder service are the same as those used by the storage service. They are shared by both services on the same disk space during deployment."}),"\n",(0,t.jsxs)(o.p,{children:["The downloader service plugins can be consulted via the ",(0,t.jsx)(o.a,{href:"/docs/next/development/services/storage/plugins/overview",children:"storage service plugins description page"}),"."]})]})}function h(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,o,n)=>{n.d(o,{R:()=>r,x:()=>d});var t=n(96540);const s={},i=t.createContext(s);function r(e){const o=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function d(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(i.Provider,{value:o},e.children)}}}]);