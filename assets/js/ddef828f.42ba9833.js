"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[40842],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=d(n),m=r,f=u["".concat(l,".").concat(m)]||u[m]||p[m]||o;return n?a.createElement(f,s(s({ref:t},c),{},{components:n})):a.createElement(f,s({ref:t},c))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[u]="string"==typeof e?e:r,s[1]=i;for(var d=2;d<o;d++)s[d]=n[d];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},55534:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var a=n(87462),r=(n(67294),n(3905));const o={id:"backend-framework-starters-jpa-multitenant",title:"JPA multitenant starter",slug:"/development/backend/framework/starters/jpa-multitenant/"},s="1. Configuration",i={unversionedId:"development/backend/framework/starters/backend-framework-starters-jpa-multitenant",id:"development/backend/framework/starters/backend-framework-starters-jpa-multitenant",title:"JPA multitenant starter",description:"Add starter dependency to your POM (version depends on the REGARDS BOM)",source:"@site/docs/development/backend/framework/starters/jpa-multitenant-starter.md",sourceDirName:"development/backend/framework/starters",slug:"/development/backend/framework/starters/jpa-multitenant/",permalink:"/docs/next/development/backend/framework/starters/jpa-multitenant/",draft:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/docs/development/backend/framework/starters/jpa-multitenant-starter.md",tags:[],version:"current",frontMatter:{id:"backend-framework-starters-jpa-multitenant",title:"JPA multitenant starter",slug:"/development/backend/framework/starters/jpa-multitenant/"},sidebar:"dev",previous:{title:"JPA instance starter",permalink:"/docs/next/development/backend/framework/starters/jpa-instance/"},next:{title:"Microservice core starter",permalink:"/docs/next/development/backend/framework/starters/microservice-core/"}},l={},d=[{value:"3.1. How to manage repository by tenant",id:"31-how-to-manage-repository-by-tenant",level:2},{value:"3.2. How to avoid transaction manager conflict",id:"32-how-to-avoid-transaction-manager-conflict",level:2},{value:"3.3. How to test datasource",id:"33-how-to-test-datasource",level:2}],c={toc:d},u="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"1-configuration"},"1","."," Configuration"),(0,r.kt)("p",null,"Add starter dependency to your POM (version depends on the REGARDS BOM)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n  <groupId>fr.cnes.regards.framework</groupId>\n  <artifactId>jpa-multitenant-starter</artifactId>\n</dependency>\n")),(0,r.kt)("p",null,"Dependency :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/next/development/backend/framework/starters/multitenant/"},"Multitenant starter")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/next/development/backend/framework/starters/amqp/"},"AMQP starter"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"regards.jpa.multitenant.enabled=true # Disable JPA multitenant support\nregards.jpa.multitenant.embedded=false # Activate embedded mode with HSQLDB\nregards.jpa.multitenant.embeddedPath= # Path for embedded databases files if enabled\nregards.jpa.multitenant.dialect=org.hibernate.dialect.PostgreSQLDialect # Not mandatory if embedded mode is activated\nregards.jpa.multitenant.tenants[<x>].tenant=\nregards.jpa.multitenant.tenants[<x>].url= # Not mandatory if embedded mode is activated (e.g. jdbc:postgresql://localhost:5432/test1)\nregards.jpa.multitenant.tenants[<x>].userName= # Not mandatory if embedded mode is activated\nregards.jpa.multitenant.tenants[<x>].password= # Not mandatory if embedded mode is activated\nregards.jpa.multitenant.tenants[<x>].driverClassName=org.postgresql.Driver # Not mandatory if embedded mode is activated\n\n<x> : Integer value for tenant index starting with 0.\n")),(0,r.kt)("h1",{id:"2-autoconfiguration"},"2","."," Autoconfiguration"),(0,r.kt)("p",null,"Starter :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"manages all tenant connections for the current microservice,")),(0,r.kt)("p",null,"Following endpoints are supplied to monitor datasources :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"/regards/{tenant}/datasource/test")," to test tenant datasource,"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"/regards/{tenant}/datasource/status")," to check in production datasource status (pooled connections).")),(0,r.kt)("h1",{id:"3-how-to"},"3","."," How to"),(0,r.kt)("h2",{id:"31-how-to-manage-repository-by-tenant"},"3.1. How to manage repository by tenant"),(0,r.kt)("p",null,"JPA repositories have no specifities in your source code. Starter purpose is only to route request to the right datasource."),(0,r.kt)("p",null,"To do so, multitenant router use ",(0,r.kt)("inlineCode",{parentName:"p"},"IRuntimeTenantResolver")," from ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/development/backend/framework/starters/multitenant/"},"Multitenant starter")," transparently."),(0,r.kt)("h2",{id:"32-how-to-avoid-transaction-manager-conflict"},"3.2. How to avoid transaction manager conflict"),(0,r.kt)("p",null,"You can annotated your service or test with the following meta annotation to manage transaction if multiple managers exist else you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"RegardsTransactional"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@MultitenantTransactional\n")),(0,r.kt)("h2",{id:"33-how-to-test-datasource"},"3.3. How to test datasource"),(0,r.kt)("p",null,"TODO explain test module"))}p.isMDXComponent=!0}}]);