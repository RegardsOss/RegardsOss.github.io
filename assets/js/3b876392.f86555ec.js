"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[18455],{51059:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>d,toc:()=>a});var i=s(74848),t=s(28453);const r={title:"How it Works",sidebar_label:"How it works",sidebar_position:2,slug:"/development/backend/services/fem/conception"},o=void 0,d={id:"development/services/fem/conception",title:"How it Works",description:"Introduction",source:"@site/versioned_docs/version-2.0.0/development/services/fem/conception.md",sourceDirName:"development/services/fem",slug:"/development/backend/services/fem/conception",permalink:"/docs/development/backend/services/fem/conception",draft:!1,unlisted:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/versioned_docs/version-2.0.0/development/services/fem/conception.md",tags:[],version:"2.0.0",sidebarPosition:2,frontMatter:{title:"How it Works",sidebar_label:"How it works",sidebar_position:2,slug:"/development/backend/services/fem/conception"},sidebar:"dev",previous:{title:"Overview",permalink:"/docs/development/backend/services/fem/overview/"},next:{title:"Create product",permalink:"/docs/development/backend/services/fem/guides/amqp/publish-a-creation-request-event"}},c={},a=[{value:"Introduction",id:"introduction",level:2},{value:"Request priority",id:"request-priority",level:2},{value:"Products metadata validation",id:"products-metadata-validation",level:2},{value:"Products versioning",id:"products-versioning",level:2},{value:"Product Associated files",id:"product-associated-files",level:2},{value:"Creation",id:"creation",level:3},{value:"Update",id:"update",level:3},{value:"Products dissemination",id:"products-dissemination",level:2},{value:"How to ?",id:"how-to-",level:3},{value:"Products notification format",id:"products-notification-format",level:3},{value:"Products dissemination acknowledgement",id:"products-dissemination-acknowledgement",level:2},{value:"Delaying the processing of requests",id:"delaying-the-processing-of-requests",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(n.p,{children:["Products creation requests can be submitted as ",(0,i.jsx)(n.strong,{children:"Features"})," with ",(0,i.jsx)(n.strong,{children:"GeoJSON"})," formatted requests\nthrough ",(0,i.jsx)(n.a,{href:"./guides/amqp/publish-a-creation-request-event",children:"AMQP API"})," or\n",(0,i.jsx)(n.a,{href:"./guides/rest/create-product",children:"REST API"})," to ",(0,i.jsx)(n.code,{children:"rs-fem"})," microservice."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"AMQP API is strongly recommended to increase service performances when a big amount of requests is sent."})}),"\n",(0,i.jsxs)(n.p,{children:["When a ",(0,i.jsx)(n.strong,{children:"Feature request"})," is received (AMQP or REST API), the request is saved in the microservice database and will be\nprocessed by ",(0,i.jsx)(n.strong,{children:"schedulers"})," and ",(0,i.jsx)(n.strong,{children:"Jobs"})," as described\nin the ",(0,i.jsx)(n.a,{href:"../../../concepts/scalability",children:"global architecture overview"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"The diagram below explains how a product creation request is processed."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(70503).A+"",width:"901",height:"680"})}),"\n",(0,i.jsx)(n.p,{children:"Throughout the processing of a request in the service, the status of the request changes.\nThe diagram below shows the possible states and the transitions between them."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(43440).A+"",width:"1002",height:"954"})}),"\n",(0,i.jsx)(n.h2,{id:"request-priority",children:"Request priority"}),"\n",(0,i.jsxs)(n.p,{children:["When submitting a request to create, modify, delete or notify products, you can specify the priority of your request.\nThere are three priorities: ",(0,i.jsx)(n.strong,{children:"HIGH"}),", ",(0,i.jsx)(n.strong,{children:"NORMAL"})," and ",(0,i.jsx)(n.strong,{children:"LOW"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Giving your request a high priority ensures that it will be processed by the service before requests with lower\npriorities."}),"\n",(0,i.jsx)(n.h2,{id:"products-metadata-validation",children:"Products metadata validation"}),"\n",(0,i.jsxs)(n.p,{children:["Submitted Feature requests ",(0,i.jsx)(n.strong,{children:"must"})," provide an associated ",(0,i.jsx)(n.strong,{children:"Data Model"})," in their metadata section.\nTo validate this model, ",(0,i.jsx)(n.code,{children:"rs-fem"})," microservice keeps a cache of Data Models retrieved from the ",(0,i.jsx)(n.code,{children:"rs-dam"}),"\nmicroservice."]}),"\n",(0,i.jsxs)(n.p,{children:["Model validation checks for attributes in ",(0,i.jsx)(n.strong,{children:"properties.descriptiveInformation"})," section of the SIP. They have to be\ncompliant with attributes defined in the given ",(0,i.jsx)(n.strong,{children:"Data Model"}),". Validation checks for:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mandatory"})," attributes,"]}),"\n",(0,i.jsxs)(n.li,{children:["Attributes ",(0,i.jsx)(n.strong,{children:"values types"})]}),"\n",(0,i.jsxs)(n.li,{children:["Attributes ",(0,i.jsx)(n.strong,{children:"values restrictions"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Attributes of the data model are validated with ",(0,i.jsx)(n.strong,{children:"case sensitive"})," on attributes labels."]}),"\n",(0,i.jsx)(n.h2,{id:"products-versioning",children:"Products versioning"}),"\n",(0,i.jsxs)(n.p,{children:["To understand versioning, you must be familiar with the two different identifiers of a feature in the ",(0,i.jsx)(n.code,{children:"rs-fem"})," service."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Provider identifier (or ",(0,i.jsx)(n.code,{children:"providerId"}),") : Is an arbitrary identifier provided by the feature creator owner.\nIt is not a unique identifier for the service, but is used to handle product versioning."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"U"}),"niform ",(0,i.jsx)(n.strong,{children:"R"}),"esource ",(0,i.jsx)(n.strong,{children:"N"}),"ame (or ",(0,i.jsx)(n.code,{children:"urn"}),") : Is the ",(0,i.jsx)(n.strong,{children:"unique identifier"})," of a feature."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"rs-fem"})," representation of URN is\nURN:",(0,i.jsx)(n.strong,{children:"FEATURE"}),":",(0,i.jsx)(n.code,{children:"<type\\>"}),":",(0,i.jsx)(n.code,{children:"<tenant\\>"}),":",(0,i.jsx)(n.code,{children:"<uuid\\>"}),":V",(0,i.jsx)(n.code,{children:"<version\\>"})," with :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"type"})," : ",(0,i.jsx)(n.code,{children:"DATA"}),", ",(0,i.jsx)(n.code,{children:"DATASET"})," or ",(0,i.jsx)(n.code,{children:"COLLECTION"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"tenant"}),": ",(0,i.jsx)(n.a,{href:"/docs/development/concepts/multitenant/",children:"tenant or project"})," in which the product is created."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"uid"}),": Universally unique identifier. Generated from the feature given ",(0,i.jsx)(n.strong,{children:"providerId"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"version"})," : entity version"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",metastring:"title='Feature URN example'",children:'"urn":"URN:FEATURE:DATA:project1:c6487db8-9955-3917-a7e2-0374ccde903c:V1"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["When updating a Feature with a request, the ",(0,i.jsx)(n.code,{children:"rs-fem"})," microservice may deal with Feature versioning."]}),"\n",(0,i.jsx)(n.p,{children:"There are several possibilities to update a request, leading to different versioning policies:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If a ",(0,i.jsx)(n.strong,{children:"Patch request"})," is used with an existing feature ",(0,i.jsx)(n.strong,{children:"urn"}),", the product is simply updated, its version\nis not incremented. To learn more on how to patch a product see\n",(0,i.jsx)(n.a,{href:"/docs/development/backend/services/fem/guides/amqp/publish-a-patch-request",children:"AMQP Guide"})," or\n",(0,i.jsx)(n.a,{href:"/docs/development/backend/services/fem/guides/rest/patch-product",children:"REST Guide"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["If a ",(0,i.jsx)(n.strong,{children:"Creation request"})," is used with the same ",(0,i.jsx)(n.strong,{children:"providerId"})," as an existing one, then a new feature is created with\nan incremented version number. If the ",(0,i.jsx)(n.strong,{children:"override"})," parameter in the request metadata is set to ",(0,i.jsx)(n.code,{children:"true"}),", then\nthe old versioned feature is deleted after the new one creation success. To learn more on how to create a product see\n",(0,i.jsx)(n.a,{href:"/docs/development/backend/services/fem/guides/amqp/publish-a-creation-request-event",children:"AMQP Guide"})," or\n",(0,i.jsx)(n.a,{href:"/docs/development/backend/services/fem/guides/rest/create-product",children:"REST Guide"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["If a ",(0,i.jsx)(n.strong,{children:"Creation request"})," is used with the same ",(0,i.jsx)(n.strong,{children:"providerId"})," and ",(0,i.jsx)(n.strong,{children:"urn"})," as an existing one , it means that a\nfeature with the same version already exists. Then, we need to check the ",(0,i.jsx)(n.strong,{children:"updateIfExists"})," parameter in the request\nmetadata :","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If it is set to ",(0,i.jsx)(n.code,{children:"true"}),", then the ",(0,i.jsx)(n.strong,{children:"feature is updated"}),", like a patch request."]}),"\n",(0,i.jsxs)(n.li,{children:["Otherwise, an ",(0,i.jsx)(n.strong,{children:"error is raised"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Mainly, there is two ways to handle versioning in ",(0,i.jsx)(n.strong,{children:"rs-fem"})," service :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Let the service manage the versioning and only provide the ",(0,i.jsx)(n.strong,{children:"provider identifier"})," (providerId)"]}),"\n",(0,i.jsxs)(n.li,{children:["Manually handle product versioning by providing unique ",(0,i.jsx)(n.strong,{children:"urn"})," in the request metadata."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"product-associated-files",children:"Product Associated files"}),"\n",(0,i.jsx)(n.h3,{id:"creation",children:"Creation"}),"\n",(0,i.jsxs)(n.p,{children:["When you ask the ",(0,i.jsx)(n.code,{children:"rs-fem"})," microservice to create a new ",(0,i.jsx)(n.a,{href:"/docs/development/concepts/products/",children:"product"}),",\nyou can choose between two methods to handle associated files:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Storage"})," : You want Regards system to move associated files to one or many configured storage locations."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reference"})," : You want Regards system to reference associated files with there current location and without moving\nthem."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["In both case, the product associated files wil be added in the ",(0,i.jsx)(n.code,{children:"rs-storage"})," microservice file referential.\nIf your product contains associated files, it will not be fully created until the storage service has correctly\nprocessed the files and added them to its repository."]}),"\n",(0,i.jsxs)(n.p,{children:["To know how to select file management in a creation request see\n",(0,i.jsx)(n.a,{href:"/docs/development/backend/services/fem/guides/amqp/publish-a-creation-request-event",children:"AMQP Guide"})," or\n",(0,i.jsx)(n.a,{href:"/docs/development/backend/services/fem/guides/rest/create-product",children:"REST Guide"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Like product metadata, the files associated with a product can be modified. To know how to modify product files see\n",(0,i.jsx)(n.a,{href:"/docs/development/backend/services/fem/guides/amqp/publish-a-patch-request",children:"AMQP Guide"})," or\n",(0,i.jsx)(n.a,{href:"/docs/development/backend/services/fem/guides/rest/patch-product",children:"REST Guide"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"update",children:"Update"}),"\n",(0,i.jsxs)(n.p,{children:["When you request a product update and specify associated files, by default the service will add these files to the\nexisting ones. However, if you use the ",(0,i.jsx)(n.a,{href:"/docs/development/backend/services/fem/guides/amqp/publish-a-patch-request",children:"AMQP API"}),",\nyou can specify the file update mode. The available modes are :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"REPLACE"}),": Deletes existing files and adds new ones."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"APPEND"}),": Adds the supplied files to the existing files."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"products-dissemination",children:"Products dissemination"}),"\n",(0,i.jsx)(n.h3,{id:"how-to-",children:"How to ?"}),"\n",(0,i.jsxs)(n.p,{children:["If the ",(0,i.jsx)(n.code,{children:"rs-fem"})," microservice is configured to notify external components, each created/modified/deleted\nfeature is sent to the ",(0,i.jsx)(n.code,{children:"rs-notifier"})," microservice for notification to external components."]}),"\n",(0,i.jsx)(n.p,{children:"To notify external systems you need to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Activate automatic notifications of products in the\n",(0,i.jsx)(n.a,{href:"/docs/user-guide/import-data/fem/manage-features-settings/",children:"Feature manager configuration"})]}),"\n",(0,i.jsxs)(n.li,{children:["Configure the wanted recipient(s) of the notifications in the\n",(0,i.jsx)(n.a,{href:"/docs/development/backend/services/notifier/overview/",children:"Notification service configuration"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Nevertheless, if automatic notifications is not activated, you can manually notify selected features through\n",(0,i.jsx)(n.a,{href:"/docs/user-guide/import-data/fem/manage-features/#les-actions",children:"admin UI"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["When a notification is sent to a recipient by the ",(0,i.jsx)(n.code,{children:"rs-notifier"})," service, the dissemination information of the feature is\nupdated by the ",(0,i.jsx)(n.code,{children:"rs-fem"})," microservice with the following parameters:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"recipient label"}),": Name of the notification's recipient (as configured in ",(0,i.jsx)(n.code,{children:"rs-notifier"})," service)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"dissemination date"}),": Date of the notification"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"acknowledge date"}),": Date of received acknowledgement. If the recipient is not configured to send acknowledgements,\nthis date is the same as the dissemination date. If the recipient is configured to send acknowledgements, this\ndate is the date on which the acknowledgement is received. This acknowledgement parameter is configured in the\n",(0,i.jsx)(n.code,{children:"rs-notifier"})," service for each recipient."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"With this information, Regards administrators can see through administrator UI all recipients of features\nnotifications."}),"\n",(0,i.jsx)(n.h3,{id:"products-notification-format",children:"Products notification format"}),"\n",(0,i.jsxs)(n.p,{children:["To understand how ",(0,i.jsx)(n.code,{children:"rs-notifier"})," can handle product notifications received from the ",(0,i.jsx)(n.code,{children:"rs-fem"})," microservice, here is the\nformat of each product notification between ",(0,i.jsx)(n.code,{children:"rs-fem"})," and ",(0,i.jsx)(n.code,{children:"rs-notifier"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "metadata": {\n    "action": "",\n    "sessionOwner": "",\n    "session": ""\n  },\n  "payload": {\n    "type": "Feature",\n    "urn": "",\n    "entityType": "",\n    "model": "",\n    "last": false,\n    "history": {\n      "createdBy": "",\n      "updatedBy": "",\n      "deletedBy": ""\n    },\n    "geometry": {},\n    "bbox": [],\n    "crs": "",\n    "files": [],\n    "properties": {}\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"payload section"})," contains the product that has been notified and the ",(0,i.jsx)(n.strong,{children:"metadata section"})," contains the following\ninformation:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"action"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String"})}),(0,i.jsxs)(n.td,{children:["Indicates the action on the product that triggered the notification.",(0,i.jsx)("br",{})," Possible values are",(0,i.jsx)(n.code,{children:"CREATED"}),", ",(0,i.jsx)(n.code,{children:"UPDATED"}),", ",(0,i.jsx)(n.code,{children:"DELETED"}),", ",(0,i.jsx)(n.code,{children:"ALREADY_DELETED"}),", ",(0,i.jsx)(n.code,{children:"NOTIFIED"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sessionOwner"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String"})}),(0,i.jsx)(n.td,{children:"Session Owner that created the product"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"session"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String"})}),(0,i.jsx)(n.td,{children:"Session in which the product was created"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["You can then use this information (metadata and payload sections) to configure the\n",(0,i.jsx)(n.a,{href:"/docs/development/backend/services/notifier/overview/",children:"rs-notifier service"})," to send the feature to the required recipients."]}),"\n",(0,i.jsx)(n.h2,{id:"products-dissemination-acknowledgement",children:"Products dissemination acknowledgement"}),"\n",(0,i.jsxs)(n.p,{children:["External systems who subscribe to Feature notifications from the ",(0,i.jsx)(n.code,{children:"rs-fem"})," service can send back an acknowledgement to\ninform that the notification has been successfully handled. To do so, refer\nto ",(0,i.jsx)(n.a,{href:"/docs/development/backend/services/fem/guides/amqp/publish-acknowledge-request",children:"Feature notification acknowledgement guide"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"With this system, Regards administrators can validate through administrator UI that notifications has been successfully\nhandled by recipients."}),"\n",(0,i.jsx)(n.h2,{id:"delaying-the-processing-of-requests",children:"Delaying the processing of requests"}),"\n",(0,i.jsxs)(n.p,{children:["When you submit a product request to the ",(0,i.jsx)(n.code,{children:"rs-fem"})," microservice, you can ask for them to be processed at\na later date. To do this, you need to specify the date on which you want the treatment to be carried out."]}),"\n",(0,i.jsx)(n.p,{children:"Please refer to the various API guides to find out how to specify this date in your requests."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},70503:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/conception-fce6d0849b409fb68d88a227bd7e09ec.png"},43440:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/request_steps_diagram-616e6a51d1c37419dcde87547916b143.png"},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>d});var i=s(96540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);