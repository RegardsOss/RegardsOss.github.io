"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[36466],{39667:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>o,toc:()=>l});var t=s(74848),n=s(28453);const d={id:"backend-create-order-amqp",title:"Create Order",sidebar_label:"Create Order",sidebar_position:1,slug:"/development/backend/services/order/guides/create-order-amqp"},i=void 0,o={id:"development/services/order/api-guides/amqp/backend-create-order-amqp",title:"Create Order",description:"This guide describes how to order one or many products from the order service through AMQP interface.",source:"@site/docs/development/services/order/api-guides/amqp/amqp-create-order.md",sourceDirName:"development/services/order/api-guides/amqp",slug:"/development/backend/services/order/guides/create-order-amqp",permalink:"/docs/development/backend/services/order/guides/create-order-amqp",draft:!1,unlisted:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/docs/development/services/order/api-guides/amqp/amqp-create-order.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"backend-create-order-amqp",title:"Create Order",sidebar_label:"Create Order",sidebar_position:1,slug:"/development/backend/services/order/guides/create-order-amqp"},sidebar:"dev",previous:{title:"How it works",permalink:"/docs/development/backend/services/order/architecture/"},next:{title:"Get Order progress",permalink:"/docs/development/backend/services/order/guides/get-order-progress-amqp"}},c={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Submit Order request",id:"submit-order-request",level:2},{value:"Exchange",id:"exchange",level:3},{value:"Order request format",id:"order-request-format",level:3},{value:"Order request examples",id:"order-request-examples",level:3}];function a(e){const r={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.p,{children:"This guide describes how to order one or many products from the order service through AMQP interface."}),"\n",(0,t.jsx)(r.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsx)(r.p,{children:"The diagram below explains the global processing of an order request by REGARDS system.\nFor a REGARDS client using message queuing, the main steps are :"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Publish your product order request to REGARDS Rabbitmq server."}),"\n",(0,t.jsxs)(r.li,{children:["Wait for notifications from REGARDS on its Rabbitmq server. Request status lifecycles can be :","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"DENIED"})}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"GRANTED"})," -> ",(0,t.jsx)(r.code,{children:"SUBORDER_DONE"})," (occurs 0 to many times) -> ",(0,t.jsx)(r.code,{children:"FAILED"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"GRANTED"})," -> ",(0,t.jsx)(r.code,{children:"SUBORDER_DONE"})," (occurs 1 to many times) -> ",(0,t.jsx)(r.code,{children:"DONE"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["Download order archive everytime you receive a ",(0,t.jsx)(r.code,{children:"SUBORDER_DONE"})," or ",(0,t.jsx)(r.code,{children:"DONE"})," message. ",(0,t.jsx)(r.code,{children:"SUBORDER_DONE"})," and ",(0,t.jsx)(r.code,{children:"DONE"})," contains the URL to the ",(0,t.jsx)(r.a,{href:"./download-ordered-files",children:"Download ordered files"})," REST API to download all available files related to an order."]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"sequence",src:s(65639).A+"",width:"628",height:"809"})}),"\n",(0,t.jsx)(r.h2,{id:"submit-order-request",children:"Submit Order request"}),"\n",(0,t.jsx)(r.h3,{id:"exchange",children:"Exchange"}),"\n",(0,t.jsxs)(r.p,{children:["Exchange to submit Order requests:",(0,t.jsx)(r.br,{}),"\n",(0,t.jsx)(r.code,{children:"regards.broadcast.fr.cnes.regards.modules.order.amqp.input.OrderRequestDtoEvent"})]}),"\n",(0,t.jsx)(r.h3,{id:"order-request-format",children:"Order request format"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"Message headers"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'"regards.tenant": "tenant"\n'})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{style:{textAlign:"center"},children:"Optional"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsx)(r.tbody,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"regards.tenant"})}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Tenant name depends on REGARDS instance project configuration"})]})})]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"Message body content"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n    "correlationId": "xxx",\n    "queries": [],\n    "user" : "",\n    "sizeLimitInBytes": "xx",\n    "filters": {\n        "dataTypes": [],\n        "filenameRegExp" : "",\n    }\n}\n'})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{style:{textAlign:"center"},children:"Optional"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"correlationId"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"The request correlation id."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"queries"}),(0,t.jsx)(r.td,{children:"Lucene strings"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"List of lucene formatted queries to find products to order."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"user"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Email of your REGARDS user."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"sizeLimitInBytes"}),(0,t.jsx)(r.td,{children:"Long"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(r.td,{children:"Number to limit the size of the files ordered at once, in bytes."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"filters.datatypes"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsxs)(r.td,{children:["List of REGARDS datatypes to filter files from orderd products. Datatypes can be ",(0,t.jsx)(r.code,{children:"RAWDATA"})," or ",(0,t.jsx)(r.code,{children:"QUICKLOOK"})]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"filters.filenameRegExp"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(r.td,{children:"Regular expression to filter files by their names from orderd products."})]})]})]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"NOTE"}),": Here is the link to the ",(0,t.jsx)(r.a,{href:"/docs/development/appendices/lucene-query/",children:"REGARDS Lucene format"})]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"NOTE"}),": A REGARDS user is mandatory to order products. Your user must be activated and remaining download quota must allow you to order."]}),"\n",(0,t.jsx)(r.h3,{id:"order-request-examples",children:"Order request examples"}),"\n",(0,t.jsx)(r.p,{children:"If you want to retrieve a product by its identifier, the order request is :"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n    "queries": [\n        "productId:my_product_identifier"\n    ],\n    "user" : "myself@cnes.fr"\n}\n'})}),"\n",(0,t.jsx)(r.p,{children:"If you want to retrieve many products using their identifiers, the order request is :"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n    "queries": [\n        "productId:(my_product_id_1 OR my_product_id_2 OR my_product_id_3 OR my_product_id_4)"\n    ],\n    "user" : "myself@cnes.fr"\n}\n'})}),"\n",(0,t.jsx)(r.p,{children:"If you want to retrieve all products from a specific metadata like datatype (depends on configured REGARDS data models), the restoration request is:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n    "queries": [\n        "datatype:type1"\n    ],\n    "user" : "myself@cnes.fr"\n}\n'})}),"\n",(0,t.jsx)(r.p,{children:"If you want to retrieve all products from a specific metadata like datatype (depends on configured REGARDS data models) and retrieve only image files, the restoration request is:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n    "queries": [\n        "datatype:type1"\n    ],\n    "user" : "myself@cnes.fr",\n    "filters": {\n        "dataTypes": [\n            "QUICKLOOK"\n        ],\n    }\n}\n'})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Click on the link Get Order progress AMQP"})," just below, you will discover responses RS-ORDER will send you for your order."]})]})}function h(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},65639:(e,r,s)=>{s.d(r,{A:()=>t});const t=s.p+"assets/images/restitution-sequence-3.0-1559380f24220259a098114a4df5aabe.png"},28453:(e,r,s)=>{s.d(r,{R:()=>i,x:()=>o});var t=s(96540);const n={},d=t.createContext(n);function i(e){const r=t.useContext(d);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),t.createElement(d.Provider,{value:r},e.children)}}}]);