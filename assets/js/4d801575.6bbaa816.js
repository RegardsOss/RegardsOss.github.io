"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[24425],{84199:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>t,metadata:()=>o,toc:()=>d});var r=n(74848),a=n(28453);const t={id:"swarm-cli",title:"REGARDS Command line interface",sidebar_label:"Administration",slug:"/setup/swarm/cli/"},i=void 0,o={id:"setup/swarm/swarm-cli",title:"REGARDS Command line interface",description:"REGARDS stack Administration tools",source:"@site/versioned_docs/version-2.1.0/setup/swarm/03-cli.md",sourceDirName:"setup/swarm",slug:"/setup/swarm/cli/",permalink:"/docs/2.1.0/setup/swarm/cli/",draft:!1,unlisted:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/versioned_docs/version-2.1.0/setup/swarm/03-cli.md",tags:[],version:"2.1.0",sidebarPosition:3,frontMatter:{id:"swarm-cli",title:"REGARDS Command line interface",sidebar_label:"Administration",slug:"/setup/swarm/cli/"},sidebar:"install",previous:{title:"Placement constraint",permalink:"/docs/2.1.0/setup/swarm/advanced/placement-constraint"},next:{title:"Common issues",permalink:"/docs/2.1.0/setup/swarm/common-issues"}},c={},d=[{value:"REGARDS stack Administration tools",id:"regards-stack-administration-tools",level:2},{value:"Simple debugging",id:"simple-debugging",level:2}];function g(e){const s={admonition:"admonition",br:"br",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h2,{id:"regards-stack-administration-tools",children:"REGARDS stack Administration tools"}),"\n",(0,r.jsxs)(s.p,{children:["Connect to the master node of your stack, and open the REGARDS working directory.",(0,r.jsx)(s.br,{}),"\n","To do that, you need these two values from your inventories :"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"group_workdir_local: /opt/regards/\ngroup_stack_name: 'regards'\n"})}),"\n",(0,r.jsxs)(s.p,{children:["It means your stack is installed inside ",(0,r.jsx)(s.code,{children:"/opt/regards/regards"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"Open this folder and go to the cli folder:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cd /opt/regards/regards/cli\n"})}),"\n",(0,r.jsx)(s.p,{children:"Let's look at these scripts :"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"exec.sh"}),": let you go inside a running container. For advanced debugging."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"logs.sh"}),": let you display container logs from a running container. Once the stack is running fine, you should prefer\nto use Kibana to see logs"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"reboot.sh"}),": let you reboot a container"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"status.sh"}),": display the status of your stack (running container, how many containers are missing, history)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"deploy.sh"}),": boot or update the stack using stack files. It checks for updated images on the Docker registry, and\ntrack updates on files available on the master node."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"update.sh"}),": let you fetch an updated docker image and reboot only that single container. For advanced usage, you\nshould prefer ",(0,r.jsx)(s.code,{children:"deploy.sh"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"shutdown.sh"})," : let you completly shutdown the regards swarm stack."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"health.sh"})," : let you retrieve microservices global heathness for a specific tenant."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["When you deploy the stack, you should run ",(0,r.jsx)(s.code,{children:"status.sh"})," to see if containers are running:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"[HISTORY]\t5 PREVIOUS CONTAINERS\nnothing found in stack: regards-cnes\n[RUNNING]\t25/25\nID      NAME                                               IMAGE                                            NODE                                 [..]  CURRENT STATE      [..]\n86..    regards-cnes_rs-fluent.w4pf3rfr47yjny8y2jmvy9n0s   myregistry/regards-fluent:latest              regards-cnes-d12.myorganisation.com      Running 23 hours ago\nnh..    regards-cnes_rs-fluent.jh7i65fsxbrnce85yjexucna3   myregistry/regards-fluent:latest              regards-cnes-d13.myorganisation.com      Running 23 hours ago\n77..    regards-cnes_rs-fluent.iodt1aszolajpqq5f12q12v1w   myregistry/regards-fluent:latest              regards-cnes-d11.myorganisation.com      Running 23 hours ago\nij..    regards-cnes_rs-admin.1                            myregistry/rs-administration:V1.1.0           regards-cnes-d11.myorganisation.com      Running 23 hours ago\nlh..    regards-cnes_rs-postgres.1                         myregistry/regards-database:latest            regards-cnes-d12.myorganisation.com      Running 23 hours ago\nvm..    regards-cnes_rs-phppgadmin.1                       myregistry/regards-phpmyadmin:latest          regards-cnes-d12.myorganisation.com      Running 23 hours ago\n59..    regards-cnes_rs-notifier.1                         myregistry/rs-notifier:V1.1.0                 regards-cnes-d11.myorganisation.com      Running 23 hours ago\n3r..    regards-cnes_rs-logs-elasticsearch.1               myregistry/regards-elasticsearch:latest       regards-cnes-d13.myorganisation.com      Running 23 hours ago\njd..    regards-cnes_rs-kibana.1                           myregistry/regards-kibana:latest              regards-cnes-d13.myorganisation.com      Running 23 hours ago\n3t..    regards-cnes_rs-dam.1                              myregistry/rs-dam:V1.1.0                      regards-cnes-d12.myorganisation.com      Running 23 hours ago\nir..    regards-cnes_rs-access-instance.1                  myregistry/rs-access-instance:V1.1.0          regards-cnes-d11.myorganisation.com      Running 23 hours ago\npp..    regards-cnes_rs-fem.1                              myregistry/rs-fem:V1.1.0                      regards-cnes-d12.myorganisation.com      Running 23 hours ago\nlx..    regards-cnes_rs-config.1                           myregistry/rs-config:V1.1.0                   regards-cnes-d11.myorganisation.com      Running 23 hours ago\n2k..    regards-cnes_rs-authentication.1                   myregistry/rs-authentication:V1.1.0           regards-cnes-d13.myorganisation.com      Running 23 hours ago\nmh..    regards-cnes_rs-catalog.1                          myregistry/rs-catalog:V1.1.0                  regards-cnes-d12.myorganisation.com      Running 23 hours ago\nqu..    regards-cnes_rs-registry.1                         myregistry/rs-registry:V1.1.0                 regards-cnes-d13.myorganisation.com      Running 23 hours ago\n8m..    regards-cnes_rs-rabbitmq.1                         myregistry/regards-messaging:latest           regards-cnes-d12.myorganisation.com      Running 23 hours ago\nn9..    regards-cnes_rs-maildev.1                          myregistry/regards-maildev:latest             regards-cnes-d13.myorganisation.com      Running 23 hours ago\nm8..    regards-cnes_rs-logs-kibana.1                      myregistry/regards-kibana:latest              regards-cnes-d12.myorganisation.com      Running 23 hours ago\nke..    regards-cnes_rs-elasticsearch.1                    myregistry/regards-elasticsearch:latest       regards-cnes-d13.myorganisation.com      Running 23 hours ago\nkw..    regards-cnes_rs-access-project.1                   myregistry/rs-access-project:V1.1.0           regards-cnes-d13.myorganisation.com      Running 23 hours ago\n51..    regards-cnes_rs-gateway.1                          myregistry/rs-gateway:V1.1.0                  regards-cnes-d13.myorganisation.com      Running 23 hours ago\njd..    regards-cnes_rs-front.1                            myregistry/rs-front:V1.1.0                    regards-cnes-d13.myorganisation.com      Running 23 hours ago\ny4..    regards-cnes_rs-admin-instance.1                   myregistry/rs-administration-instance:V1.1.0  regards-cnes-d13.myorganisation.com      Running 23 hours ago\n"})}),"\n",(0,r.jsxs)(s.p,{children:["In the history, there is no container starting again and again every minutes. That's what we're expecting in a\nproduction environment.",(0,r.jsx)(s.br,{}),"\n","Moreover, we display the number of running containers and the number of expected ones. In this exemple everything is\nfine (",(0,r.jsx)(s.code,{children:"[RUNNING]    25/25"}),").\nThe current state of these containers is also important. You need to wait 5 to 15 minutes to see if containers succeed\nto boot, some containers are waiting to others so they usually crash in that short period if there is some files\nunwritable, COTS not accessible..."]}),"\n",(0,r.jsx)(s.admonition,{type:"info",children:(0,r.jsxs)(s.p,{children:["The number of running services depends of your inventory. You may see less actives services than this exemple, but\nthe ",(0,r.jsx)(s.code,{children:"[RUNNING]    X/X"})," must equals 100%."]})}),"\n",(0,r.jsxs)(s.p,{children:["You can run the script ",(0,r.jsx)(s.code,{children:"health.sh"})," to check the healthness returned by each microservice of the stack, for a specfic\ntenant."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"./health.sh demo\n[200]\tfem\n[200]\tadmin\n[200]\tdam\n[200]\tprocessing\n[200]\tstorage\n[200]\tdownloader\n[200]\tauthentication\n[200]\tingest\n[200]\tadmin_instance\n[200]\taccess\n[200]\tcatalog\n[200]\taccess_instance\n[200]\torder\n[200]\tdataprovider\n[200]\tnotifier\n"})}),"\n",(0,r.jsx)(s.admonition,{type:"info",children:(0,r.jsx)(s.p,{children:"The microservice healthness is still in a early access and not heavily tested."})}),"\n",(0,r.jsx)(s.h2,{id:"simple-debugging",children:"Simple debugging"}),"\n",(0,r.jsx)(s.p,{children:"Now, let's see how you can debug some microservice.\nFirst, let's remove the elasticsearch:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker service scale regards-cnes_rs-elasticsearch=0\n"})}),"\n",(0,r.jsx)(s.p,{children:"Then, reboot dam:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"./reboot.sh rs-dam\n"})}),"\n",(0,r.jsx)(s.p,{children:"Now we can read logs of the booting dam to see if it succeed to boot without ElasticSearch :"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"$./logs.sh rs-dam -f\nregards-cnes_rs-dam.1.w5gxg6x1mn2x@regards-cnes-d13.myorganisation.com    | 2020-05-12 10:49:54,315 [rs-dam] [main            ] ERROR o.s.boot.SpringApplication []    - Application run failed\n[..]\nregards-cnes_rs-dam.1.w5gxg6x1mn2x@regards-cnes-d13.myorganisation.com    | Caused by: java.net.UnknownHostException: rs-elasticsearch: Try again\n"})}),"\n",(0,r.jsx)(s.p,{children:"Definitly, it doesn't like it. Now we can restart the ElasticSearch by just running :"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"./deploy.sh\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Now we can run again ",(0,r.jsx)(s.code,{children:"status.sh"})," :"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# ./status.sh \n[HISTORY]\t5 PREVIOUS CONTAINERS\nID      NAME                                               IMAGE                                                                     NODE                                  DESIRED STATE CURRENT STATE [..]\n86m..   regards-cnes_rs-fluent.w4pf3rfr47yjny8y2jmvy9n0s   myregistry/regards-fluent:latest@sha256:4e733e[...]      regards-cnes-d12.myorganisation.com   Shutdown      Shutdown 2 minutes ago\nnhu..   regards-cnes_rs-fluent.jh7i65fsxbrnce85yjexucna3   myregistry/regards-fluent:latest@sha256:4e733e[...]      regards-cnes-d13.myorganisation.com   Shutdown      Shutdown 2 minutes ago\n778..   regards-cnes_rs-fluent.iodt1aszolajpqq5f12q12v1w   myregistry/regards-fluent:latest@sha256:4e733e[...]      regards-cnes-d11.myorganisation.com   Shutdown      Shutdown 2 minutes ago\nty0..   regards-cnes_rs-authentication.1                   myregistry/rs-authentication:V1.1.0@sha256:875ca2aa[..]  regards-cnes-d13.myorganisation.com   Shutdown      Shutdown 3 minute ago\n7yw..   regards-cnes_rs-access-project.1                   myregistry/rs-access-project:V1.1.0@sha256:17a0d7e9[..]  regards-cnes-d13.myorganisation.com   Shutdown      Shutdown 3 minute ago\n[RUNNING]\t25/25\n[..]\n"})}),"\n",(0,r.jsx)(s.p,{children:"We see in the history the last activity starts to be old (2 mins) and there is again 25/25 services deployed."})]})}function l(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(g,{...e})}):g(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>o});var r=n(96540);const a={},t=r.createContext(a);function i(e){const s=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);