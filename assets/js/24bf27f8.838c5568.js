"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[47530],{62324:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>a,frontMatter:()=>d,metadata:()=>l,toc:()=>o});var t=s(74848),n=s(28453);const d={title:"Monitor a delivery request progress",sidebar_label:"Subscribe to responses",slug:"/development/backend/services/delivery/api-guides/amqp/subscribe-to-delivery-responses",sidebar_position:2},i=void 0,l={id:"development/services/delivery/api-guides/amqp/amqp-subscribe-response",title:"Monitor a delivery request progress",description:"Introduction",source:"@site/docs/development/services/delivery/api-guides/amqp/amqp-subscribe-response.md",sourceDirName:"development/services/delivery/api-guides/amqp",slug:"/development/backend/services/delivery/api-guides/amqp/subscribe-to-delivery-responses",permalink:"/docs/development/backend/services/delivery/api-guides/amqp/subscribe-to-delivery-responses",draft:!1,unlisted:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/docs/development/services/delivery/api-guides/amqp/amqp-subscribe-response.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Monitor a delivery request progress",sidebar_label:"Subscribe to responses",slug:"/development/backend/services/delivery/api-guides/amqp/subscribe-to-delivery-responses",sidebar_position:2}},c={},o=[{value:"Introduction",id:"introduction",level:2},{value:"Regards AMQP api",id:"regards-amqp-api",level:2},{value:"Exchange",id:"exchange",level:2},{value:"Queue",id:"queue",level:2},{value:"Message format",id:"message-format",level:2},{value:"Properties",id:"properties",level:3},{value:"Headers",id:"headers",level:3},{value:"GRANTED body",id:"granted-body",level:4},{value:"DONE body",id:"done-body",level:4},{value:"DENIED body",id:"denied-body",level:4},{value:"ERROR body",id:"error-body",level:4}];function h(e){const r={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsxs)(r.p,{children:["This section describes how to subscribe to events sent by rs-delivery microservice about submitted delivery requests as\ndescribed in ",(0,t.jsx)(r.a,{href:"/docs/development/backend/services/delivery/api-guides/amqp/publish-a-delivery-request",children:"Publish a delivery request event"}),"."]}),"\n",(0,t.jsx)(r.h2,{id:"regards-amqp-api",children:"Regards AMQP api"}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.a,{href:"/docs/development/concepts/amqp-api/",children:"Regards AMQP API concept"})," describe how AMQP interfaces must be handled to\nsubmit events or to subscribe to events."]}),"\n",(0,t.jsx)(r.h2,{id:"exchange",children:"Exchange"}),"\n",(0,t.jsx)(r.p,{children:"Delivery requests responses from REGARDS are sent to exchange :"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Exchange"}),(0,t.jsx)(r.th,{children:"Virtual host"})]})}),(0,t.jsx)(r.tbody,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"regards.broadcast.fr.cnes.regards.modules.ltamanager.amqp.output.DeliveryResponseDtoEvent"})}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"regards.multitenant.manager"})})]})})]}),"\n",(0,t.jsx)(r.h2,{id:"queue",children:"Queue"}),"\n",(0,t.jsxs)(r.p,{children:["Every consumer of this\nexchange ",(0,t.jsx)(r.a,{href:"/docs/development/concepts/amqp-api/#subscribe-to-regards-published-events",children:"must create its own queue bound to this exchange"}),"."]}),"\n",(0,t.jsx)(r.h2,{id:"message-format",children:"Message format"}),"\n",(0,t.jsx)(r.h3,{id:"properties",children:"Properties"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"app_id"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{children:"Standard RabbitMQ property to track message origin."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"priority"}),(0,t.jsx)(r.td,{children:"Integer"}),(0,t.jsx)(r.td,{children:"Standard RabbitMQ property to sort messages by priority order."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"content_encoding"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{children:"Standard RabbitMQ property for the encoding type of the message"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"content_type"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{children:"Standard RabbitMQ property for the MIME Type of the message sent"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"delivery_mode"}),(0,t.jsx)(r.td,{children:"Integer"}),(0,t.jsx)(r.td,{children:"Standard RabbitMQ property for the delivery mode (persistent or not)"})]})]})]}),"\n",(0,t.jsx)(r.h3,{id:"headers",children:"Headers"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"regards.tenant"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{children:"Tenant name depends on REGARDS instance project configuration."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"regards.type"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{children:"Type of content of the message"})]})]})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",metastring:'title="Example of the properties and headers of an Ingest request event message"',children:'{\n  "app_id": "{ID of app}",\n  "priority": 1,\n  "delivery_mode": 2,\n  "content_encoding": "UTF-8",\n  "content_type": "application/json",\n  "headers": [\n    {\n      "regards.tenant": "REGARDS",\n      "regards.type": "fr.cnes.regards.modules.delivery.amqp.output.DeliveryResponseDtoEvent"\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(r.h4,{id:"granted-body",children:"GRANTED body"}),"\n",(0,t.jsx)(r.p,{children:"REGARDS publishes a granted notification when the delivery request is valid and ready to be processed."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n  "correlationId": "xxx",\n  "status": "GRANTED"\n}\n'})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{style:{textAlign:"center"},children:"Optional"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"correlationId"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Request identifier."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"status"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"The request is granted."})]})]})]}),"\n",(0,t.jsx)(r.h4,{id:"done-body",children:"DONE body"}),"\n",(0,t.jsx)(r.p,{children:"REGARDS publishes a done notification when the delivery has been processed successfully, i.e, the zip with files ordered\nhas been uploaded to the S3 server."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n  "correlationId": "xxx",\n  "status": "DONE",\n  "url": "xxx",\n  "md5": "xxx"\n}\n'})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{style:{textAlign:"center"},children:"Optional"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"correlationId"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Request identifier."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"status"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"The delivery request has been processed successfully."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"url"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"S3 formatted zip location (s3://bucket/correlationId/zipName.zip)."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"md5"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Zip checksum in MD5 format."})]})]})]}),"\n",(0,t.jsx)(r.h4,{id:"denied-body",children:"DENIED body"}),"\n",(0,t.jsx)(r.p,{children:"REGARDS publishes a denied notification when the request is not valid."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n  "correlationId": "xxx",\n  "status": "DENIED",\n  "message": "xxx",\n  "errorType": "xxx"\n}\n'})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{style:{textAlign:"center"},children:"Optional"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"correlationId"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Request identifier."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"status"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"The request cannot be processed."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"message"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(r.td,{children:"Description of the error."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"errorType"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Associated error code."})]})]})]}),"\n",(0,t.jsx)(r.p,{children:"A request can be invalid, if the delivery request is not well-formed."}),"\n",(0,t.jsx)(r.admonition,{title:"How to handle it?",type:"info",children:(0,t.jsxs)(r.p,{children:["See the ",(0,t.jsx)(r.a,{href:"/docs/development/backend/services/delivery/api-guides/amqp/publish-a-delivery-request",children:"request format"}),", fix your payload and submit a new request."]})}),"\n",(0,t.jsx)(r.h4,{id:"error-body",children:"ERROR body"}),"\n",(0,t.jsx)(r.p,{children:"After request has been granted by REGARDS, internal errors may occur. In such case, an error response will be published\non the response exchange."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{\n  "correlationId": "xxx",\n  "status": "ERROR",\n  "message": "xxx",\n  "errorType": "xxx"\n}\n'})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{style:{textAlign:"center"},children:"Optional"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"correlationId"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Request identifier."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"status"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"The request cannot be processed."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"message"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(r.td,{children:"Description of the error."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"errorType"}),(0,t.jsx)(r.td,{children:"String"}),(0,t.jsx)(r.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(r.td,{children:"Associated error code."})]})]})]}),"\n",(0,t.jsx)(r.p,{children:"There are several error types:"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Error Type"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"INVALID_CONTENT"}),(0,t.jsx)(r.td,{children:"The delivery request is malformed."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"FORBIDDEN"}),(0,t.jsx)(r.td,{children:"The provided user is not allowed to access delivery features."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"ORDER_LIMIT_REACHED"}),(0,t.jsx)(r.td,{children:"The order requested is too big and cannot be performed."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"TOO_MANY_SUBORDERS"}),(0,t.jsx)(r.td,{children:"The order returns more than one sub-order for a given delivery request. Only one sub-order is allowed for now."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"EMPTY_ORDER"}),(0,t.jsx)(r.td,{children:"The order requested contains no data to order."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"EXPIRED"}),(0,t.jsx)(r.td,{children:"The delivery request has expired."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"INTERNAL_ERROR"}),(0,t.jsx)(r.td,{children:"An internal error occurred during the processing of the order."})]})]})]}),"\n",(0,t.jsx)(r.admonition,{title:"How to handle it?",type:"info",children:(0,t.jsx)(r.p,{children:"Retry later with a new request or contact REGARDS administrators."})})]})}function a(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},28453:(e,r,s)=>{s.d(r,{R:()=>i,x:()=>l});var t=s(96540);const n={},d=t.createContext(n);function i(e){const r=t.useContext(d);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),t.createElement(d.Provider,{value:r},e.children)}}}]);