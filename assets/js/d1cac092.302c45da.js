"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[14333],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=p(n),u=o,k=m["".concat(l,".").concat(u)]||m[u]||d[u]||a;return n?r.createElement(k,s(s({ref:t},c),{},{components:n})):r.createElement(k,s({ref:t},c))}));function k(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[m]="string"==typeof e?e:o,s[1]=i;for(var p=2;p<a;p++)s[p]=n[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},49576:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>p});var r=n(87462),o=(n(67294),n(3905));const a={id:"swarm-networks",title:"Networks",slug:"/setup/swarm/advanced/swarm-networks"},s=void 0,i={unversionedId:"setup/advanced/swarm-networks",id:"setup/advanced/swarm-networks",title:"Networks",description:"This guide allows you to tune SWARM networks thanks to your inventory.",source:"@site/docs/setup/advanced/swarm-networks.md",sourceDirName:"setup/advanced",slug:"/setup/swarm/advanced/swarm-networks",permalink:"/docs/setup/swarm/advanced/swarm-networks",draft:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/docs/setup/advanced/swarm-networks.md",tags:[],version:"current",frontMatter:{id:"swarm-networks",title:"Networks",slug:"/setup/swarm/advanced/swarm-networks"},sidebar:"install",previous:{title:"Mount volumes, configs...",permalink:"/docs/setup/swarm/advanced/swarm-mount"},next:{title:"Securise using HTTPS",permalink:"/docs/setup/swarm/advanced/regards-https/"}},l={},p=[{value:"Internal network",id:"internal-network",level:3},{value:"Swarm networks",id:"swarm-networks",level:4},{value:"REGARDS network",id:"regards-network",level:4},{value:"External networks",id:"external-networks",level:3},{value:"Preferred networks",id:"preferred-networks",level:3}],c={toc:p},m="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(m,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This guide allows you to tune SWARM networks thanks to your inventory."),(0,o.kt)("h3",{id:"internal-network"},"Internal network"),(0,o.kt)("admonition",{title:"ensure networks are reserved",type:"danger"},(0,o.kt)("p",{parentName:"admonition"},"Netmask, defined inside ",(0,o.kt)("a",{parentName:"p",href:"#swarm-network"},"Swarm networks")," and ",(0,o.kt)("a",{parentName:"p",href:"#regards-network"},"REGARDS network"),", must be reserved by\nyour ",(0,o.kt)("strong",{parentName:"p"},"corporation")," to prevent the usage of these reserved masks.",(0,o.kt)("br",{parentName:"p"}),"\n","Otherwise, a machine that has an IP inside one of these reserved masks ",(0,o.kt)("strong",{parentName:"p"},"would not be reachable from your REGARDS\ncluster"),".  ")),(0,o.kt)("h4",{id:"swarm-networks"},"Swarm networks"),(0,o.kt)("p",null,"By default, ",(0,o.kt)("em",{parentName:"p"},"demo inventories")," defines several communication networks used by Swarm nodes to communicate to each\nother.",(0,o.kt)("br",{parentName:"p"}),"\n","Default values are :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"# Inside inventories/<inventory name>/group_vars/docker_nodes/main.yml\ndocker_bip: 10.122.20.1/24\ndocker_ingress_network: 10.122.22.0/24\ndocker_ingress_network_gateway: 10.122.22.1\ndocker_gwbridge_network: 10.122.21.0/24\n")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"See more about these networks on the Docker documentation:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/engine/swarm/ingress/"},"Ingress network for routing mesh")," enables each node in the swarm to\naccept connections on published ports for any service running in the swarm"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/engine/swarm/networking/#customize-the-docker_gwbridge"},"The docker_gwbridge is a virtual bridge"),"\nthat connects the overlay networks (including the ingress network) to an individual Docker daemon's physical network"),(0,o.kt)("li",{parentName:"ul"},"Docker uses a software bridge which lets containers connected to\nthe ",(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/network/drivers/bridge/#use-the-default-bridge-network"},"same bridge network communicate")))),(0,o.kt)("h4",{id:"regards-network"},"REGARDS network"),(0,o.kt)("p",null,"By default, ",(0,o.kt)("em",{parentName:"p"},"demo inventories")," defines an internal microservice communication network with the following value :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},'# Inside inventories/<inventory name>/group_vars/regards_nodes/main.yml\ngroup_docker_network_ip_network: "10.11.7."\n')),(0,o.kt)("p",null,"This property allows to create an ",(0,o.kt)("em",{parentName:"p"},"overlay")," network dedicated to our microservices with:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"a subnet in ",(0,o.kt)("em",{parentName:"li"},"0/24")),(0,o.kt)("li",{parentName:"ul"},"and its gateway.")),(0,o.kt)("h3",{id:"external-networks"},"External networks"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"This option is facultative.")),(0,o.kt)("p",null,"To define external access to microservices, you must first declare the ",(0,o.kt)("strong",{parentName:"p"},"external networks")," to use as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"group_config_mservices:\n  external_networks:\n    - network: foo\n      name: net_foo\n")),(0,o.kt)("admonition",{title:"Generated configuration",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"This configuration generates networks top-level element as defined in\nthe ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/compose-spec/compose-spec/blob/master/spec.md#networks-top-level-element"},"compose specification"),".")),(0,o.kt)("admonition",{title:"Reminder",type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"The creation of these ",(0,o.kt)("strong",{parentName:"p"},"external networks")," is not handled by regards playbook. You must create them beforehand by your\nown!")),(0,o.kt)("p",null,"It is then possible to define specific connections to the following microservices: ",(0,o.kt)("em",{parentName:"p"},"gateway"),", ",(0,o.kt)("em",{parentName:"p"},"authentication"),",\n",(0,o.kt)("em",{parentName:"p"},"catalog")," or ",(0,o.kt)("em",{parentName:"p"},"front"),"."),(0,o.kt)("p",null,"For instance:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"group_docker_mservices:\n  catalog:\n    configuration:\n      external_networks:\n        - network: foo\n          aliases:\n            - foo.catalog\n")),(0,o.kt)("admonition",{title:"Generated configuration",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"This configuration generates networks and optionnaly aliases as\ndefined ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/compose-spec/compose-spec/blob/master/spec.md#aliases"},"here"),".")),(0,o.kt)("h3",{id:"preferred-networks"},"Preferred networks"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"This option is facultative.")),(0,o.kt)("p",null,"As a side effect when ",(0,o.kt)("strong",{parentName:"p"},"several networks")," are defined inside your SWARM network, you will have to specify the preferred\nnetworks in order to microservice to talk to each other without network issue."),(0,o.kt)("p",null,"So to force internal microservice communication to use ",(0,o.kt)("strong",{parentName:"p"},"internal network"),", you will have to setup the following\nproperties:"),(0,o.kt)("p",null,"For instance:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"group_config_mservices:\n  # Value depends on your internal network configuration\n  preferred_networks: 10.11\n")))}d.isMDXComponent=!0}}]);