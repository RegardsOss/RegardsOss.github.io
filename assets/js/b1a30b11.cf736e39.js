"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[80472],{6462:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var l=i(74848),t=i(28453);const o={id:"backend-framework-modules-plugins",title:"Plugins introduction",sidebar_label:"Plugins introduction",slug:"/development/backend/framework/modules/plugins/"},r=void 0,s={id:"development/backend/framework/modules/backend-framework-modules-plugins",title:"Plugins introduction",description:"Purpose",source:"@site/versioned_docs/version-1.13.0/development/backend/framework/modules/plugins.md",sourceDirName:"development/backend/framework/modules",slug:"/development/backend/framework/modules/plugins/",permalink:"/docs/1.13.0/development/backend/framework/modules/plugins/",draft:!1,unlisted:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/versioned_docs/version-1.13.0/development/backend/framework/modules/plugins.md",tags:[],version:"1.13.0",frontMatter:{id:"backend-framework-modules-plugins",title:"Plugins introduction",sidebar_label:"Plugins introduction",slug:"/development/backend/framework/modules/plugins/"},sidebar:"dev",previous:{title:"How to create a microservice",permalink:"/docs/1.13.0/development/backend/framework/dev-microservice/"},next:{title:"How to create a plugin",permalink:"/docs/1.13.0/development/backend/framework/dev-plugin/"}},a={},d=[{value:"Purpose",id:"purpose",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Autoconfiguration",id:"autoconfiguration",level:2},{value:"How to define an extension point",id:"how-to-define-an-extension-point",level:2},{value:"How to create a plugin",id:"how-to-create-a-plugin",level:2},{value:"Plugin reference documentation",id:"plugin-reference-documentation",level:2},{value:"Annotations",id:"annotations",level:3},{value:"<code>PluginInterface</code>",id:"plugininterface",level:4},{value:"<code>Plugin</code>",id:"plugin",level:4},{value:"<code>PluginInit</code>",id:"plugininit",level:4},{value:"<code>PluginDestroy</code>",id:"plugindestroy",level:4},{value:"<code>PluginParameter</code>",id:"pluginparameter",level:4},{value:"Plugin development",id:"plugin-development",level:3},{value:"Plugin deployment",id:"plugin-deployment",level:3}];function c(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,l.jsx)(n.p,{children:"Plugin module is used to promote service adaptability."}),"\n",(0,l.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsx)(n.p,{children:"Add module dependency to your POM (version depends on the BOM)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>fr.cnes.regards.framework.modules.plugins</groupId>\n    <artifactId>plugins-service</artifactId>\n</dependency>\n"})}),"\n",(0,l.jsx)(n.p,{children:"Properties :"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-properties",children:"# Comma separated list of plugin packages from which system detects and loads plugin implementations\n# Fallback to fr.cnes.regards if not specified\nregards.plugins.packages-to-scan=\n"})}),"\n",(0,l.jsx)(n.p,{children:"vregards.plugins.packages-to-scan"}),"\n",(0,l.jsx)(n.h2,{id:"autoconfiguration",children:"Autoconfiguration"}),"\n",(0,l.jsx)(n.p,{children:"Module autoconfigures:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"PluginService"})," to manage plugin lifecycle."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["The module relies on a ",(0,l.jsx)(n.strong,{children:"plugin utility library"})," to discover and instanciate a plugin. This library can be directly imported for implementation and test purpose with the following configuration :"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>fr.cnes.regards.framework.utils</groupId>\n    <artifactId>plugin-utils</artifactId>\n</dependency>\n"})}),"\n",(0,l.jsx)(n.h2,{id:"how-to-define-an-extension-point",children:"How to define an extension point"}),"\n",(0,l.jsxs)(n.p,{children:["To define an extension point, you have to declare a ",(0,l.jsx)(n.strong,{children:"service contract"})," annotated with ",(0,l.jsx)(n.code,{children:"PluginInterface"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@PluginInterface(description = "Hello sample plugin interface")\npublic interface IHelloPlugin {\n    String hello(String name);\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"how-to-create-a-plugin",children:"How to create a plugin"}),"\n",(0,l.jsxs)(n.p,{children:["On a functionnal point of view, creating a ",(0,l.jsx)(n.strong,{children:"plugin"})," is defining a new way to respect a ",(0,l.jsx)(n.strong,{children:"service contract"}),". On a developper point of view, it means creating a new class annotated ",(0,l.jsx)(n.code,{children:"Plugin"})," implementing the plugin interface."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@Plugin(author = "REGARDS Team", id = "echo", version = "1.0.0", licence = "GPLv3", owner = "CNES")\npublic class HelloPlugin implements IHelloPlugin {\n    \n    @PluginParameter(label = "Message", defaultValue="Hello %s!")\n    private String message;\n\n    @PluginInit\n    private void init() {\n        // Init something after plugin instanciation\n    }\n\n    @Override\n    public String hello(String name) {\n        return String.format(message, name);\n    }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["As we can see in the above example, ",(0,l.jsx)(n.code,{children:"HelloPlugin"})," fulfils the ",(0,l.jsx)(n.code,{children:"IHelloPlugin"})," service contract."]}),"\n",(0,l.jsx)(n.h2,{id:"plugin-reference-documentation",children:"Plugin reference documentation"}),"\n",(0,l.jsx)(n.h3,{id:"annotations",children:"Annotations"}),"\n",(0,l.jsx)(n.h4,{id:"plugininterface",children:(0,l.jsx)(n.code,{children:"PluginInterface"})}),"\n",(0,l.jsx)(n.p,{children:"This annotation identifies an extension point, also called a service contract that is used in business service workflow allowing to adapt behaviour to project requirements."}),"\n",(0,l.jsx)(n.h4,{id:"plugin",children:(0,l.jsx)(n.code,{children:"Plugin"})}),"\n",(0,l.jsxs)(n.p,{children:["This annotation identifies an implementation of an extension point and allows to give useful information on the plugin such as its ",(0,l.jsx)(n.code,{children:"id"}),", ",(0,l.jsx)(n.code,{children:"decription"})," ",(0,l.jsx)(n.code,{children:"version"}),", etc."]}),"\n",(0,l.jsx)(n.h4,{id:"plugininit",children:(0,l.jsx)(n.code,{children:"PluginInit"})}),"\n",(0,l.jsxs)(n.p,{children:["This annotation is ",(0,l.jsx)(n.strong,{children:"optional"})," and is used to initialize a plugin. If used, it must annotates a no-arg method. This method is called after parameter injection on plugin instanciation."]}),"\n",(0,l.jsx)(n.h4,{id:"plugindestroy",children:(0,l.jsx)(n.code,{children:"PluginDestroy"})}),"\n",(0,l.jsxs)(n.p,{children:["This annotation is ",(0,l.jsx)(n.strong,{children:"optional"})," and is used to properly destroy a plugin. If used, it must annotates a no-arg method. This method is called when plugin is destroyed by the plugin service."]}),"\n",(0,l.jsx)(n.h4,{id:"pluginparameter",children:(0,l.jsx)(n.code,{children:"PluginParameter"})}),"\n",(0,l.jsxs)(n.p,{children:["This annotation is ",(0,l.jsx)(n.strong,{children:"optional"})," and can be used several times, as many times as there are parameters. It allows accurate plugin configuration."]}),"\n",(0,l.jsx)(n.p,{children:"Plugin parameters are injected after plugin class instanciation and before init method was called."}),"\n",(0,l.jsx)(n.p,{children:"Plugin parameters supports following types:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"String"}),"\n",(0,l.jsx)(n.li,{children:"Byte"}),"\n",(0,l.jsx)(n.li,{children:"Short"}),"\n",(0,l.jsx)(n.li,{children:"Integer"}),"\n",(0,l.jsx)(n.li,{children:"Long"}),"\n",(0,l.jsx)(n.li,{children:"Float"}),"\n",(0,l.jsx)(n.li,{children:"Double"}),"\n",(0,l.jsx)(n.li,{children:"Boolean"}),"\n",(0,l.jsx)(n.li,{children:"Collection"}),"\n",(0,l.jsx)(n.li,{children:"Plugin interface"}),"\n",(0,l.jsx)(n.li,{children:"Map"}),"\n",(0,l.jsx)(n.li,{children:"Plain Old Java Object (i.e. POJO)"}),"\n"]}),"\n",(0,l.jsx)(n.admonition,{type:"danger",children:(0,l.jsx)(n.p,{children:"Parameter configurations are backed up as plain JSON objects so all parameters must be serializabled unequivocally!"})}),"\n",(0,l.jsx)(n.admonition,{type:"danger",children:(0,l.jsxs)(n.p,{children:["All parameters (i.e. class fields), even in complex objects, must be annotated with ",(0,l.jsx)(n.code,{children:"PluginParameter"}),"!"]})}),"\n",(0,l.jsx)(n.h3,{id:"plugin-development",children:"Plugin development"}),"\n",(0,l.jsxs)(n.p,{children:["As seen above, develop a plugin just means implementing ",(0,l.jsx)(n.strong,{children:"pure plain JAVA objects"}),"."]}),"\n",(0,l.jsx)(n.p,{children:"Start by implementing a service contract interface and afterwards, just annotate your implementation with required plugin annotations."}),"\n",(0,l.jsxs)(n.p,{children:["Before deploying plugin, you should test it using ",(0,l.jsx)(n.code,{children:"PluginUtils"}),"."]}),"\n",(0,l.jsx)(n.p,{children:"Hereunder, this is a sample test built with JUnit."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'    @Test\n    public void helloPluginTest() {\n\n        String helloFormat = "Welcome %s!";\n        String name = "John";\n        // Set parameter configuration (override default)\n        Set<PluginParameter> parameters = PluginParametersFactory.build().addParameter("message", helloFormat).getParameters();\n        // Init plugin instanciation context\n        PluginUtils.setup("your.root.package");\n        // Instanciate plugin\n        IHelloPlugin hello = PluginUtils.getPlugin(parameters, HelloPlugin.class, new HashMap<>());\n        // Test plugin\n        Assert.assertEquals(String.format(helloFormat, name), hello.hello());\n    }\n'})}),"\n",(0,l.jsx)(n.h3,{id:"plugin-deployment",children:"Plugin deployment"}),"\n",(0,l.jsx)(n.admonition,{type:"caution",children:(0,l.jsx)(n.p,{children:"Plugins are loaded in the same classloader as the microservice so you have to be very careful with their deployments. Plugin library and dependencies have to be compatible with the target microservice."})}),"\n",(0,l.jsx)(n.p,{children:"To deploy your plugin, we advise you this procedure :"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Build you plugin as a simple JAR,"}),"\n",(0,l.jsxs)(n.li,{children:["Deploy this JAR and all its ",(0,l.jsx)(n.strong,{children:"specific dependencies"})," in the plugin directory of the target microservice,"]}),"\n",(0,l.jsx)(n.li,{children:"Be careful not to add library already loaded by microservice to avoid library inconsistency."}),"\n",(0,l.jsx)(n.li,{children:"Restart the microservice."}),"\n"]}),"\n",(0,l.jsx)(n.admonition,{type:"caution",children:(0,l.jsxs)(n.p,{children:["To be loaded in a microservice, plugin scanned packages has to be declared properly in microservice properties. By default, only the package ",(0,l.jsx)(n.code,{children:"fr.cnes.regards"})," is scanned (Look at the properties above)."]})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>s});var l=i(96540);const t={},o=l.createContext(t);function r(e){const n=l.useContext(o);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),l.createElement(o.Provider,{value:n},e.children)}}}]);