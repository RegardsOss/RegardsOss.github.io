"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[7948],{67692:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var i=t(74848),s=t(28453);const o={id:"backend-catalog-conception",title:"REGARDS catalog microservice",sidebar_label:"How it works",slug:"/development/backend/services/catalog/conception/",sidebar_position:2},a=void 0,r={id:"development/services/catalog/backend-catalog-conception",title:"REGARDS catalog microservice",description:"Conception",source:"@site/docs/development/services/catalog/conception.md",sourceDirName:"development/services/catalog",slug:"/development/backend/services/catalog/conception/",permalink:"/docs/development/backend/services/catalog/conception/",draft:!1,unlisted:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/docs/development/services/catalog/conception.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"backend-catalog-conception",title:"REGARDS catalog microservice",sidebar_label:"How it works",slug:"/development/backend/services/catalog/conception/",sidebar_position:2},sidebar:"dev",previous:{title:"Overview",permalink:"/docs/development/backend/services/catalog/overview/"},next:{title:"Legacy Search API",permalink:"/docs/development/backend/services/catalog/api-guides/rest/legacy-search-api"}},c={},l=[{value:"Conception",id:"conception",level:2},{value:"Search Engines",id:"search-engines",level:3},{value:"Service",id:"service",level:3},{value:"STAC Search description",id:"stac-search-description",level:2},{value:"STAC Collection management",id:"stac-collection-management",level:3},{value:"Static collections",id:"static-collections",level:4},{value:"Dynamic collections",id:"dynamic-collections",level:4},{value:"Link management",id:"link-management",level:3},{value:"STAC browser modifications",id:"stac-browser-modifications",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"conception",children:"Conception"}),"\n",(0,i.jsxs)(n.p,{children:["There are two main features provided by ",(0,i.jsx)(n.code,{children:"Catalog"})," service :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Providing a search engine in one of the different search standards supported by REGARDS"}),"\n",(0,i.jsx)(n.li,{children:"Performing operations on the products through different services"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["In both cases, the ",(0,i.jsx)(n.code,{children:"Catalog"})," microservice must send a request to ElasticSearch in order to retrieve the corresponding\nproduct."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Store plugins",src:t(57321).A+"",width:"374",height:"266"})}),"\n",(0,i.jsx)(n.h3,{id:"search-engines",children:"Search Engines"}),"\n",(0,i.jsxs)(n.p,{children:["It is possible to use several search standards with REGARDS to perform researches with the ",(0,i.jsx)(n.code,{children:"Catalog"})," microservice.\nTo make it possible, the ",(0,i.jsx)(n.code,{children:"Catalog"})," microservice contains different search engines, one for each type of search standard.\nThese search engines are implemented as plugins."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"Catalog"})," microservice receives a search request through its REST interface. The identifier of the search\nengine is provided as a path variable."]}),"\n",(0,i.jsx)(n.li,{children:"The plugin corresponding to the asked service is found thanks to the identifier provided in the request."}),"\n",(0,i.jsx)(n.li,{children:"The request is sent to the relevant plugin."}),"\n",(0,i.jsxs)(n.li,{children:["The search parameters of the request are written in the search standard understood by the plugin. The plugin\nconvert these parameters into a list of criteria, in a common format which can be interpreted by the ",(0,i.jsx)(n.code,{children:"Catalog"}),"\nservice."]}),"\n",(0,i.jsx)(n.li,{children:"This list of criteria is used to create an ElasticSearch request in proper form."}),"\n",(0,i.jsx)(n.li,{children:"The result of the ElasticSearch is formatted by the plugin to match the standard required"}),"\n",(0,i.jsx)(n.li,{children:"The formatted result is sent to the user"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Catalog search",src:t(35284).A+"",width:"742",height:"750"})}),"\n",(0,i.jsx)(n.admonition,{title:"Stac exception",type:"warning",children:(0,i.jsxs)(n.p,{children:["The STAC plugins expose their own REST endpoints.\nIt means that the call from the user directly requests the plugin, the step where the ",(0,i.jsx)(n.code,{children:"Catalog"})," must find the plugin\nis not operated in this case."]})}),"\n",(0,i.jsx)(n.h3,{id:"service",children:"Service"}),"\n",(0,i.jsxs)(n.p,{children:["Several operations can be applied to the products of the Catalog, such as downloading or exporting on specific formats.\nThese operation are performed by ",(0,i.jsx)(n.code,{children:"Catalog"})," plugins."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"Catalog"})," service receives a service request through its REST interface. The ",(0,i.jsx)(n.code,{children:"PluginBusinessId"})," is provided as a\npath variable. the payload contains a search request."]}),"\n",(0,i.jsxs)(n.li,{children:["The plugin corresponding to the asked service is found thanks to the ",(0,i.jsx)(n.code,{children:"PluginBusinessId"})," provided in the request.\nThe right plugin is then requested."]}),"\n",(0,i.jsx)(n.li,{children:"From the search request of the payload, an ElasticSearch request is elaborated in order to find the good data\nobjects."}),"\n",(0,i.jsx)(n.li,{children:"The operation of the plugin can be applied to the result of the search request."}),"\n",(0,i.jsx)(n.li,{children:"The final result is sent to the user"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Catalog service",src:t(88367).A+"",width:"747",height:"703"})}),"\n",(0,i.jsx)(n.h2,{id:"stac-search-description",children:"STAC Search description"}),"\n",(0,i.jsxs)(n.p,{children:["STAC is one of the search standards you can use with the ",(0,i.jsx)(n.code,{children:"rs-catalog"})," service.\nHere is some explanations of how it works."]}),"\n",(0,i.jsx)(n.h3,{id:"stac-collection-management",children:"STAC Collection management"}),"\n",(0,i.jsx)(n.p,{children:"STAC collections are created from two different sources:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Static collections from REGARDS collections and datasets,"}),"\n",(0,i.jsx)(n.li,{children:"Dynamic collections from the configured list of STAC properties."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"(If no dynamic collections are configured, the user see directly the\navailable static collections. Otherwise, the user is given the choice\nbetween static and dynamic collections as two separate collections.)"}),"\n",(0,i.jsx)(n.h4,{id:"static-collections",children:"Static collections"}),"\n",(0,i.jsx)(n.p,{children:"In the STAC standard, STAC collections are meant to hold a rather small number\nof items, in the hundreds at most. This is why, if the catalog contains a lot\nof items, it is a good idea to split them in many different collections."}),"\n",(0,i.jsx)(n.p,{children:"However, REGARDS already has the notion of collection/datasets, so we recreate\na tree of STAC collections from them."}),"\n",(0,i.jsx)(n.p,{children:"REGARDS Collections can reference other collections, allowing to build a tree\nof collections. Similarly, datasets can reference collections. This is used\nby the STAC static collection mechanism to build a tree of STAC collections."}),"\n",(0,i.jsx)(n.p,{children:"At the root level, static collections display links to the collections or datasets\nwith no parent collection (referencing no other REGARDS collection)."}),"\n",(0,i.jsx)(n.p,{children:"A user navigating to a STAC collection made from a REGARDS collection will see:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"if this collection is referenced by other collections/datasets: links to these collections/datasets,"}),"\n",(0,i.jsx)(n.li,{children:"if this collection has only items, the link to the list of items."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"A user navigating to a STAC collection made from a REGARDS dataset will see:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"the link to the list of items in this dataset."}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"dynamic-collections",children:"Dynamic collections"}),"\n",(0,i.jsx)(n.p,{children:"The user may choose to select some of the configured STAC properties\n(even the mandatory datetime property) as levels in a dynamic tree."}),"\n",(0,i.jsx)(n.p,{children:"Each level has at least one sublevel, but may have more.\nFor instance, datetime properties may have several sublevel consisting of\nselecting the year, then the month, then the day."}),"\n",(0,i.jsx)(n.p,{children:'The dynamic collection is entirely configured in the plugin configuration,\nthanks to the "dynamic collection level" and "dynamic collection format"\nparameters of the STAC properties. The documentation for these parameters\nexplains in details how to set their values correctly.'}),"\n",(0,i.jsx)(n.p,{children:"Dynamic collections domain classes are separated in two aspects:\ndefinitions and values."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Definitions are parsed from the ",(0,i.jsx)(n.code,{children:"StacPropertyConfiguration"}),"s.\nThey define the structure of the dynamic collections."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Values are what is provided by the user navigating in collections.\nValues are represented as base64 encoding of the JSON representation\nof key/values. The keys are the names of STAC properties. The values\nare partial or complete values for the properties."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"A dynamic collection value allows to provide all possible sub-values,\ncorresponding to child collections. For instance, a dynamic collection\nvalue finishing with a datetime property for which the year is given,\ncan lead to all sub-collections for the months of the chosen year."}),"\n",(0,i.jsxs)(n.p,{children:["Once a dynamic collection value is fully completed for the corresponding\ndynamic collection definition, when all the level definitions are\nfully valued. At that point, the STAC plugin can transform the dynamic\ncollection value to an ",(0,i.jsx)(n.code,{children:"ItemSearchBody"}),". Then we reuse the search\nmechanism with this ",(0,i.jsx)(n.code,{children:"ItemSearchBody"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"link-management",children:"Link management"}),"\n",(0,i.jsx)(n.p,{children:"STAC is based extensively on links between entities. Items link\nto collections, collections link to their inner items, to parent\nor child collections."}),"\n",(0,i.jsxs)(n.p,{children:["However, links provided by our plugin must authenticate the current user.\nIn STAC, links are only defined by their URL, and it is not pssible\nto provide authentication headers to be used by the STAC client.\nFortunately, REGARDS allows to pass the authentication token as\na query parameter named ",(0,i.jsx)(n.code,{children:"token"}),". The plugin leverages this mechanism\nand generates links with this parameter."]}),"\n",(0,i.jsxs)(n.p,{children:["The class ",(0,i.jsx)(n.code,{children:"LinkCreatorServiceImpl"})," in the ",(0,i.jsx)(n.code,{children:"stac-service"})," module\nis responsible for taking a ",(0,i.jsx)(n.code,{children:"JWTAuthentication"})," as input, and\nprovide links with links with a valid token."]}),"\n",(0,i.jsx)(n.p,{children:"However, these links will be valid only as long as the token is,\nand tokens have by default a 2 hour expiration. This means that\nthe user can not bookmark links provided by our plugin, as they\nwill expire in a short time."}),"\n",(0,i.jsx)(n.h3,{id:"stac-browser-modifications",children:"STAC browser modifications"}),"\n",(0,i.jsxs)(n.p,{children:["Since the official STAC browser implementation (",(0,i.jsx)(n.a,{href:"https://github.com/radiantearth/stac-browser",children:"here"})," on github)\ndoes not work with links having the ",(0,i.jsx)(n.code,{children:"token"})," query parameter,\na modified version of the STAC browser can be found ",(0,i.jsx)(n.a,{href:"https://github.com/glmxndr/stac-browser",children:"here"}),".\nThis patched version allows to work with the REGARDS ",(0,i.jsx)(n.code,{children:"token"})," query parameters,\nat least until the pull request is merged."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},35284:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/catalog-search-engine-diagram-51faa3ab15df7faaad859e741617c137.png"},88367:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/catalog-services-diagram-7758e2409bd5683c6237bad07a03c489.png"},57321:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/catalog-f3dc9417931664dde25f2707f3d9009d.svg"},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var i=t(96540);const s={},o=i.createContext(s);function a(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);