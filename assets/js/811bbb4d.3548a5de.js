"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[92643],{56342:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var t=n(74848),s=n(28453);const r={id:"backend-dataprovider-conception",title:"REGARDS dataprovider microservice conception",sidebar_label:"Conception",slug:"/development/backend/services/dataprovider/conception/",sidebar_position:2},o=void 0,a={id:"development/services/dataprovider/backend-dataprovider-conception",title:"REGARDS dataprovider microservice conception",description:"This guide talks about Product in the Dataprovider point of",source:"@site/docs/development/services/dataprovider/dataprovider-conception.md",sourceDirName:"development/services/dataprovider",slug:"/development/backend/services/dataprovider/conception/",permalink:"/docs/development/backend/services/dataprovider/conception/",draft:!1,unlisted:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/docs/development/services/dataprovider/dataprovider-conception.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"backend-dataprovider-conception",title:"REGARDS dataprovider microservice conception",sidebar_label:"Conception",slug:"/development/backend/services/dataprovider/conception/",sidebar_position:2},sidebar:"dev",previous:{title:"Overview",permalink:"/docs/development/backend/services/dataprovider/overview/"},next:{title:"All endpoints (OpenAPI)",permalink:"/docs/development/backend/services/dataprovider/api-swagger"}},d={},c=[{value:"Start an acquisition chain",id:"start-an-acquisition-chain",level:2},{value:"Scan step",id:"scan-step",level:2},{value:"Validation step",id:"validation-step",level:2},{value:"Product creation step",id:"product-creation-step",level:2},{value:"SIP generation step",id:"sip-generation-step",level:2},{value:"Ingest step",id:"ingest-step",level:2},{value:"Following Dataprovider Product workflow",id:"following-dataprovider-product-workflow",level:2}];function l(e){const i={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.admonition,{type:"note",children:(0,t.jsxs)(i.p,{children:["This guide talks about Product in the Dataprovider point of\nview. ",(0,t.jsx)(i.a,{href:"/docs/development/concepts/products/",children:"Ingest product"})," is the real product at Regards point of view."]})}),"\n",(0,t.jsxs)(i.p,{children:["Dataprovider is used to acquire some ",(0,t.jsx)(i.a,{href:"/docs/development/concepts/products/",children:"products"})," from scanning folders,\nthrough acquisition chains.\nChains are configured to generate products with one or multiple scanned files."]}),"\n",(0,t.jsx)(i.p,{children:"An acquisition chain has several steps :"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"Data provider plugins",src:n(85474).A+"",width:"953",height:"367"})}),"\n",(0,t.jsx)(i.h2,{id:"start-an-acquisition-chain",children:"Start an acquisition chain"}),"\n",(0,t.jsx)(i.p,{children:"Acquisition chains can be triggered"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"periodically, with totally configurable intervals"}),"\n",(0,t.jsxs)(i.li,{children:["manually, from admin UI or directly\nwith ",(0,t.jsx)(i.a,{href:"/docs/development/backend/services/dataprovider/api-swagger#tag/acquisition-processing-chain-controller/operation/startManualChain",children:"Rest API"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:["restarted (restart only errors detected from a previous acquisition), from admin UI or directly\nwith ",(0,t.jsx)(i.a,{href:"/docs/development/backend/services/dataprovider/api-swagger#tag/acquisition-processing-chain-controller/operation/relaunchErrors",children:"Rest API"})]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"scan-step",children:"Scan step"}),"\n",(0,t.jsx)(i.p,{children:"Scan is the action to explore a folder (and a complete tree if needed, depending on which plugin you use), and analyse\neach file."}),"\n",(0,t.jsx)(i.p,{children:'Multiple scan path can be indicated. These scan paths are associated to a "since date". Files with an earlier date will\nnot be processed.'}),"\n",(0,t.jsxs)(i.p,{children:["To scan a folder, a ",(0,t.jsx)(i.a,{href:"/docs/development/backend/services/dataprovider/plugins/listing#scan-plugins",children:"scan plugin"})," job is used. There are several ways to scan a folder."]}),"\n",(0,t.jsx)(i.admonition,{type:"info",children:(0,t.jsx)(i.p,{children:"After a scan, the since date associated with the scan path is updated to the last file scanned date.\nMeaning that these files will not be scanned again if the chain is relaunched.\nOnly modified files will be scanned in the future."})}),"\n",(0,t.jsx)(i.p,{children:"Scanned files will be used in the next steps."}),"\n",(0,t.jsx)(i.h2,{id:"validation-step",children:"Validation step"}),"\n",(0,t.jsxs)(i.p,{children:["The validation step only validate each file according to a plugin algorithm. Check ",(0,t.jsx)(i.a,{href:"/docs/development/backend/services/dataprovider/plugins/listing#validation-plugins",children:"here"}),"\nfor more details about validation plugin.\nAll valid files go to the next step."]}),"\n",(0,t.jsx)(i.h2,{id:"product-creation-step",children:"Product creation step"}),"\n",(0,t.jsxs)(i.p,{children:["Files are wrapped inside ",(0,t.jsx)(i.a,{href:"/docs/development/concepts/products/",children:"product"}),".\nDepending on the configuration, multiple files can be linked to a single product. In configuration, you can indicate\nthat some files are optionals."]}),"\n",(0,t.jsxs)(i.p,{children:["The product plugin generates a unique product name. See ",(0,t.jsx)(i.a,{href:"/docs/development/backend/services/dataprovider/plugins/listing#product-generator-plugins",children:"here"})," for more information about\nthis plugin."]}),"\n",(0,t.jsx)(i.p,{children:"Products with the same id can exist in case of an exisiting file modification. In this case, a new version of this product\nwill be created."}),"\n",(0,t.jsx)(i.p,{children:"These product are stored in dataprovider database with a particular state (see productState attribute of Product objects\nin Java) :"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"ACQUIRING"})," : If the product is not complete (missing files)"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"COMPLETED"})," : If the product is complete (without optional files - some files can still be added )"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"FINISHED"}),"  : If the product is complete (with optional files included - no more file can be added to the product)"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"UPDATED"}),"   : If the product was complete before the new file acquired. (means a file has been modified)"]}),"\n"]}),"\n",(0,t.jsxs)(i.admonition,{type:"info",children:[(0,t.jsx)(i.p,{children:"In acquisition chains configuration, you can configure the product to create. You can specify how many files are\ncontained in products and some others informations :"}),(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"file type"}),"\n",(0,t.jsx)(i.li,{children:"file is mandatory or not"}),"\n",(0,t.jsx)(i.li,{children:"file mime type"}),"\n"]})]}),"\n",(0,t.jsx)(i.h2,{id:"sip-generation-step",children:"SIP generation step"}),"\n",(0,t.jsxs)(i.p,{children:["SIP generation is done by plugin. Check ",(0,t.jsx)(i.a,{href:"/docs/development/backend/services/dataprovider/plugins/listing#sip-generation-plugins",children:"here"})," for more details."]}),"\n",(0,t.jsx)(i.p,{children:"The purpose of this step si to create a SIP product with metadata associated to the files of the product."}),"\n",(0,t.jsxs)(i.p,{children:["Once the product has been generated in SIP format, it is sent to the OAIS catalog (the rs-ingest microservice) by\n",(0,t.jsx)(i.a,{href:"/docs/development/backend/services/ingest/api-guides/amqp/ingest-amqp-publish-product",children:"AMQP"}),"."]}),"\n",(0,t.jsx)(i.p,{children:"The ingest chain to use can be selected in the data provider acquisition chain configuration."}),"\n",(0,t.jsxs)(i.p,{children:["The versioning method described in ",(0,t.jsx)(i.a,{href:"/docs/development/backend/services/ingest/conception/#versioning",children:"rs-ingest documentation"})," is also configured\nin the acquisition chain on the ",(0,t.jsx)(i.code,{children:"Data provider"})," microservice."]}),"\n",(0,t.jsx)(i.h2,{id:"ingest-step",children:"Ingest step"}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.a,{href:"/docs/development/backend/services/ingest/overview/",children:"Ingest microservice"})," treats each product and sends an acknowledgement by AMQP\nmessage, which indicates if a ",(0,t.jsx)(i.a,{href:"/docs/development/concepts/products/",children:"Regards product"})," is correctly ingested or not."]}),"\n",(0,t.jsxs)(i.p,{children:["You can find ",(0,t.jsx)(i.a,{href:"/docs/development/backend/services/ingest/api-guides/amqp/ingest-amqp-publish-product",children:"here the Sip ingestion AMQP API"}),"."]}),"\n",(0,t.jsx)(i.p,{children:"Dataprovider catches these amqp message and updates the Dataprovider product state."}),"\n",(0,t.jsx)(i.h2,{id:"following-dataprovider-product-workflow",children:"Following Dataprovider Product workflow"}),"\n",(0,t.jsx)(i.p,{children:"A product (in dataprovider) has a ProductSipState attribute. Values for this state are the following :"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"NOT_SCHEDULED"})," : SIP is not yet scheduled because the related product is not Finished or\nCompleted ",(0,t.jsx)(i.a,{href:"#product-creation",children:"See product creation step"})]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"NOT_SCHEDULED_INVALID"})," : SIP is not scheduled because the related product is\nInvalid ",(0,t.jsx)(i.a,{href:"#product-creation",children:"See product creation step"}),". Data provider has to resubmits its files to fix the problem."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"SCHEDULED"})," : SIP generation has been scheduled as a job."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"SCHEDULED_INTERRUPTED"})," : SIP generation interrupted by user"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"GENERATION_ERROR"})," : SIP has not been generated because an error occured."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"SUBMITTED"})," : SIP has been generated and submitted to INGEST"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"INGESTION_FAILED"})," : SIP has been generated but INGEST refuses to treat it"]}),"\n"]})]})}function p(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},85474:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/dataprovider-conception-workflow-7b347605af8e26ef744dd65706f195f9.png"},28453:(e,i,n)=>{n.d(i,{R:()=>o,x:()=>a});var t=n(96540);const s={},r=t.createContext(s);function o(e){const i=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:i},e.children)}}}]);