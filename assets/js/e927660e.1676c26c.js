"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[17597],{94679:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var t=i(74848),r=i(28453);const o={id:"release-notes-v2.3.0",title:"Version 2.3.0",slug:"/v2.3.0/",sidebar_position:9972},s=void 0,a={id:"notes/release-notes-v2.3.0",title:"Version 2.3.0",description:"Released on : xx/xx/2025",source:"@site/release_notes/notes/V2.3.0.md",sourceDirName:"notes",slug:"/v2.3.0/",permalink:"/release-notes/v2.3.0/",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:9972,frontMatter:{id:"release-notes-v2.3.0",title:"Version 2.3.0",slug:"/v2.3.0/",sidebar_position:9972},sidebar:"release_notes",previous:{title:"Introduction",permalink:"/release-notes/"},next:{title:"Version 2.2.0",permalink:"/release-notes/v2.2.0/"}},c={},d=[{value:"Features",id:"features",level:2},{value:"Indexation improvement",id:"indexation-improvement",level:3},{value:"Restriction to one category per OAIS product",id:"restriction-to-one-category-per-oais-product",level:3},{value:"Improved Naming and Layout of Delivery Files",id:"improved-naming-and-layout-of-delivery-files",level:3},{value:"Breaking change",id:"breaking-change",level:2},{value:"Deployment",id:"deployment",level:3},{value:"Database",id:"database",level:3},{value:"OAIS Category change",id:"oais-category-change",level:4},{value:"Index changes",id:"index-changes",level:4},{value:"Rest API",id:"rest-api",level:3},{value:"Service configuration",id:"service-configuration",level:3},{value:"AMQP API",id:"amqp-api",level:3},{value:"Bug fixes",id:"bug-fixes",level:2}];function l(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["Released on : xx/xx/2025",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.a,{href:"https://www.gnu.org/licenses/gpl-3.0",children:(0,t.jsx)(n.img,{src:"https://img.shields.io/badge/License-GPLv3-blue.svg",alt:"License: GPL v3"})}),"\n",(0,t.jsx)(n.strong,{children:"Operational version"})]}),"\n",(0,t.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,t.jsx)(n.h3,{id:"indexation-improvement",children:"Indexation improvement"}),"\n",(0,t.jsxs)(n.p,{children:["Elastic entities insertions are now asynchronous. It is now recommended to increase the size of the Elasticsearch\nconnection pool to handle the higher level of parallelism. See the ",(0,t.jsx)(n.a,{href:"../docs/next/development/services/dam/configuration/static-configuration#ansible-editable-properties",children:"configuration guide"}),"\nfor details on how to configure this value (regards.jpa.multitenant.maxPoolSize and regards.elasticsearch.threadpool.size)."]}),"\n",(0,t.jsxs)(n.p,{children:["Multiple insertion tasks can now run at the same time.\nDepending on the size of the inserted products and the microservice\u2019s allocated memory, you may need to reduce the configured insertion batch size of the rs-dam microservice (",(0,t.jsx)(n.strong,{children:"regards.crawler.max.bulk.size"})," in ",(0,t.jsx)(n.em,{children:"rs-dam.properties"}),") if you encounter memory errors."]}),"\n",(0,t.jsxs)(n.p,{children:["The new Elasticsearch reindexing does not introduce any breaking changes.\nHowever, there are now recommendations regarding the following ",(0,t.jsx)(n.strong,{children:"naming conventions"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["There is now a default Elasticsearch alias named ",(0,t.jsx)(n.strong,{children:"[tenant]_alias"}),".\nIf you use a custom Elasticsearch alias, make sure it does ",(0,t.jsx)(n.strong,{children:"not"})," use this name."]}),"\n",(0,t.jsxs)(n.li,{children:["In the configuration of crawling datasources , do ",(0,t.jsx)(n.strong,{children:"not"})," use a ",(0,t.jsx)(n.strong,{children:"label"})," or ",(0,t.jsx)(n.strong,{children:"ID"})," ending with the string ",(0,t.jsx)(n.strong,{children:'"_building"'}),",  as this\nsuffix is reserved for a specific category of ingestions used during reindexing."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Due to a limitation in the Elasticsearch 7 client, applying access rights may take longer than the default timeout configured in the rs-dam microservice (",(0,t.jsx)(n.strong,{children:"regards.elasticsearch.index.request.timeout"})," in ",(0,t.jsx)(n.em,{children:"rs-dam.properties"}),"). When the timeout is reached, the aspiration process will exit with an error, even though Elasticsearch continues applying the access rights in the background. In reality, the aspiration is typically successful.\nTo avoid this false-negative outcome, you can significantly increase the timeout value."]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"It is now forbidden to delete an index or an alias directly in Elasticsearch."}),"\n",(0,t.jsx)(n.li,{children:"When querying Elasticsearch directly to perform catalog searches, you must now use the alias name instead of the\nindex name."}),"\n",(0,t.jsx)(n.li,{children:"During reindexing, Elasticsearch server will require twice as much disk space as during normal use. Make sure you\nhave enough free space allocated to ElasticSearch for the reindexing to complete successfully."}),"\n"]})}),"\n",(0,t.jsx)(n.h3,{id:"restriction-to-one-category-per-oais-product",children:"Restriction to one category per OAIS product"}),"\n",(0,t.jsx)(n.p,{children:"The ability to associate several categories per OAIS product has never been used, so the data structure and APIs\nhave been modified to permit only one category per product. This restriction allows some performance improvements\nduring crawling on OAIS products, and in the administration interface."}),"\n",(0,t.jsx)(n.h3,{id:"improved-naming-and-layout-of-delivery-files",children:"Improved Naming and Layout of Delivery Files"}),"\n",(0,t.jsxs)(n.p,{children:["The name and structure of the zip files generated by the delivery service have evolved. The new naming conventions\nare described ",(0,t.jsx)(n.a,{href:"../docs/next/user-guide/order-data/settings-delivery#format-de-livraison",children:"in the documentation"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"breaking-change",children:"Breaking change"}),"\n",(0,t.jsx)(n.h3,{id:"deployment",children:"Deployment"}),"\n",(0,t.jsxs)(n.p,{children:["You need to follow the ",(0,t.jsx)(n.a,{href:"../../docs/next/setup/swarm/migration/2.2-to-2.3",children:"Ansible migration guide"})," to update your\nplaybook from V2.2.0 to V2.3.0."]}),"\n",(0,t.jsx)(n.h3,{id:"database",children:"Database"}),"\n",(0,t.jsx)(n.h4,{id:"oais-category-change",children:"OAIS Category change"}),"\n",(0,t.jsxs)(n.p,{children:["The database tables ",(0,t.jsx)(n.code,{children:"ingest.t_sip"})," and ",(0,t.jsx)(n.code,{children:"ingest.t_aip"})," have changed: the ",(0,t.jsx)(n.code,{children:"categories"})," column (format jsonb) is replaced\nby a ",(0,t.jsx)(n.code,{children:"category"})," column (format varchar 128). After first deploying the 2.3.0 version of the service, the data\nwill be moved to the new column. If the ",(0,t.jsx)(n.code,{children:"categories"})," column contained a list of a single category, it will be\ntransferred to the new column. If it contained several categories, only the first one will be preserved."]}),"\n",(0,t.jsxs)(n.p,{children:["The change is automatic on updating the service, but may take a long time depending on the number of products.\nIf the script takes too long, the service may restart before the migration finishes. In this case the migration\nwill continue from where it was when the service restarts. It may happen several times, until it eventually\ncompletes the migration.\nTo avoid any problem during the migration, we provide a script to manually modify these 2 tables, to be executed\nafter shutdown of the current system and before the restart in the new version: see the\n",(0,t.jsx)(n.a,{href:"../../docs/next/setup/swarm/migration/2.2-to-2.3",children:"Ansible migration guide"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Similarly for the acquisition chains in service ",(0,t.jsx)(n.code,{children:"dataprovider"}),": the table ",(0,t.jsx)(n.code,{children:"dataprovider.t_acq_processing_chain"}),"\nhas had its ",(0,t.jsx)(n.code,{children:"categories"})," column replaced by a ",(0,t.jsx)(n.code,{children:"category"})," column. The change is automatic on updating the service\nand the data is migrated automatically. If the ",(0,t.jsx)(n.code,{children:"categories"})," column contained a list of a single category,\nit will be transferred to the new column. If it contained several categories, only the first one will be preserved."]}),"\n",(0,t.jsx)(n.h4,{id:"index-changes",children:"Index changes"}),"\n",(0,t.jsxs)(n.p,{children:["An index was added in the table ",(0,t.jsx)(n.code,{children:"ingest.t_aip"})," on (",(0,t.jsx)(n.code,{children:"last_update"}),", ",(0,t.jsx)(n.code,{children:"id"}),") to improve the performance\nof aspirations of OAIS products.\nAn index was replaced in the table ",(0,t.jsx)(n.code,{children:"fem.t_feature"})," on (",(0,t.jsx)(n.code,{children:"model"}),", ",(0,t.jsx)(n.code,{children:"last_update"}),") by a new one on (",(0,t.jsx)(n.code,{children:"model"}),", ",(0,t.jsx)(n.code,{children:"last_update"}),", ",(0,t.jsx)(n.code,{children:"id"}),")\nto improve the performance of aspirations of GeoJson products.\nThese changes are automatic on updating the service, but may take a long time depending on the number of products.\nTo avoid any problem during the migration, the script provided for the OAIS Category change above can be used,\nit also performs the update to the indexes.\nTo be executed after shutdown of the current system and before the restart in the new version:\nSee the ",(0,t.jsx)(n.a,{href:"../../docs/next/setup/swarm/migration/2.2-to-2.3",children:"Ansible migration guide"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"rest-api",children:"Rest API"}),"\n",(0,t.jsx)(n.p,{children:"The OAIS product manager modification API (rs-ingest/aips/update) no longer allows to set multiple categories on a product.\nRequests to add a category to a product that already has one, or to add multiple categories will be ignored.\nIt is still possible to replace an existing category by removing it and adding another one at the same time."}),"\n",(0,t.jsx)(n.h3,{id:"service-configuration",children:"Service configuration"}),"\n",(0,t.jsxs)(n.p,{children:["The format for the configuration file for the ",(0,t.jsx)(n.code,{children:"rs-dataprovider"})," service has changed following the change\nto a single category.\nWhen specifying an AcquisitionProcessingChain in the configuration, the ",(0,t.jsx)(n.code,{children:"categories"})," attribute must be replaced\nby a ",(0,t.jsx)(n.code,{children:"category"})," attribute containing a single string."]}),"\n",(0,t.jsx)(n.h3,{id:"amqp-api",children:"AMQP API"}),"\n",(0,t.jsxs)(n.p,{children:["OAIS products for rs-ingest no longer allow multiple categories. To allow retro-compatibility, a product can have either\na string ",(0,t.jsx)(n.code,{children:"category"})," field, or a list ",(0,t.jsx)(n.code,{children:"categories"})," field with a single category, but not both.\nThe use of the ",(0,t.jsx)(n.code,{children:"categories"})," field is deprecated."]}),"\n",(0,t.jsxs)(n.p,{children:["The OAISMigrationWorker no longer allows multiple categories in a product. To allow retro-compatibility,\na product can have either a string ",(0,t.jsx)(n.code,{children:"category"})," field, or a list ",(0,t.jsx)(n.code,{children:"categories"})," field with a single category,\nbut not both. The use of the ",(0,t.jsx)(n.code,{children:"categories"})," field is deprecated."]}),"\n",(0,t.jsx)(n.h2,{id:"bug-fixes",children:"Bug fixes"})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>a});var t=i(96540);const r={},o=t.createContext(r);function s(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);