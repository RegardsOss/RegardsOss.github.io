"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[5862],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>f});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var u=n.createContext({}),l=function(e){var t=n.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},p=function(e){var t=l(e.components);return n.createElement(u.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,u=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=l(r),c=a,f=d["".concat(u,".").concat(c)]||d[c]||m[c]||o;return r?n.createElement(f,s(s({ref:t},p),{},{components:r})):n.createElement(f,s({ref:t},p))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,s=new Array(o);s[0]=c;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i[d]="string"==typeof e?e:a,s[1]=i;for(var l=2;l<o;l++)s[l]=r[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},36578:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var n=r(87462),a=(r(67294),r(3905));const o={id:"backend-amqp-subscribe-to-requests-response",title:"Monitor FEM requests progress",sidebar_label:"Subscribe to requests responses",slug:"/development/backend/services/fem/guides/amqp/subscribe-to-requests-responses"},s=void 0,i={unversionedId:"development/backend/regards/fem/api-guides/amqp/backend-amqp-subscribe-to-requests-response",id:"version-1.15/development/backend/regards/fem/api-guides/amqp/backend-amqp-subscribe-to-requests-response",title:"Monitor FEM requests progress",description:"AMQP monitoring API...",source:"@site/versioned_docs/version-1.15/development/backend/regards/fem/api-guides/amqp/amqp-subscribe-request-response.md",sourceDirName:"development/backend/regards/fem/api-guides/amqp",slug:"/development/backend/services/fem/guides/amqp/subscribe-to-requests-responses",permalink:"/docs/development/backend/services/fem/guides/amqp/subscribe-to-requests-responses",draft:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/versioned_docs/version-1.15/development/backend/regards/fem/api-guides/amqp/amqp-subscribe-request-response.md",tags:[],version:"1.15",frontMatter:{id:"backend-amqp-subscribe-to-requests-response",title:"Monitor FEM requests progress",sidebar_label:"Subscribe to requests responses",slug:"/development/backend/services/fem/guides/amqp/subscribe-to-requests-responses"},sidebar:"dev",previous:{title:"Publish patch request",permalink:"/docs/development/backend/services/fem/guides/amqp/publish-a-patch-request"},next:{title:"Create product",permalink:"/docs/development/backend/fem/guides/rest/create-product"}},u={},l=[{value:"AMQP monitoring API...",id:"amqp-monitoring-api",level:2},{value:"Example of DENIED request",id:"example-of-denied-request",level:4},{value:"Example of GRANTED request",id:"example-of-granted-request",level:4},{value:"Example of SUCCESS request",id:"example-of-success-request",level:4},{value:"Example of ERROR request",id:"example-of-error-request",level:4},{value:"...For feature module",id:"for-feature-module",level:3},{value:"...For featureprovider module",id:"for-featureprovider-module",level:3}],p={toc:l},d="wrapper";function m(e){let{components:t,...r}=e;return(0,a.kt)(d,(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"amqp-monitoring-api"},"AMQP monitoring API..."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Feature manager")," microservice publishes AMQP messages to monitor request lifecycle."),(0,a.kt)("p",null,"Messages are published to two different exchanges because under the hood ",(0,a.kt)("inlineCode",{parentName:"p"},"Feature manager")," is in reality composed of two modules: ",(0,a.kt)("inlineCode",{parentName:"p"},"feature")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"featureprovider"),". Whatever the exchange to which those monitoring messages are comming from, they have the same structure, that is:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"requestId")," (corresponds to ",(0,a.kt)("inlineCode",{parentName:"li"},"regards.request.id")," header),"),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"requestOwner")," (corresponds to ",(0,a.kt)("inlineCode",{parentName:"li"},"regards.request.owner")," header),"),(0,a.kt)("li",{parentName:"ul"},"The related feature ",(0,a.kt)("inlineCode",{parentName:"li"},"id")," (not specified for ",(0,a.kt)("inlineCode",{parentName:"li"},"EXTRACTION")," requests because feature is not yet created),"),(0,a.kt)("li",{parentName:"ul"},"The related feature ",(0,a.kt)("inlineCode",{parentName:"li"},"urn")," (not specified for ",(0,a.kt)("inlineCode",{parentName:"li"},"EXTRACTION")," requests because feature is not yet created),"),(0,a.kt)("li",{parentName:"ul"},"The request type (",(0,a.kt)("inlineCode",{parentName:"li"},"EXTRACTION"),",",(0,a.kt)("inlineCode",{parentName:"li"},"CREATION"),",",(0,a.kt)("inlineCode",{parentName:"li"},"PATCH"),",",(0,a.kt)("inlineCode",{parentName:"li"},"DELETION"),",",(0,a.kt)("inlineCode",{parentName:"li"},"NOTIFICATION"),",",(0,a.kt)("inlineCode",{parentName:"li"},"FILE_COPY"),",",(0,a.kt)("inlineCode",{parentName:"li"},"SAVE_METADATA"),")"),(0,a.kt)("li",{parentName:"ul"},"The state of the request (",(0,a.kt)("inlineCode",{parentName:"li"},"GRANTED"),",",(0,a.kt)("inlineCode",{parentName:"li"},"DENIED"),",",(0,a.kt)("inlineCode",{parentName:"li"},"ERROR")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"SUCCESS"),"),"),(0,a.kt)("li",{parentName:"ul"},"A list of ",(0,a.kt)("inlineCode",{parentName:"li"},"errors")," if any.")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"To receive these messages, your have to subscribe to this exchange.")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"EXTRACTION")," process does not create features. So if you want to know the created feature id or urn, you have to listen to responses from the ",(0,a.kt)("inlineCode",{parentName:"p"},"CREATION")," process which has the same ",(0,a.kt)("inlineCode",{parentName:"p"},"requestId")," than the corresponding ",(0,a.kt)("inlineCode",{parentName:"p"},"EXTRACTION")," request.")),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"If AMQP virtual host mode is set to ",(0,a.kt)("inlineCode",{parentName:"p"},"SINGLE"),", this exchange will receive all messages of all tenants! So the receiver may have to filter them according to the tenant he wishes to manage.")),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Requests without ",(0,a.kt)("inlineCode",{parentName:"p"},"requestId")," can be routed to AMQP Dead Letter Queue (DLQ) so no response will be published. However, a notification is sent to the administrators of the project in order to tell them to inspect DLQ.")),(0,a.kt)("h4",{id:"example-of-denied-request"},"Example of DENIED request"),(0,a.kt)("p",null,"|:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "requestId": "{requestId}",\n    "requestOwner": "{requestOwner}",\n    "id": "{featureId}",\n    "type": "{requestType}",\n    "state": "DENIED",\n    "errors": ["error1", "error2"]\n}\n')),(0,a.kt)("h4",{id:"example-of-granted-request"},"Example of GRANTED request"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "requestId": "{requestId}",\n    "requestOwner": "{requestOwner}",\n    "id": "{featureId}",\n    "type": "{requestType}",\n    "state": "GRANTED"\n}\n')),(0,a.kt)("h4",{id:"example-of-success-request"},"Example of SUCCESS request"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "requestId": "{requestId}",\n    "requestOwner": "{requestOwner}",\n    "id": "{featureId}",\n    "urn": "{featureGeneratedUrn}",\n    "type": "{requestType}",\n    "state": "SUCCESS"\n}\n')),(0,a.kt)("h4",{id:"example-of-error-request"},"Example of ERROR request"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "requestId": "{requestId}",\n    "requestOwner": "{requestOwner}",\n    "id": "{featureId}",\n    "urn": "{featureGeneratedUrn}",\n    "type": "{requestType}",\n    "state": "ERROR",\n    "errors": ["error1", "error2"]\n}\n')),(0,a.kt)("h3",{id:"for-feature-module"},"...For feature module"),(0,a.kt)("p",null,"Messages are published on this exchange : ",(0,a.kt)("inlineCode",{parentName:"p"},"regards.broadcast.fr.cnes.regards.modules.feature.dto.event.out.FeatureRequestEvent")),(0,a.kt)("h3",{id:"for-featureprovider-module"},"...For featureprovider module"),(0,a.kt)("p",null,"Messages are published on this exchange : ",(0,a.kt)("inlineCode",{parentName:"p"},"regards.broadcast.fr.cnes.regards.modules.featureprovider.domain.FeatureExtractionResponseEvent")),(0,a.kt)("p",null,"In other words, it means that to migrate from ",(0,a.kt)("strong",{parentName:"p"},"V1.3.x")," to ",(0,a.kt)("strong",{parentName:"p"},"V1.4.0"),", you need to change the exchange to which you subscribe to receive extraction monitoring messages. Or you might be able to configure your AMQP broker to automatically redirect messages from this exchange to the old one (",(0,a.kt)("inlineCode",{parentName:"p"},"regards.broadcast.fr.cnes.regards.modules.feature.dto.event.out.FeatureRequestEvent"),")."))}m.isMDXComponent=!0}}]);