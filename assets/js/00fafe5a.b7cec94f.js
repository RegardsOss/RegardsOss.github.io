"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[29801],{14529:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>d,toc:()=>l});var t=i(74848),r=i(28453);const s={title:"Import/Export service configuration",sidebar_label:"Services configuration",slug:"/development/services/common/common-import-export-configuration"},o=void 0,d={id:"development/services/common/import-export-configuration",title:"Import/Export service configuration",description:"Many REGARDS microservices provide a REST API to import and export configuration in Json format.",source:"@site/docs/development/services/common/import-export-configuration.md",sourceDirName:"development/services/common",slug:"/development/services/common/common-import-export-configuration",permalink:"/docs/next/development/services/common/common-import-export-configuration",draft:!1,unlisted:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/docs/development/services/common/import-export-configuration.md",tags:[],version:"current",frontMatter:{title:"Import/Export service configuration",sidebar_label:"Services configuration",slug:"/development/services/common/common-import-export-configuration"},sidebar:"dev",previous:{title:"common-metrics",permalink:"/docs/next/development/services/common/common-metrics"},next:{title:"Overview",permalink:"/docs/next/development/services/access-instance/overview"}},c={},l=[{value:"REST API",id:"rest-api",level:2},{value:"How to",id:"how-to",level:3},{value:"Endpoint",id:"endpoint",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Configuration file format",id:"configuration-file-format",level:3},{value:"Settings configuration section",id:"settings-configuration-section",level:4},{value:"Plugin configuration section",id:"plugin-configuration-section",level:4},{value:"Response",id:"response",level:3}];function a(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Many REGARDS microservices provide a REST API to import and export configuration in Json format."}),"\n",(0,t.jsx)(n.h2,{id:"rest-api",children:"REST API"}),"\n",(0,t.jsx)(n.h3,{id:"how-to",children:"How to"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.a,{href:"/docs/next/development/concepts/rest-api/",children:"Regards REST API concept"})," describes how REST interfaces must be handled to\nsubmit requests."]}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsx)(n.p,{children:"The easiest way to use the import/export configuration system is to first download the configuration file of the\nwanted microservice rather than trying to write it from scratch. The configuration file format is pretty hard to understand\nfrom\nscratch."})}),"\n",(0,t.jsx)(n.h3,{id:"endpoint",children:"Endpoint"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Endpoint"}),(0,t.jsx)(n.th,{children:"Verb"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"/microservice/configuration"}),(0,t.jsx)(n.td,{children:"POST"}),(0,t.jsx)(n.td,{children:"Import configuration by providing a json file"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"/microservice/configuration"}),(0,t.jsx)(n.td,{children:"GET"}),(0,t.jsx)(n.td,{children:"Export configuration by downloading a json file"})]})]})]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"By default these endpoints are only available to project administrators."})}),"\n",(0,t.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsxs)(n.p,{children:["For Import, add your file in a multipart request using the name ",(0,t.jsx)(n.code,{children:"file"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title="Example of curl request to import configuration"',children:"curl https://regards.fr/api/v1/rs-dam/microservice/configuration  \\\n  --form file='@/home/myuser/tmp/rs-dam-configuration.json' \\\n  -H 'Authorization: Bearer <token>'\n"})}),"\n",(0,t.jsx)(n.h3,{id:"configuration-file-format",children:"Configuration file format"}),"\n",(0,t.jsxs)(n.p,{children:["Configuration files have the same format for all microservice.",(0,t.jsx)(n.br,{}),"\n","It describes the configuration for every ",(0,t.jsx)(n.strong,{children:"Module"})," of the microservice."]}),"\n",(0,t.jsx)(n.p,{children:"Here's a simple example of the basic structure of this file :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:"{8-12}",children:'{\n  "microservice": "rs-notifier",\n  "modules": [\n    {\n      "module": {\n        "id": "notifier"\n      },\n      "resetBeforeImport": true,\n      "configuration": [\n        ...\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"In each module, you have to provide two parameters."}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"resetBeforeImport"}),(0,t.jsx)(n.td,{children:"Boolean"}),(0,t.jsx)(n.td,{children:"Indicates if the previous module configuration should be deleted before importing the new one."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"configuration"}),(0,t.jsx)(n.td,{children:"Object"}),(0,t.jsx)(n.td,{children:"Module specific format configuration"})]})]})]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["If the ",(0,t.jsx)(n.strong,{children:"resetBeforeImport"})," is set to ",(0,t.jsx)(n.code,{children:"false"}),", the microservice will try to merge the previous and new configurations."]})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"Configuration"})," section may contain two common types of configuration  :"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Settings"})," : Parameters with custom values"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Plugins configurations"})," : Specific format for plugins to define their configuration"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["A microservice can also provide custom configuration parameters in this configuration file.",(0,t.jsx)(n.br,{}),"\n","For information on those parameters, please refer to the microservice configuration section of documentation."]}),"\n",(0,t.jsx)(n.h4,{id:"settings-configuration-section",children:"Settings configuration section"}),"\n",(0,t.jsxs)(n.p,{children:["Each setting parameter section start with ",(0,t.jsx)(n.code,{children:"key"})," :"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"fr.cnes.regards.framework.modules.tenant.settings.domain.DynamicTenantSetting"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"value"})," contains information about the settings with the parameters listed below :"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"Should be edited"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"name"}),(0,t.jsx)(n.td,{children:"String"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:"Name of the setting"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"description"}),(0,t.jsx)(n.td,{children:"String"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:"Simple description of the setting purpose"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"value"}),(0,t.jsx)(n.td,{children:"String"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(n.td,{children:"Serialized value of the setting"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"defaultValue"}),(0,t.jsx)(n.td,{children:"String"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:"Serialized default value of the setting (used if value is not provided)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"className"}),(0,t.jsx)(n.td,{children:"String"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:"Java class name used to deserialize setting value"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"containsSensitiveParameters"}),(0,t.jsx)(n.td,{children:"Boolean"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:"Indicates if setting value should be encrypted in DataBase"})]})]})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="DynamicTenantSetting example"',children:'{\n  "key": "fr.cnes.regards.framework.modules.tenant.settings.domain.DynamicTenantSetting",\n  "value": {\n    "name": "setting_name",\n    "description": "setting description",\n    "value": "\\"value\\"",\n    "defaultValue": "\\"default\\"",\n    "className": "java.lang.String",\n    "containsSensitiveParameters": false\n  }\n},\n'})}),"\n",(0,t.jsx)(n.h4,{id:"plugin-configuration-section",children:"Plugin configuration section"}),"\n",(0,t.jsxs)(n.p,{children:["Each setting parameter section start with ",(0,t.jsx)(n.code,{children:"key"}),":"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"fr.cnes.regards.framework.modules.plugins.domain.PluginConfiguration"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"value"})," contains information about the settings with the parameters listed below :"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"Can be edited"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"pluginId"}),(0,t.jsx)(n.td,{children:"String"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:"Plugin unique identifier"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"businessId"}),(0,t.jsx)(n.td,{children:"String"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(n.td,{children:"Configuration unique identifier"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"label"}),(0,t.jsx)(n.td,{children:"String"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(n.td,{children:"Configuration label (displayed in admin UI)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"version"}),(0,t.jsx)(n.td,{children:"String"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:"Configuration version"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"priorityOrder"}),(0,t.jsx)(n.td,{children:"Integer"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsxs)(n.td,{children:["Priority of the configuration. ",(0,t.jsx)("br",{}),"Can be used by service if there are more than one configuration for a plugin."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"active"}),(0,t.jsx)(n.td,{children:"Boolean"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsxs)(n.td,{children:["True to activate the configuration. ",(0,t.jsx)("br",{}),"If false, service will not be allowed to use this configuration."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"parameters"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"List<Parameter\\>"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(n.td,{children:"Plugin configuration specific parameters"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"parameters"})," section contains a list of formated parameters. Parameters depends on the plugin you want to\nconfigure and include :"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"name"}),(0,t.jsx)(n.td,{children:"String"}),(0,t.jsx)(n.td,{children:"Plugin parameter name"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"type"}),(0,t.jsx)(n.td,{children:"String"}),(0,t.jsxs)(n.td,{children:["Plugin parameter ",(0,t.jsx)(n.code,{children:"TYPE"})," can be ",(0,t.jsx)("br",{})," ",(0,t.jsx)(n.code,{children:"STRING"}),", ",(0,t.jsx)(n.code,{children:"BYTE"}),", ",(0,t.jsx)(n.code,{children:"SHORT"}),", ",(0,t.jsx)(n.code,{children:"INTEGER"}),", ",(0,t.jsx)(n.code,{children:"LONG"}),", ",(0,t.jsx)(n.code,{children:"FLOAT"}),",",(0,t.jsx)("br",{})," ",(0,t.jsx)(n.code,{children:"DOUBLE"}),", ",(0,t.jsx)(n.code,{children:"BOOLEAN"}),", ",(0,t.jsx)(n.code,{children:"MAP"}),", ",(0,t.jsx)(n.code,{children:"COLLECTION"}),", ",(0,t.jsx)(n.code,{children:"POJO"}),", ",(0,t.jsx)(n.code,{children:"PLUGIN"})," and ",(0,t.jsx)(n.code,{children:"REGARDS_ENTITY_MODEL"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"value"}),(0,t.jsx)(n.td,{children:"Object"}),(0,t.jsx)(n.td,{children:"Value of the parameter depending on previous type attribute."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"dynamic"}),(0,t.jsx)(n.td,{children:"Boolean"}),(0,t.jsx)(n.td,{children:"Indicates if the parameter value can be provided at plugin runtime or if it is a static configuration value"})]})]})]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"If a plugin parameter is configured to be dynamic, then the value will be requested at runtime if the service allows it\nIn order to know parameters that can be set as dynamic, see the microservice plugins documentation."})}),"\n",(0,t.jsx)(n.p,{children:"Example :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "key": "fr.cnes.regards.framework.modules.plugins.domain.PluginConfiguration",\n  "value": {\n    "pluginId": "DisseminationAckSender",\n    "label": "Ack dissemination configuration",\n    "businessId": "ack-conf-001",\n    "version": "2.0.0",\n    "priorityOrder": 0,\n    "active": true,\n    "parameters": [\n      {\n        "name": "recipientLabel",\n        "type": "STRING",\n        "value": "regards",\n        "dynamic": false\n      },\n      {\n        "name": "ackRequired",\n        "type": "BOOLEAN",\n        "value": false,\n        "dynamic": false\n      }\n    ]\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"response",children:"Response"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Code:"})," 201 CREATED"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>d});var t=i(96540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);