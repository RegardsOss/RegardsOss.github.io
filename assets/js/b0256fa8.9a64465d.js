"use strict";(self.webpackChunkregardsoss_github_io=self.webpackChunkregardsoss_github_io||[]).push([[74511],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return k}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),l=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=d(e,["components","mdxType","originalType","parentName"]),c=l(n),k=r,g=c["".concat(s,".").concat(k)]||c[k]||m[k]||i;return n?a.createElement(g,o(o({ref:t},p),{},{components:n})):a.createElement(g,o({ref:t},p))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var d={};for(var s in t)hasOwnProperty.call(t,s)&&(d[s]=t[s]);d.originalType=e,d.mdxType="string"==typeof e?e:r,o[1]=d;for(var l=2;l<i;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},92059:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return k},frontMatter:function(){return d},metadata:function(){return l},toc:function(){return m}});var a=n(83117),r=n(80102),i=(n(67294),n(3905)),o=["components"],d={id:"swarm-start",title:"Getting started with Docker Swarm using Ansible",sidebar_label:"Docker Swarm",slug:"/setup/deprecated/swarm/start/"},s=void 0,l={unversionedId:"setup/deprecated/swarm-start",id:"version-1.5.0/setup/deprecated/swarm-start",title:"Getting started with Docker Swarm using Ansible",description:"The Ansible & Swarm deployment is in early stage and may not be publicly available at the time we publish this documentation",source:"@site/versioned_docs/version-1.5.0/setup/deprecated/swarm.md",sourceDirName:"setup/deprecated",slug:"/setup/deprecated/swarm/start/",permalink:"/docs/1.5.0/setup/deprecated/swarm/start/",draft:!1,editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/versioned_docs/version-1.5.0/setup/deprecated/swarm.md",tags:[],version:"1.5.0",frontMatter:{id:"swarm-start",title:"Getting started with Docker Swarm using Ansible",sidebar_label:"Docker Swarm",slug:"/setup/deprecated/swarm/start/"}},p={},m=[{value:"Requirements",id:"requirements",level:2},{value:"Software requirements",id:"software-requirements",level:3},{value:"Settings &amp; Environnement",id:"settings--environnement",level:3},{value:"COTS versions",id:"cots-versions",level:3},{value:"Users",id:"users",level:3},{value:"Ansible",id:"ansible",level:2},{value:"Get the source",id:"get-the-source",level:3},{value:"Create your inventory",id:"create-your-inventory",level:3},{value:"Inventory configuration",id:"inventory-configuration",level:3},{value:"Deploy",id:"deploy",level:2}],c={toc:m};function k(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The Ansible & Swarm deployment is in early stage and may not be publicly available at the time we publish this documentation"))),(0,i.kt)("h1",{id:"install"},"Install"),(0,i.kt)("p",null,"Let's install REGARDS on a swarm server !"),(0,i.kt)("h2",{id:"requirements"},"Requirements"),(0,i.kt)("p",null,"We won't treat here how to setup these requirements as they have some good tutorials outhere."),(0,i.kt)("h3",{id:"software-requirements"},"Software requirements"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Ansible ",(0,i.kt)("inlineCode",{parentName:"li"},"2.6.2")," at least"),(0,i.kt)("li",{parentName:"ul"},"Docker ",(0,i.kt)("inlineCode",{parentName:"li"},"19.03.8")," at least"),(0,i.kt)("li",{parentName:"ul"},"Redhat ",(0,i.kt)("inlineCode",{parentName:"li"},"CentOS_7.6.1810")," or equivalent"),(0,i.kt)("li",{parentName:"ul"},"REGARDS ",(0,i.kt)("inlineCode",{parentName:"li"},"1.1.0")," at least")),(0,i.kt)("h3",{id:"settings--environnement"},"Settings & Environnement"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"/var/lib/docker")," must exists"),(0,i.kt)("li",{parentName:"ul"},"You must provide a network volume (",(0,i.kt)("inlineCode",{parentName:"li"},"NFS")," or equivalent) to swarm workers"),(0,i.kt)("li",{parentName:"ul"},"A Docker registry with our images pushed"),(0,i.kt)("li",{parentName:"ul"},"An user having ",(0,i.kt)("strong",{parentName:"li"},"sudo rights")," and access to the Docker registry"),(0,i.kt)("li",{parentName:"ul"},"Docker is setup with user namespace"),(0,i.kt)("li",{parentName:"ul"},"Swarm workers are connected to master"),(0,i.kt)("li",{parentName:"ul"},"Either an access to mutualised COTS, or the right configuration on the host. We already treat the basic setup of these COTS ","[here]",", you need to look for ",(0,i.kt)("inlineCode",{parentName:"li"},"kernel.shmmax"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"vm.max_map_count"))),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The root access is required to install files using Ansible with specific owner. You can release such user access after Ansible installation."))),(0,i.kt)("h3",{id:"cots-versions"},"COTS versions"),(0,i.kt)("p",null,"We expected these COTS:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Postgres ",(0,i.kt)("inlineCode",{parentName:"li"},"11.5")),(0,i.kt)("li",{parentName:"ul"},"RabbitMQ ",(0,i.kt)("inlineCode",{parentName:"li"},"3.8.2")),(0,i.kt)("li",{parentName:"ul"},"ElasticSearch ",(0,i.kt)("inlineCode",{parentName:"li"},"6.5.0"))),(0,i.kt)("h3",{id:"users"},"Users"),(0,i.kt)("p",null,"First usecase: there is an IPA managing users / groups on your targeted VMs. We want a secure installation where accessing and managing data are splitted into two differents groups."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},"User"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Group"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Description"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Tips"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"dockermapuid")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"dockermapgid")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Used by the docker daemon"),(0,i.kt)("td",{parentName:"tr",align:"center"},"This group is internal to the server")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"}),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"gregards_admin")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Regroup all users that are allowed to monitor the stack"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative, ",(0,i.kt)("inlineCode",{parentName:"td"},"johndoe")," can also replace this one")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"docker-regards-data")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"gregards_data")),(0,i.kt)("td",{parentName:"tr",align:"center"},"IPA User/Group owning all files created by REGARDS"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Your user should be inside that group")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"johndoe")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"johndoe"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"dockermapgid"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"gregards_admin"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"gregards_data")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Your personnal user"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Your user has access to Docker, to the stack and data")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"mariecurie")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"mariecurie"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"gregards_data")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Some user"),(0,i.kt)("td",{parentName:"tr",align:"center"},"She has access to data, not the stack itself")))),(0,i.kt)("p",null,"Other usecase. You install everything as root, you don't have an IPA."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},"User"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Group"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Description"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Tips"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"dockermapuid")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"dockermapgid")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Used by the docker daemon"),(0,i.kt)("td",{parentName:"tr",align:"center"})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"docker-regards-data")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"gregards_data")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Local User/Group owning all files created by REGARDS"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Even with root install, we still respect Docker user namespace !!")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"root")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"root")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Used to install and run the stack"),(0,i.kt)("td",{parentName:"tr",align:"center"})))),(0,i.kt)("h2",{id:"ansible"},"Ansible"),(0,i.kt)("h3",{id:"get-the-source"},"Get the source"),(0,i.kt)("p",null,"The repository is not public yet !"),(0,i.kt)("p",null,"You will find :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"inventories"),": stores where and what you want to install"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"roles"),": stores Ansible tasks"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"regards.yml"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"regards-*.yml"),",... that links roles and tags to execute")),(0,i.kt)("h3",{id:"create-your-inventory"},"Create your inventory"),(0,i.kt)("p",null,"Let's create our new inventory. You should create a new inventory each time you deploy REGARDS on a new stack.",(0,i.kt)("br",{parentName:"p"}),"\n","In this guide, we'll create a new inventory named ",(0,i.kt)("inlineCode",{parentName:"p"},"prod-regards-cnes")," (",(0,i.kt)("inlineCode",{parentName:"p"},"<dev|prod>-<swarm-master-hostname>"),")"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cd playbooks/inventories/\nmkdir prod-regards-cnes\n")),(0,i.kt)("p",null,"Now you can create the ",(0,i.kt)("inlineCode",{parentName:"p"},"hosts")," file ",(0,i.kt)("inlineCode",{parentName:"p"},"playbooks/inventories/prod-regards-cnes/hosts")," with the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-env"},"[master]\nswarm-host ansible_host=regards-cnes-d21-myorganisation.com\n\n[slaves]\nswarm-worker-1 ansible_host=regards-cnes-d22-myorganisation.com\nswarm-worker-2 ansible_host=regards-cnes-d23-myorganisation.com\n\n[postgres]\nswarm-worker-1\n\n[rabbitmq]\nswarm-worker-1\n\n[elasticsearch]\nswarm-worker-2\n")),(0,i.kt)("p",null,"Let's see this step by step :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-env"},"[master]\nswarm-host ansible_host=regards-cnes-d21-myorganisation.com\n")),(0,i.kt)("p",null,"Here we create inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"master")," tag a node named ",(0,i.kt)("inlineCode",{parentName:"p"},"swarm-host"),". We provide the ",(0,i.kt)("inlineCode",{parentName:"p"},"ansible_host"),", but we do not provide ",(0,i.kt)("inlineCode",{parentName:"p"},"ansible_user=root")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"ansible_password=rootpassword"),", so Ansible will use the current user (and doesn't expect password prompt)."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-env"},"[slaves]\nswarm-worker-1 ansible_host=regards-cnes-d22-myorganisation.com\nswarm-worker-2 ansible_host=regards-cnes-d23-myorganisation.com\n")),(0,i.kt)("p",null,"Then we create two nodes ",(0,i.kt)("inlineCode",{parentName:"p"},"swarm-worker-1")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"swarm-worker-2")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"slaves")," tag. We need to provide a way to connect to these hosts as we did for the ",(0,i.kt)("inlineCode",{parentName:"p"},"master")," tag."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-env"},"[postgres]\nswarm-worker-1\n\n[rabbitmq]\nswarm-worker-1\n\n[elasticsearch]\nswarm-worker-2\n")),(0,i.kt)("p",null,"Now we link some node to these tags ",(0,i.kt)("inlineCode",{parentName:"p"},"postgres"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"rabbitmq")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"elasticsearch"),". You need to provides these tags if you don't have mutualised instances of these COTS."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},(0,i.kt)("inlineCode",{parentName:"p"},"swarm-host"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"swarm-worker-1")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"swarm-worker-2")," are not used outside this file and can be named how you want ! You can be creative !"))),(0,i.kt)("h3",{id:"inventory-configuration"},"Inventory configuration"),(0,i.kt)("p",null,"Finally, you need to create the file ",(0,i.kt)("inlineCode",{parentName:"p"},"playbooks/inventories/prod-regards-cnes/group_vars/all/main.yml"),"."),(0,i.kt)("p",null,"You can either copy one of the others inventories we provide or start with a fresh one:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'# Network disk shared accross every nodes\ngroup_workdir_network: /NETWORK_DATA/regards/\n# Do we allow root inside the network volume?\n# When false => group_workdir_network is entirely mounted to containers\n# As we cannot chown folders inside that volume\ngroup_workdir_network_allow_root: true\n# Everything stored in the workdir_local is not shared across swarm nodes.\n# We replicate everything on each swarm node to let microservice spawn whatever they want\ngroup_workdir_local: /opt/regards/\n\ngroup_stack_name: \'regards-cnes\'\ngroup_setype: \'container_file_t\'\ngroup_seuser: \'system_u\'\n\n# Used to create folders that are not mounted into containers, but mappable by Docker\ngroup_container_root_user: \'dockermapuid\'\ngroup_container_root_group: \'gregards_admin\'\n# Used to create folders mounted by containers, all files created by containers will use this user\ngroup_container_run_user: \'docker-regards-data\'\ngroup_container_run_group: \'gregards_data\'\n#\xa0When Docker user namespace is active, we substract from the run_user:run_group\n# the shift we setup in Docker. It ensures that\n#\xa01. containers are running with run_user:run_group on host server\n#\xa02. inside containers, prevent privilege escalation as uid:gid are at least the Docker uid:gid shift\n#\xa0When unactive, just provide run_user uid and run_group gid\ngroup_container_run_uid: 3050\ngroup_container_run_gid: 1050\n\ngroup_docker_network_name: \'regards_network_6\'\ngroup_docker_network_ip_network: \'10.11.6.\'\n\ngroup_docker_registry: artifactory.myorganisation.com/docker-regards-prod\n\ngroup_docker_tag: \'V1.1.0\'\n\n# Plugins\ngroup_docker_plugins:\n  - image: rs-plugins\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n\n#\xa0Stack\ngroup_docker_mservices:\n  config:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  registry:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  gateway:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  admin_instance:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  admin:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  authentication:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  dam:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  notifier:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  fem:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  catalog:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  access_instance:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  access:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  storage:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  order:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  ingest:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  dataprovider:\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n  front:\n    port: 9080\n    protocol: http\n    host: regards-cnes-d21-myorganisation.com\n    tag: "{{ "{{" }}\xa0group_docker_tag }}"\n\n# COTS\ngroup_docker_cots:\n  elasticsearch:\n  elasticsearch_logs:\n  kibana:\n  kibana_logs:\n    http: 9081\n  fluent:\n  maildev:\n  postgres:\n  phppgadmin:\n  rabbitmq:\n\n# COTS configuration\ngroup_docker_cots_configuration:\n  postgres:\n    nbTenant: 5\n  elasticsearch:\n    cluster_name: regards\n  elasticsearch_logs:\n    cluster_name: regards_logs\n\n\ngroup_config_mservices:\n  init_project: project1\n\n')),(0,i.kt)("p",null,"Global properties :"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},"Path"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Type"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Description"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Constraints"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"dockermapuid")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Network disk shared accross every nodes"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_workdir_network_allow_root")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Bool")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Do we allow root inside the network volume?"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_workdir_local")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Local folder where regards is installed on every node"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_stack_name")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Unique stack name (for swarm)"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required. ",(0,i.kt)("inlineCode",{parentName:"td"},"[a-z-]+"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_setype")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"SELinux type"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_seuser")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"SELinux user"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_container_root_user")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"User owning the REGARDS folder tree, Docker must have read/write access"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_container_root_group")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Group owning the REGARDS folder tree"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_container_run_user")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"All files created by containers will use this user"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_container_run_group")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"All files created by containers will use this group"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_container_run_uid")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Run user id. (See ",(0,i.kt)("inlineCode",{parentName:"td"},"group_container_run_user"),")"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_container_run_gid")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Run group id. (See ",(0,i.kt)("inlineCode",{parentName:"td"},"group_container_run_group"),")"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_network_name")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Docker network name. Automatically created by Ansible"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_network_ip_network")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Docker network ip"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required. If a basic IPV4 looks like ",(0,i.kt)("inlineCode",{parentName:"td"},"A.B.C.D"),", you must provide ",(0,i.kt)("inlineCode",{parentName:"td"},"A.B.C."))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_registry")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Docker registry holding REGARDS images"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required")))),(0,i.kt)("p",null,"Microservices properties :"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},"Path"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Type"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Description"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Constraints"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_tag")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Used to store docker image tag version"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Only used in this file.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_plugins")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Array")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Used to store docker plugins to execute."),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required. Can be empty.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_plugins[].image")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Docker image name of the plugin that stores plugins you want to install on REGARDS"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_plugins[].tag")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Docker image tag"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"List of microservices that will be deployed"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required. Some of these keys are facultative, but config, registry, gateway, admin_instance, admin & front should not be removed")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.<anybackendmicroservice>.tag")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Docker image tag that will be deployed"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.<anybackendmicroservice>.http")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Open the public HTTP port of the service (bypass reverse proxy + gateway)"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.<anybackendmicroservice>.jdwp")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Open a public port to debug a microservice with your IDE"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.<anybackendmicroservice>.jmx")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Open the JMX port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.front")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, boots the frontend, which is also the reverse proxy to the gateway"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.front.tag")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Docker image tag that will be deployed"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.front.port")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Open the HTTP port of the NGINX to let users access to the front"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.front.protocol")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Protocol used to access to the front"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.front.host")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Host used to access to the front"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")))),(0,i.kt)("p",null,"If you don't have mutualised COTS, don't worry. You can deploy yours and use mutualised ones later."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},"Path"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Type"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Description"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Constraints"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"List COTS that will be deployed"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required. Can be empty.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.elasticsearch")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, boots an ElasticSearch"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.elasticsearch.http")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, opens the HTTP port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.elasticsearch.client")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, opens the client port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.elasticsearch_logs")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, boots an ElasticSearch to store logs"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.elasticsearch_logs.http")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, opens the HTTP port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.elasticsearch_logs.client")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, opens the client port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.kibana")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, boots a Kibana linked to ",(0,i.kt)("inlineCode",{parentName:"td"},"elasticsearch")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.kibana.http")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, opens the HTTP port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.kibana_logs")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, boots a Kibana linked to ",(0,i.kt)("inlineCode",{parentName:"td"},"elasticsearch_logs")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.kibana_logs.http")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, opens the HTTP port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.fluent")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, boots Fluentd"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Empty.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.maildev")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, boots a local SMTP server Mailchimp"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.maildev.http")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, opens the HTTP port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.postgres")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, boots Postgres"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Empty.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.postgres.client")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, open the TCP port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.phppgadmin")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, boots a PGAdmin"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.phppgadmin.http")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, open the HTTP port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, boots a RabbitMQ"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.client")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, open the TCP port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.http")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, open the HTTP port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.additional_users")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Array")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, adds or updates a RabbitMQ user in addition to the REGARDS admin (see ",(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.amqp.user"),")"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.additional_users.name")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Username of the RabbitMQ user"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.additional_users.password")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Password of the RabbitMQ user"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.additional_users.tags")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Tags of the RabbitMQ user"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required. Can be empty, or a comma separated string with one of these values: ",(0,i.kt)("inlineCode",{parentName:"td"},"management"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"policymaker"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"monitoring"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"administrator"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.user_permissions")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Array")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, adds a RabbitMQ user permission"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.user_permissions.user")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Username of this RabbitMQ user permission"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.user_permissions.vhost")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"VirtualHost of the RabbitMQ user"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required. Can be ",(0,i.kt)("inlineCode",{parentName:"td"},"/"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"regards.multitenant.manager")," or ",(0,i.kt)("inlineCode",{parentName:"td"},"regards.instance.manager"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.user_permissions.configure")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Configuration authorisation of the RabbitMQ user"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required. Can be empty, ",(0,i.kt)("inlineCode",{parentName:"td"},".*")," or any other valid value")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.user_permissions.write")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Write authorisation of the RabbitMQ user"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required. Can be empty, ",(0,i.kt)("inlineCode",{parentName:"td"},".*")," or any other valid value")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.user_permissions.read")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Read authorisation of the RabbitMQ user"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required. Can be empty, ",(0,i.kt)("inlineCode",{parentName:"td"},".*")," or any other valid value")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.rabbitmq.additional_parameters")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Array")),(0,i.kt)("td",{parentName:"tr",align:"center"},"The ",(0,i.kt)("inlineCode",{parentName:"td"},"parameters")," field of the ",(0,i.kt)("inlineCode",{parentName:"td"},"definitions.json")," file, used for example to configure shovel"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. ",(0,i.kt)("inlineCode",{parentName:"td"},"Download broker definitions")," on your RabbitMQ to see valid format")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.doc")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, boots the REGARDS documentation"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.doc.tag")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Documentation docker image tag that will be deployed"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.doc.http")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"When defined, open the HTTP port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots_configuration")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"List COTS specific configuration"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required. Can be empty")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots_configuration.postgres.nbTenant")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Use to deduce the number of connections Postgres should allow"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required when ",(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.postgres")," is defined")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots_configuration.elasticsearch.cluster_name")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Elasticsearch cluster name"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required when ",(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.elasticsearch")," is defined")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots_configuration.elasticsearch_logs.cluster_name")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Logging elasticsearch cluster name"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required when ",(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_cots.elasticsearch_logs")," is defined")))),(0,i.kt)("p",null,"The last but not least, the configuration of microservices :"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},"Path"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Type"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Description"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Constraints"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_config_mservices")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Microservices configuration"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.init_project")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Name of the default project"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Required.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.instance_admin")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Instance admin account definition"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.instance_admin.user")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Name of the instance admin"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Default: ",(0,i.kt)("inlineCode",{parentName:"td"},"regards-admin@c-s.fr"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.instance_admin.password")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Password of the instance admin"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Default: ",(0,i.kt)("inlineCode",{parentName:"td"},"root_admin"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.jwt_secret")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"JWT secret"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Recommended for production.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.access_token_validity")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Access token validity period in seconds"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Default: 1 hour")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.cipher_iv")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Cipher IV"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Recommended for production.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.mail")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Mail configuration used by microservices"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.mail.host")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"SMTP Host"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Default: ",(0,i.kt)("inlineCode",{parentName:"td"},"rs-maildev"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.mail.port")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"SMTP port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Default: ",(0,i.kt)("inlineCode",{parentName:"td"},"1025"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.mail.username")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"SMTP username"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Empty by default")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.mail.password")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"SMTP password"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Empty by default")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.mail.noreply")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"No reply adress"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Default: ",(0,i.kt)("inlineCode",{parentName:"td"},"regards@noreply.fr"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.amqp")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"AMQP configuration"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.amqp.user")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"AMQP username"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Default: ",(0,i.kt)("inlineCode",{parentName:"td"},"guest"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.amqp.password")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"AMQP password"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Default: ",(0,i.kt)("inlineCode",{parentName:"td"},"guest"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.postgres")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Postgres configuration"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.postgres.user")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Postgres username"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Default: ",(0,i.kt)("inlineCode",{parentName:"td"},"azertyuiop123456789"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.postgres.password")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Postgres password"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Default: ",(0,i.kt)("inlineCode",{parentName:"td"},"azertyuiop123456789"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.proxy")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Object")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Proxy configuration"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.proxy.host")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Proxy username"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Empty by default")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.proxy.port")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"Int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Proxy port"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Empty by default")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.proxy.username")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Proxy username"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Empty by default")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"group_docker_mservices.proxy.password")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"String")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Proxy password"),(0,i.kt)("td",{parentName:"tr",align:"center"},"Facultative. Empty by default")))),(0,i.kt)("h2",{id:"deploy"},"Deploy"),(0,i.kt)("p",null,"Running the Ansible installation is quite easy. Run the following command in the ",(0,i.kt)("inlineCode",{parentName:"p"},"playbooks")," folder :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-playbook -i inventories/prod-regards-cnes regards.yml\n\n[..]\nPLAY RECAP *******************************************************************************************************\nswarm-host                 : ok=23   changed=8    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0\nswarm-worker-1             : ok=18   changed=6    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\nswarm-worker-2             : ok=17   changed=5    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n")),(0,i.kt)("p",null,"That's it! You can safely rerun this command again and again without any risk, it will just make your change from your playbook happen on the server."),(0,i.kt)("h1",{id:"administration"},"Administration"),(0,i.kt)("p",null,"Connect to the master node of your stack, and open the REGARDS working directory.",(0,i.kt)("br",{parentName:"p"}),"\n","To do that, you need these two values from your inventories :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'group_workdir_local: /opt/regards/\ngroup_stack_name: "regards-cnes"\n')),(0,i.kt)("p",null,"It means your stack is installed inside ",(0,i.kt)("inlineCode",{parentName:"p"},"/opt/regards/regards-cnes"),"."),(0,i.kt)("p",null,"Open this folder and go to the cli folder:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cd /opt/regards/regards-cnes/cli\n")),(0,i.kt)("p",null,"Let's look at these scripts :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"exec.sh"),": let you go inside a running container. For advanced debugging."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"logs.sh"),": let you display container logs from a running container. Once the stack is running fine, you should prefer to use Kibana to see logs"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"reboot.sh"),": let you reboot a container"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"status.sh"),": display the status of your stack (running container, how many containers are missing, history)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"update-all.sh"),": boot or update the stack using stack files. It checks for updated images on the Docker registry, and track updates on files available on the master node."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"update.sh"),": let you fetch an updated docker image and reboot only that single container. For advanced usage, you should prefer ",(0,i.kt)("inlineCode",{parentName:"li"},"update-all.sh"),".")),(0,i.kt)("p",null,"If you want to stop the stack, you can execute the following (note we use the ",(0,i.kt)("inlineCode",{parentName:"p"},"group_stack_name"),") :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker stack rm regards-cnes\n")),(0,i.kt)("p",null,"When you deploy the stack, you should run ",(0,i.kt)("inlineCode",{parentName:"p"},"status.sh")," to see if containers are running:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"[HISTORY]   5 PREVIOUS CONTAINERS\nnothing found in stack: regards-cnes\n[RUNNING]   25/25\nID      NAME                                               IMAGE                                            NODE                                 [..]  CURRENT STATE      [..]\n86..    regards-cnes_rs-fluent.w4pf3rfr47yjny8y2jmvy9n0s   myregistry/regards-fluent:latest              regards-cnes-d12.myorganisation.com      Running 23 hours ago\nnh..    regards-cnes_rs-fluent.jh7i65fsxbrnce85yjexucna3   myregistry/regards-fluent:latest              regards-cnes-d13.myorganisation.com      Running 23 hours ago\n77..    regards-cnes_rs-fluent.iodt1aszolajpqq5f12q12v1w   myregistry/regards-fluent:latest              regards-cnes-d11.myorganisation.com      Running 23 hours ago\nij..    regards-cnes_rs-admin.1                            myregistry/rs-administration:V1.1.0           regards-cnes-d11.myorganisation.com      Running 23 hours ago\nlh..    regards-cnes_rs-postgres.1                         myregistry/regards-database:latest            regards-cnes-d12.myorganisation.com      Running 23 hours ago\nvm..    regards-cnes_rs-phppgadmin.1                       myregistry/regards-phpmyadmin:latest          regards-cnes-d12.myorganisation.com      Running 23 hours ago\n59..    regards-cnes_rs-notifier.1                         myregistry/rs-notifier:V1.1.0                 regards-cnes-d11.myorganisation.com      Running 23 hours ago\n3r..    regards-cnes_rs-logs-elasticsearch.1               myregistry/regards-elasticsearch:latest       regards-cnes-d13.myorganisation.com      Running 23 hours ago\njd..    regards-cnes_rs-kibana.1                           myregistry/regards-kibana:latest              regards-cnes-d13.myorganisation.com      Running 23 hours ago\n3t..    regards-cnes_rs-dam.1                              myregistry/rs-dam:V1.1.0                      regards-cnes-d12.myorganisation.com      Running 23 hours ago\nir..    regards-cnes_rs-access-instance.1                  myregistry/rs-access-instance:V1.1.0          regards-cnes-d11.myorganisation.com      Running 23 hours ago\npp..    regards-cnes_rs-fem.1                              myregistry/rs-fem:V1.1.0                      regards-cnes-d12.myorganisation.com      Running 23 hours ago\nlx..    regards-cnes_rs-config.1                           myregistry/rs-config:V1.1.0                   regards-cnes-d11.myorganisation.com      Running 23 hours ago\n2k..    regards-cnes_rs-authentication.1                   myregistry/rs-authentication:V1.1.0           regards-cnes-d13.myorganisation.com      Running 23 hours ago\nmh..    regards-cnes_rs-catalog.1                          myregistry/rs-catalog:V1.1.0                  regards-cnes-d12.myorganisation.com      Running 23 hours ago\nqu..    regards-cnes_rs-registry.1                         myregistry/rs-registry:V1.1.0                 regards-cnes-d13.myorganisation.com      Running 23 hours ago\n8m..    regards-cnes_rs-rabbitmq.1                         myregistry/regards-messaging:latest           regards-cnes-d12.myorganisation.com      Running 23 hours ago\nn9..    regards-cnes_rs-maildev.1                          myregistry/regards-maildev:latest             regards-cnes-d13.myorganisation.com      Running 23 hours ago\nm8..    regards-cnes_rs-logs-kibana.1                      myregistry/regards-kibana:latest              regards-cnes-d12.myorganisation.com      Running 23 hours ago\nke..    regards-cnes_rs-elasticsearch.1                    myregistry/regards-elasticsearch:latest       regards-cnes-d13.myorganisation.com      Running 23 hours ago\nkw..    regards-cnes_rs-access-project.1                   myregistry/rs-access-project:V1.1.0           regards-cnes-d13.myorganisation.com      Running 23 hours ago\n51..    regards-cnes_rs-gateway.1                          myregistry/rs-gateway:V1.1.0                  regards-cnes-d13.myorganisation.com      Running 23 hours ago\njd..    regards-cnes_rs-front.1                            myregistry/rs-front:V1.1.0                    regards-cnes-d13.myorganisation.com      Running 23 hours ago\ny4..    regards-cnes_rs-admin-instance.1                   myregistry/rs-administration-instance:V1.1.0  regards-cnes-d13.myorganisation.com      Running 23 hours ago\n")),(0,i.kt)("p",null,"In the history, there is no container starting again and again every minutes. That's what we're expecting in a production environment.",(0,i.kt)("br",{parentName:"p"}),"\n","Moreover, we display the number of running containers and the number of expected ones. In this exemple everything is fine (",(0,i.kt)("inlineCode",{parentName:"p"},"[RUNNING] 25/25"),").\nThe current state of these containers is also important. You need to wait 5 to 15 minutes to see if containers succeed to boot, some containers are waiting to others so they usually crash in that short period if there is some files unwritable, COTS not accessible..."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The number of running services depends of your inventory. You may see less actives services than this exemple, but the ",(0,i.kt)("inlineCode",{parentName:"p"},"[RUNNING] X/X")," must equals 100%."))),(0,i.kt)("p",null,"Now, let's see how you can debug some microservice.\nFirst, let's remove the elasticsearch:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker service scale regards-cnes_rs-elasticsearch=0\n")),(0,i.kt)("p",null,"Then, reboot dam:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"./reboot.sh rs-dam\n")),(0,i.kt)("p",null,"Now we can read logs of the booting dam to see if it succeed to boot without ElasticSearch :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$./logs.sh rs-dam -f\nregards-cnes_rs-dam.1.w5gxg6x1mn2x@regards-cnes-d13.myorganisation.com    | 2020-05-12 10:49:54,315 [rs-dam] [main            ] ERROR o.s.boot.SpringApplication []    - Application run failed\n[..]\nregards-cnes_rs-dam.1.w5gxg6x1mn2x@regards-cnes-d13.myorganisation.com    | Caused by: java.net.UnknownHostException: rs-elasticsearch: Try again\n")),(0,i.kt)("p",null,"Not, it doesn't like it. Now we can restart the ElasticSearch by just running :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"./update-all.sh\n")),(0,i.kt)("p",null,"Now we can run again ",(0,i.kt)("inlineCode",{parentName:"p"},"status.sh")," :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# ./status.sh\n[HISTORY]   5 PREVIOUS CONTAINERS\nID      NAME                                               IMAGE                                                                     NODE                                  DESIRED STATE CURRENT STATE [..]\n86m..   regards-cnes_rs-fluent.w4pf3rfr47yjny8y2jmvy9n0s   172.26.46.158/regards-fluent:latest@sha256:4e733e[...]                    regards-cnes-d12.myorganisation.com   Shutdown      Shutdown 2 minutes ago\nnhu..   regards-cnes_rs-fluent.jh7i65fsxbrnce85yjexucna3   172.26.46.158/regards-fluent:latest@sha256:4e733e[...]                    regards-cnes-d13.myorganisation.com   Shutdown      Shutdown 2 minutes ago\n778..   regards-cnes_rs-fluent.iodt1aszolajpqq5f12q12v1w   172.26.46.158/regards-fluent:latest@sha256:4e733e[...]                    regards-cnes-d11.myorganisation.com   Shutdown      Shutdown 2 minutes ago\nty0..   regards-cnes_rs-authentication.1                   172.26.46.158/rs-authentication:fast-release-V1.1.0@sha256:875ca2aa[..]   regards-cnes-d13.myorganisation.com   Shutdown      Shutdown 3 minute ago\n7yw..   regards-cnes_rs-access-project.1                   172.26.46.158/rs-access-project:fast-release-V1.1.0@sha256:17a0d7e9[..]   regards-cnes-d13.myorganisation.com   Shutdown      Shutdown 3 minute ago\n[RUNNING]   25/25\n[..]\n")),(0,i.kt)("p",null,"We see in the history the last activity starts to be old (2 mins) and there is again 25/25 services deployed."))}k.isMDXComponent=!0}}]);