<!doctype html>
<html class="docs-version-1.6.0" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="search" type="application/opensearchdescription+xml" title="REGARDS" href="/opensearch.xml"><title data-react-helmet="true">Getting started with Docker Swarm using Ansible | REGARDS</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://RegardsOss.github.io//docs/1.6.0/setup/deprecated/swarm/start/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="1.6.0"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-1.6.0"><meta data-react-helmet="true" property="og:title" content="Getting started with Docker Swarm using Ansible | REGARDS"><meta data-react-helmet="true" name="description" content="The Ansible &amp; Swarm deployment is in early stage and may not be publicly available at the time we publish this documentation"><meta data-react-helmet="true" property="og:description" content="The Ansible &amp; Swarm deployment is in early stage and may not be publicly available at the time we publish this documentation"><link data-react-helmet="true" rel="icon" href="/img/logos/regards-png/regards-favicon.png"><link data-react-helmet="true" rel="canonical" href="https://RegardsOss.github.io//docs/1.6.0/setup/deprecated/swarm/start/"><link data-react-helmet="true" rel="alternate" href="https://RegardsOss.github.io//docs/1.6.0/setup/deprecated/swarm/start/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://RegardsOss.github.io//fr/docs/1.6.0/setup/deprecated/swarm/start/" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://RegardsOss.github.io//docs/1.6.0/setup/deprecated/swarm/start/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.612c707d.css">
<link rel="preload" href="/assets/js/runtime~main.09813f13.js" as="script">
<link rel="preload" href="/assets/js/main.fb73c99e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logos/regards-svg/regards-white.svg" alt="Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logos/regards-svg/regards-white.svg" alt="Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">REGARDS</b></a><a class="navbar__item navbar__link" href="/docs/1.6.0/setup/">Install</a><a class="navbar__item navbar__link" href="/docs/1.6.0/user-guide/">Manual</a><a class="navbar__item navbar__link" href="/docs/1.6.0/development/">Developers</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/docs/1.6.0/setup/">1.6.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/setup/deprecated/swarm/start/">1.7.1</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/1.6.0/setup/deprecated/swarm/start/">1.6.0</a></li><li><a class="dropdown__link" href="/docs/1.5.0/setup/deprecated/swarm/start/">1.5.0</a></li><li><a class="dropdown__link" href="/docs/1.4.0/setup/deprecated/swarm/start/">1.4.0</a></li><li><a class="dropdown__link" href="/versions">All versions</a></li></ul></div><a class="navbar__item navbar__link" href="/roadmap/">Roadmap</a><a class="navbar__item navbar__link" href="/release-notes/">Release notes</a><a class="navbar__item navbar__link" href="/aboutus/">About us</a><a href="https://github.com/RegardsOss/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><main class="docMainContainer_TCnq docMainContainerEnhanced_WDCb"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->REGARDS<!-- --> <b>1.6.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/setup/deprecated/swarm/start/">latest version</a></b> (<!-- -->1.7.1<!-- -->).</div></div><div class="docItemContainer_vinB"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->1.6.0</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Getting started with Docker Swarm using Ansible</h1></header><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The Ansible &amp; Swarm deployment is in early stage and may not be publicly available at the time we publish this documentation</p></div></div><h1>Install</h1><p>Let&#x27;s install REGARDS on a swarm server !</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="requirements">Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">â€‹</a></h2><p>We won&#x27;t treat here how to setup these requirements as they have some good tutorials outhere.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="software-requirements">Software requirements<a class="hash-link" href="#software-requirements" title="Direct link to heading">â€‹</a></h3><ul><li>Ansible <code>2.6.2</code> at least</li><li>Docker <code>19.03.8</code> at least</li><li>Redhat <code>CentOS_7.6.1810</code> or equivalent</li><li>REGARDS <code>1.1.0</code> at least</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="settings--environnement">Settings &amp; Environnement<a class="hash-link" href="#settings--environnement" title="Direct link to heading">â€‹</a></h3><ul><li><code>/var/lib/docker</code> must exists</li><li>You must provide a network volume (<code>NFS</code> or equivalent) to swarm workers</li><li>A Docker registry with our images pushed</li><li>An user having <strong>sudo rights</strong> and access to the Docker registry</li><li>Docker is setup with user namespace</li><li>Swarm workers are connected to master</li><li>Either an access to mutualised COTS, or the right configuration on the host. We already treat the basic setup of these COTS <!-- -->[here]<!-- -->, you need to look for <code>kernel.shmmax</code>, <code>vm.max_map_count</code></li></ul><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The root access is required to install files using Ansible with specific owner. You can release such user access after Ansible installation.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="cots-versions">COTS versions<a class="hash-link" href="#cots-versions" title="Direct link to heading">â€‹</a></h3><p>We expected these COTS:</p><ul><li>Postgres <code>11.5</code></li><li>RabbitMQ <code>3.8.2</code></li><li>ElasticSearch <code>6.5.0</code></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="users">Users<a class="hash-link" href="#users" title="Direct link to heading">â€‹</a></h3><p>First usecase: there is an IPA managing users / groups on your targeted VMs. We want a secure installation where accessing and managing data are splitted into two differents groups.</p><table><thead><tr><th align="center">User</th><th align="center">Group</th><th align="center">Description</th><th align="center">Tips</th></tr></thead><tbody><tr><td align="center"><code>dockermapuid</code></td><td align="center"><code>dockermapgid</code></td><td align="center">Used by the docker daemon</td><td align="center">This group is internal to the server</td></tr><tr><td align="center"></td><td align="center"><code>gregards_admin</code></td><td align="center">Regroup all users that are allowed to monitor the stack</td><td align="center">Facultative, <code>johndoe</code> can also replace this one</td></tr><tr><td align="center"><code>docker-regards-data</code></td><td align="center"><code>gregards_data</code></td><td align="center">IPA User/Group owning all files created by REGARDS</td><td align="center">Your user should be inside that group</td></tr><tr><td align="center"><code>johndoe</code></td><td align="center"><code>johndoe</code>, <code>dockermapgid</code>, <code>gregards_admin</code>, <code>gregards_data</code></td><td align="center">Your personnal user</td><td align="center">Your user has access to Docker, to the stack and data</td></tr><tr><td align="center"><code>mariecurie</code></td><td align="center"><code>mariecurie</code>, <code>gregards_data</code></td><td align="center">Some user</td><td align="center">She has access to data, not the stack itself</td></tr></tbody></table><p>Other usecase. You install everything as root, you don&#x27;t have an IPA.</p><table><thead><tr><th align="center">User</th><th align="center">Group</th><th align="center">Description</th><th align="center">Tips</th></tr></thead><tbody><tr><td align="center"><code>dockermapuid</code></td><td align="center"><code>dockermapgid</code></td><td align="center">Used by the docker daemon</td><td align="center"></td></tr><tr><td align="center"><code>docker-regards-data</code></td><td align="center"><code>gregards_data</code></td><td align="center">Local User/Group owning all files created by REGARDS</td><td align="center">Even with root install, we still respect Docker user namespace !!</td></tr><tr><td align="center"><code>root</code></td><td align="center"><code>root</code></td><td align="center">Used to install and run the stack</td><td align="center"></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="ansible">Ansible<a class="hash-link" href="#ansible" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="get-the-source">Get the source<a class="hash-link" href="#get-the-source" title="Direct link to heading">â€‹</a></h3><p>The repository is not public yet !</p><p>You will find :</p><ul><li><code>inventories</code>: stores where and what you want to install</li><li><code>roles</code>: stores Ansible tasks</li><li><code>regards.yml</code>, <code>regards-*.yml</code>,... that links roles and tags to execute</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="create-your-inventory">Create your inventory<a class="hash-link" href="#create-your-inventory" title="Direct link to heading">â€‹</a></h3><p>Let&#x27;s create our new inventory. You should create a new inventory each time you deploy REGARDS on a new stack.<br>
<!-- -->In this guide, we&#x27;ll create a new inventory named <code>prod-regards-cnes</code> (<code>&lt;dev|prod&gt;-&lt;swarm-master-hostname&gt;</code>)</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> playbooks/inventories/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> prod-regards-cnes</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now you can create the <code>hosts</code> file <code>playbooks/inventories/prod-regards-cnes/hosts</code> with the following:</p><div class="codeBlockContainer_I0IT language-env theme-code-block"><div class="codeBlockContent_wNvx env"><pre tabindex="0" class="prism-code language-env codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[master]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-host ansible_host=regards-cnes-d21-myorganisation.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[slaves]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-worker-1 ansible_host=regards-cnes-d22-myorganisation.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-worker-2 ansible_host=regards-cnes-d23-myorganisation.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[postgres]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-worker-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[rabbitmq]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-worker-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[elasticsearch]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-worker-2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Let&#x27;s see this step by step :</p><div class="codeBlockContainer_I0IT language-env theme-code-block"><div class="codeBlockContent_wNvx env"><pre tabindex="0" class="prism-code language-env codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[master]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-host ansible_host=regards-cnes-d21-myorganisation.com</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Here we create inside the <code>master</code> tag a node named <code>swarm-host</code>. We provide the <code>ansible_host</code>, but we do not provide <code>ansible_user=root</code> or <code>ansible_password=rootpassword</code>, so Ansible will use the current user (and doesn&#x27;t expect password prompt).</p><div class="codeBlockContainer_I0IT language-env theme-code-block"><div class="codeBlockContent_wNvx env"><pre tabindex="0" class="prism-code language-env codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[slaves]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-worker-1 ansible_host=regards-cnes-d22-myorganisation.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-worker-2 ansible_host=regards-cnes-d23-myorganisation.com</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then we create two nodes <code>swarm-worker-1</code> and <code>swarm-worker-2</code> in the <code>slaves</code> tag. We need to provide a way to connect to these hosts as we did for the <code>master</code> tag.</p><div class="codeBlockContainer_I0IT language-env theme-code-block"><div class="codeBlockContent_wNvx env"><pre tabindex="0" class="prism-code language-env codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[postgres]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-worker-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[rabbitmq]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-worker-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[elasticsearch]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-worker-2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now we link some node to these tags <code>postgres</code>, <code>rabbitmq</code> and <code>elasticsearch</code>. You need to provides these tags if you don&#x27;t have mutualised instances of these COTS.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p><code>swarm-host</code>, <code>swarm-worker-1</code> and <code>swarm-worker-2</code> are not used outside this file and can be named how you want ! You can be creative !</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="inventory-configuration">Inventory configuration<a class="hash-link" href="#inventory-configuration" title="Direct link to heading">â€‹</a></h3><p>Finally, you need to create the file <code>playbooks/inventories/prod-regards-cnes/group_vars/all/main.yml</code>.</p><p>You can either copy one of the others inventories we provide or start with a fresh one:</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Network disk shared accross every nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_workdir_network</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /NETWORK_DATA/regards/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Do we allow root inside the network volume?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># When false =&gt; group_workdir_network is entirely mounted to containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># As we cannot chown folders inside that volume</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_workdir_network_allow_root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Everything stored in the workdir_local is not shared across swarm nodes.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># We replicate everything on each swarm node to let microservice spawn whatever they want</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_workdir_local</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /opt/regards/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_stack_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;regards-cnes&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_setype</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;container_file_t&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_seuser</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;system_u&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Used to create folders that are not mounted into containers, but mappable by Docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_container_root_user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;dockermapuid&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_container_root_group</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;gregards_admin&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Used to create folders mounted by containers, all files created by containers will use this user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_container_run_user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;docker-regards-data&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_container_run_group</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;gregards_data&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#Â When Docker user namespace is active, we substract from the run_user:run_group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># the shift we setup in Docker. It ensures that</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#Â 1. containers are running with run_user:run_group on host server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#Â 2. inside containers, prevent privilege escalation as uid:gid are at least the Docker uid:gid shift</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#Â When unactive, just provide run_user uid and run_group gid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_container_run_uid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3050</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_container_run_gid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1050</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_docker_network_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;regards_network_6&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_docker_network_ip_network</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;10.11.6.&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_docker_registry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> artifactory.myorganisation.com/docker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">regards</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">prod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_docker_tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;V1.1.0&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Plugins</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_docker_plugins</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">plugins</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#Â Stack</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_docker_mservices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">registry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">gateway</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">admin_instance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">admin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">authentication</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">dam</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">notifier</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">fem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">catalog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">access_instance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">access</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">order</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">ingest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">dataprovider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">front</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">9080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> regards</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cnes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">d21</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">myorganisation.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{{&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">Â group_docker_tag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># COTS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_docker_cots</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">elasticsearch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">elasticsearch_logs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">kibana</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">kibana_logs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">9081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">fluent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">maildev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">postgres</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">phppgadmin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">rabbitmq</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># COTS configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_docker_cots_configuration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">postgres</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">nbTenant</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">elasticsearch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">cluster_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> regards</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">elasticsearch_logs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">cluster_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> regards_logs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_config_mservices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">init_project</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> project1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Global properties :</p><table><thead><tr><th align="center">Path</th><th align="center">Type</th><th align="center">Description</th><th align="center">Constraints</th></tr></thead><tbody><tr><td align="center"><code>dockermapuid</code></td><td align="center"><code>String</code></td><td align="center">Network disk shared accross every nodes</td><td align="center">Required</td></tr><tr><td align="center"><code>group_workdir_network_allow_root</code></td><td align="center"><code>Bool</code></td><td align="center">Do we allow root inside the network volume?</td><td align="center">Required</td></tr><tr><td align="center"><code>group_workdir_local</code></td><td align="center"><code>String</code></td><td align="center">Local folder where regards is installed on every node</td><td align="center">Required</td></tr><tr><td align="center"><code>group_stack_name</code></td><td align="center"><code>String</code></td><td align="center">Unique stack name (for swarm)</td><td align="center">Required. <code>[a-z-]+</code></td></tr><tr><td align="center"><code>group_setype</code></td><td align="center"><code>String</code></td><td align="center">SELinux type</td><td align="center">Required</td></tr><tr><td align="center"><code>group_seuser</code></td><td align="center"><code>String</code></td><td align="center">SELinux user</td><td align="center">Required</td></tr><tr><td align="center"><code>group_container_root_user</code></td><td align="center"><code>String</code></td><td align="center">User owning the REGARDS folder tree, Docker must have read/write access</td><td align="center">Required</td></tr><tr><td align="center"><code>group_container_root_group</code></td><td align="center"><code>String</code></td><td align="center">Group owning the REGARDS folder tree</td><td align="center">Required</td></tr><tr><td align="center"><code>group_container_run_user</code></td><td align="center"><code>String</code></td><td align="center">All files created by containers will use this user</td><td align="center">Required</td></tr><tr><td align="center"><code>group_container_run_group</code></td><td align="center"><code>String</code></td><td align="center">All files created by containers will use this group</td><td align="center">Required</td></tr><tr><td align="center"><code>group_container_run_uid</code></td><td align="center"><code>Int</code></td><td align="center">Run user id. (See <code>group_container_run_user</code>)</td><td align="center">Required</td></tr><tr><td align="center"><code>group_container_run_gid</code></td><td align="center"><code>Int</code></td><td align="center">Run group id. (See <code>group_container_run_group</code>)</td><td align="center">Required</td></tr><tr><td align="center"><code>group_docker_network_name</code></td><td align="center"><code>String</code></td><td align="center">Docker network name. Automatically created by Ansible</td><td align="center">Required</td></tr><tr><td align="center"><code>group_docker_network_ip_network</code></td><td align="center"><code>String</code></td><td align="center">Docker network ip</td><td align="center">Required. If a basic IPV4 looks like <code>A.B.C.D</code>, you must provide <code>A.B.C.</code></td></tr><tr><td align="center"><code>group_docker_registry</code></td><td align="center"><code>String</code></td><td align="center">Docker registry holding REGARDS images</td><td align="center">Required</td></tr></tbody></table><p>Microservices properties :</p><table><thead><tr><th align="center">Path</th><th align="center">Type</th><th align="center">Description</th><th align="center">Constraints</th></tr></thead><tbody><tr><td align="center"><code>group_docker_tag</code></td><td align="center"><code>String</code></td><td align="center">Used to store docker image tag version</td><td align="center">Facultative. Only used in this file.</td></tr><tr><td align="center"><code>group_docker_plugins</code></td><td align="center"><code>Array</code></td><td align="center">Used to store docker plugins to execute.</td><td align="center">Required. Can be empty.</td></tr><tr><td align="center"><code>group_docker_plugins[].image</code></td><td align="center"><code>String</code></td><td align="center">Docker image name of the plugin that stores plugins you want to install on REGARDS</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_plugins[].tag</code></td><td align="center"><code>String</code></td><td align="center">Docker image tag</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_mservices</code></td><td align="center"><code>Object</code></td><td align="center">List of microservices that will be deployed</td><td align="center">Required. Some of these keys are facultative, but config, registry, gateway, admin_instance, admin &amp; front should not be removed</td></tr><tr><td align="center"><code>group_docker_mservices.&lt;anybackendmicroservice&gt;.tag</code></td><td align="center"><code>String</code></td><td align="center">Docker image tag that will be deployed</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_mservices.&lt;anybackendmicroservice&gt;.http</code></td><td align="center"><code>String</code></td><td align="center">Open the public HTTP port of the service (bypass reverse proxy + gateway)</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_mservices.&lt;anybackendmicroservice&gt;.jdwp</code></td><td align="center"><code>String</code></td><td align="center">Open a public port to debug a microservice with your IDE</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_mservices.&lt;anybackendmicroservice&gt;.jmx</code></td><td align="center"><code>String</code></td><td align="center">Open the JMX port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_mservices.front</code></td><td align="center"><code>Object</code></td><td align="center">When defined, boots the frontend, which is also the reverse proxy to the gateway</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_mservices.front.tag</code></td><td align="center"><code>String</code></td><td align="center">Docker image tag that will be deployed</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_mservices.front.port</code></td><td align="center"><code>Int</code></td><td align="center">Open the HTTP port of the NGINX to let users access to the front</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_mservices.front.protocol</code></td><td align="center"><code>Int</code></td><td align="center">Protocol used to access to the front</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_mservices.front.host</code></td><td align="center"><code>String</code></td><td align="center">Host used to access to the front</td><td align="center">Required.</td></tr></tbody></table><p>If you don&#x27;t have mutualised COTS, don&#x27;t worry. You can deploy yours and use mutualised ones later.</p><table><thead><tr><th align="center">Path</th><th align="center">Type</th><th align="center">Description</th><th align="center">Constraints</th></tr></thead><tbody><tr><td align="center"><code>group_docker_cots</code></td><td align="center"><code>Object</code></td><td align="center">List COTS that will be deployed</td><td align="center">Required. Can be empty.</td></tr><tr><td align="center"><code>group_docker_cots.elasticsearch</code></td><td align="center"><code>Object</code></td><td align="center">When defined, boots an ElasticSearch</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.elasticsearch.http</code></td><td align="center"><code>Int</code></td><td align="center">When defined, opens the HTTP port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.elasticsearch.client</code></td><td align="center"><code>Int</code></td><td align="center">When defined, opens the client port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.elasticsearch_logs</code></td><td align="center"><code>Object</code></td><td align="center">When defined, boots an ElasticSearch to store logs</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.elasticsearch_logs.http</code></td><td align="center"><code>Int</code></td><td align="center">When defined, opens the HTTP port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.elasticsearch_logs.client</code></td><td align="center"><code>Int</code></td><td align="center">When defined, opens the client port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.kibana</code></td><td align="center"><code>Object</code></td><td align="center">When defined, boots a Kibana linked to <code>elasticsearch</code></td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.kibana.http</code></td><td align="center"><code>Int</code></td><td align="center">When defined, opens the HTTP port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.kibana_logs</code></td><td align="center"><code>Object</code></td><td align="center">When defined, boots a Kibana linked to <code>elasticsearch_logs</code></td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.kibana_logs.http</code></td><td align="center"><code>Int</code></td><td align="center">When defined, opens the HTTP port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.fluent</code></td><td align="center"><code>Object</code></td><td align="center">When defined, boots Fluentd</td><td align="center">Facultative. Empty.</td></tr><tr><td align="center"><code>group_docker_cots.maildev</code></td><td align="center"><code>Object</code></td><td align="center">When defined, boots a local SMTP server Mailchimp</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.maildev.http</code></td><td align="center"><code>Int</code></td><td align="center">When defined, opens the HTTP port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.postgres</code></td><td align="center"><code>Object</code></td><td align="center">When defined, boots Postgres</td><td align="center">Facultative. Empty.</td></tr><tr><td align="center"><code>group_docker_cots.postgres.client</code></td><td align="center"><code>Int</code></td><td align="center">When defined, open the TCP port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.phppgadmin</code></td><td align="center"><code>Object</code></td><td align="center">When defined, boots a PGAdmin</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.phppgadmin.http</code></td><td align="center"><code>Int</code></td><td align="center">When defined, open the HTTP port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq</code></td><td align="center"><code>Object</code></td><td align="center">When defined, boots a RabbitMQ</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.client</code></td><td align="center"><code>Int</code></td><td align="center">When defined, open the TCP port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.http</code></td><td align="center"><code>Int</code></td><td align="center">When defined, open the HTTP port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.additional_users</code></td><td align="center"><code>Array</code></td><td align="center">When defined, adds or updates a RabbitMQ user in addition to the REGARDS admin (see <code>group_docker_mservices.amqp.user</code>)</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.additional_users.name</code></td><td align="center"><code>String</code></td><td align="center">Username of the RabbitMQ user</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.additional_users.password</code></td><td align="center"><code>String</code></td><td align="center">Password of the RabbitMQ user</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.additional_users.tags</code></td><td align="center"><code>String</code></td><td align="center">Tags of the RabbitMQ user</td><td align="center">Required. Can be empty, or a comma separated string with one of these values: <code>management</code>, <code>policymaker</code>, <code>monitoring</code>, <code>administrator</code></td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.user_permissions</code></td><td align="center"><code>Array</code></td><td align="center">When defined, adds a RabbitMQ user permission</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.user_permissions.user</code></td><td align="center"><code>String</code></td><td align="center">Username of this RabbitMQ user permission</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.user_permissions.vhost</code></td><td align="center"><code>String</code></td><td align="center">VirtualHost of the RabbitMQ user</td><td align="center">Required. Can be <code>/</code>, <code>regards.multitenant.manager</code> or <code>regards.instance.manager</code></td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.user_permissions.configure</code></td><td align="center"><code>String</code></td><td align="center">Configuration authorisation of the RabbitMQ user</td><td align="center">Required. Can be empty, <code>.*</code> or any other valid value</td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.user_permissions.write</code></td><td align="center"><code>String</code></td><td align="center">Write authorisation of the RabbitMQ user</td><td align="center">Required. Can be empty, <code>.*</code> or any other valid value</td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.user_permissions.read</code></td><td align="center"><code>String</code></td><td align="center">Read authorisation of the RabbitMQ user</td><td align="center">Required. Can be empty, <code>.*</code> or any other valid value</td></tr><tr><td align="center"><code>group_docker_cots.rabbitmq.additional_parameters</code></td><td align="center"><code>Array</code></td><td align="center">The <code>parameters</code> field of the <code>definitions.json</code> file, used for example to configure shovel</td><td align="center">Facultative. <code>Download broker definitions</code> on your RabbitMQ to see valid format</td></tr><tr><td align="center"><code>group_docker_cots.doc</code></td><td align="center"><code>Object</code></td><td align="center">When defined, boots the REGARDS documentation</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots.doc.tag</code></td><td align="center"><code>String</code></td><td align="center">Documentation docker image tag that will be deployed</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_cots.doc.http</code></td><td align="center"><code>Int</code></td><td align="center">When defined, open the HTTP port</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_cots_configuration</code></td><td align="center"><code>Object</code></td><td align="center">List COTS specific configuration</td><td align="center">Required. Can be empty</td></tr><tr><td align="center"><code>group_docker_cots_configuration.postgres.nbTenant</code></td><td align="center"><code>Int</code></td><td align="center">Use to deduce the number of connections Postgres should allow</td><td align="center">Required when <code>group_docker_cots.postgres</code> is defined</td></tr><tr><td align="center"><code>group_docker_cots_configuration.elasticsearch.cluster_name</code></td><td align="center"><code>Int</code></td><td align="center">Elasticsearch cluster name</td><td align="center">Required when <code>group_docker_cots.elasticsearch</code> is defined</td></tr><tr><td align="center"><code>group_docker_cots_configuration.elasticsearch_logs.cluster_name</code></td><td align="center"><code>Int</code></td><td align="center">Logging elasticsearch cluster name</td><td align="center">Required when <code>group_docker_cots.elasticsearch_logs</code> is defined</td></tr></tbody></table><p>The last but not least, the configuration of microservices :</p><table><thead><tr><th align="center">Path</th><th align="center">Type</th><th align="center">Description</th><th align="center">Constraints</th></tr></thead><tbody><tr><td align="center"><code>group_config_mservices</code></td><td align="center"><code>Object</code></td><td align="center">Microservices configuration</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_mservices.init_project</code></td><td align="center"><code>String</code></td><td align="center">Name of the default project</td><td align="center">Required.</td></tr><tr><td align="center"><code>group_docker_mservices.instance_admin</code></td><td align="center"><code>Object</code></td><td align="center">Instance admin account definition</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_mservices.instance_admin.user</code></td><td align="center"><code>String</code></td><td align="center">Name of the instance admin</td><td align="center">Facultative. Default: <code>regards-admin@c-s.fr</code></td></tr><tr><td align="center"><code>group_docker_mservices.instance_admin.password</code></td><td align="center"><code>String</code></td><td align="center">Password of the instance admin</td><td align="center">Facultative. Default: <code>root_admin</code></td></tr><tr><td align="center"><code>group_docker_mservices.jwt_secret</code></td><td align="center"><code>String</code></td><td align="center">JWT secret</td><td align="center">Facultative. Recommended for production.</td></tr><tr><td align="center"><code>group_docker_mservices.access_token_validity</code></td><td align="center"><code>String</code></td><td align="center">Access token validity period in seconds</td><td align="center">Facultative. Default: 1 hour</td></tr><tr><td align="center"><code>group_docker_mservices.cipher_iv</code></td><td align="center"><code>String</code></td><td align="center">Cipher IV</td><td align="center">Facultative. Recommended for production.</td></tr><tr><td align="center"><code>group_docker_mservices.mail</code></td><td align="center"><code>Object</code></td><td align="center">Mail configuration used by microservices</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_mservices.mail.host</code></td><td align="center"><code>String</code></td><td align="center">SMTP Host</td><td align="center">Facultative. Default: <code>rs-maildev</code></td></tr><tr><td align="center"><code>group_docker_mservices.mail.port</code></td><td align="center"><code>Int</code></td><td align="center">SMTP port</td><td align="center">Facultative. Default: <code>1025</code></td></tr><tr><td align="center"><code>group_docker_mservices.mail.username</code></td><td align="center"><code>String</code></td><td align="center">SMTP username</td><td align="center">Facultative. Empty by default</td></tr><tr><td align="center"><code>group_docker_mservices.mail.password</code></td><td align="center"><code>String</code></td><td align="center">SMTP password</td><td align="center">Facultative. Empty by default</td></tr><tr><td align="center"><code>group_docker_mservices.mail.noreply</code></td><td align="center"><code>String</code></td><td align="center">No reply adress</td><td align="center">Facultative. Default: <code>regards@noreply.fr</code></td></tr><tr><td align="center"><code>group_docker_mservices.amqp</code></td><td align="center"><code>Object</code></td><td align="center">AMQP configuration</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_mservices.amqp.user</code></td><td align="center"><code>String</code></td><td align="center">AMQP username</td><td align="center">Facultative. Default: <code>guest</code></td></tr><tr><td align="center"><code>group_docker_mservices.amqp.password</code></td><td align="center"><code>String</code></td><td align="center">AMQP password</td><td align="center">Facultative. Default: <code>guest</code></td></tr><tr><td align="center"><code>group_docker_mservices.postgres</code></td><td align="center"><code>Object</code></td><td align="center">Postgres configuration</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_mservices.postgres.user</code></td><td align="center"><code>String</code></td><td align="center">Postgres username</td><td align="center">Facultative. Default: <code>azertyuiop123456789</code></td></tr><tr><td align="center"><code>group_docker_mservices.postgres.password</code></td><td align="center"><code>String</code></td><td align="center">Postgres password</td><td align="center">Facultative. Default: <code>azertyuiop123456789</code></td></tr><tr><td align="center"><code>group_docker_mservices.proxy</code></td><td align="center"><code>Object</code></td><td align="center">Proxy configuration</td><td align="center">Facultative.</td></tr><tr><td align="center"><code>group_docker_mservices.proxy.host</code></td><td align="center"><code>String</code></td><td align="center">Proxy username</td><td align="center">Facultative. Empty by default</td></tr><tr><td align="center"><code>group_docker_mservices.proxy.port</code></td><td align="center"><code>Int</code></td><td align="center">Proxy port</td><td align="center">Facultative. Empty by default</td></tr><tr><td align="center"><code>group_docker_mservices.proxy.username</code></td><td align="center"><code>String</code></td><td align="center">Proxy username</td><td align="center">Facultative. Empty by default</td></tr><tr><td align="center"><code>group_docker_mservices.proxy.password</code></td><td align="center"><code>String</code></td><td align="center">Proxy password</td><td align="center">Facultative. Empty by default</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="deploy">Deploy<a class="hash-link" href="#deploy" title="Direct link to heading">â€‹</a></h2><p>Running the Ansible installation is quite easy. Run the following command in the <code>playbooks</code> folder :</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ansible-playbook -i inventories/prod-regards-cnes regards.yml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PLAY RECAP *******************************************************************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-host                 </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ok</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain">   </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">changed</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">unreachable</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">failed</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">skipped</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">rescued</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ignored</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-worker-1             </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ok</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">18</span><span class="token plain">   </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">changed</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">unreachable</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">failed</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">skipped</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">rescued</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ignored</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">swarm-worker-2             </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ok</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">17</span><span class="token plain">   </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">changed</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">unreachable</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">failed</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">skipped</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">rescued</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ignored</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>That&#x27;s it! You can safely rerun this command again and again without any risk, it will just make your change from your playbook happen on the server.</p><h1>Administration</h1><p>Connect to the master node of your stack, and open the REGARDS working directory.<br>
<!-- -->To do that, you need these two values from your inventories :</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">group_workdir_local</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /opt/regards/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">group_stack_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;regards-cnes&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>It means your stack is installed inside <code>/opt/regards/regards-cnes</code>.</p><p>Open this folder and go to the cli folder:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> /opt/regards/regards-cnes/cli</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Let&#x27;s look at these scripts :</p><ul><li><code>exec.sh</code>: let you go inside a running container. For advanced debugging.</li><li><code>logs.sh</code>: let you display container logs from a running container. Once the stack is running fine, you should prefer to use Kibana to see logs</li><li><code>reboot.sh</code>: let you reboot a container</li><li><code>status.sh</code>: display the status of your stack (running container, how many containers are missing, history)</li><li><code>update-all.sh</code>: boot or update the stack using stack files. It checks for updated images on the Docker registry, and track updates on files available on the master node.</li><li><code>update.sh</code>: let you fetch an updated docker image and reboot only that single container. For advanced usage, you should prefer <code>update-all.sh</code>.</li></ul><p>If you want to stop the stack, you can execute the following (note we use the <code>group_stack_name</code>) :</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> stack </span><span class="token function" style="color:rgb(130, 170, 255)">rm</span><span class="token plain"> regards-cnes</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When you deploy the stack, you should run <code>status.sh</code> to see if containers are running:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">HISTORY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> PREVIOUS CONTAINERS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nothing found </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> stack: regards-cnes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">RUNNING</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">25</span><span class="token plain">/25</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ID      NAME                                               IMAGE                                            NODE                                 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">  CURRENT STATE      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">86</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-fluent.w4pf3rfr47yjny8y2jmvy9n0s   myregistry/regards-fluent:latest              regards-cnes-d12.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nh</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-fluent.jh7i65fsxbrnce85yjexucna3   myregistry/regards-fluent:latest              regards-cnes-d13.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">77</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-fluent.iodt1aszolajpqq5f12q12v1w   myregistry/regards-fluent:latest              regards-cnes-d11.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ij</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-admin.1                            myregistry/rs-administration:V1.1.0           regards-cnes-d11.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">lh</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-postgres.1                         myregistry/regards-database:latest            regards-cnes-d12.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-phppgadmin.1                       myregistry/regards-phpmyadmin:latest          regards-cnes-d12.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">59</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-notifier.1                         myregistry/rs-notifier:V1.1.0                 regards-cnes-d11.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-logs-elasticsearch.1               myregistry/regards-elasticsearch:latest       regards-cnes-d13.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">jd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-kibana.1                           myregistry/regards-kibana:latest              regards-cnes-d13.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-dam.1                              myregistry/rs-dam:V1.1.0                      regards-cnes-d12.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ir</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-access-instance.1                  myregistry/rs-access-instance:V1.1.0          regards-cnes-d11.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-fem.1                              myregistry/rs-fem:V1.1.0                      regards-cnes-d12.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">lx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-config.1                           myregistry/rs-config:V1.1.0                   regards-cnes-d11.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2k</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-authentication.1                   myregistry/rs-authentication:V1.1.0           regards-cnes-d13.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mh</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-catalog.1                          myregistry/rs-catalog:V1.1.0                  regards-cnes-d12.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">qu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-registry.1                         myregistry/rs-registry:V1.1.0                 regards-cnes-d13.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">8m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-rabbitmq.1                         myregistry/regards-messaging:latest           regards-cnes-d12.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">n9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-maildev.1                          myregistry/regards-maildev:latest             regards-cnes-d13.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">m8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-logs-kibana.1                      myregistry/regards-kibana:latest              regards-cnes-d12.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ke</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-elasticsearch.1                    myregistry/regards-elasticsearch:latest       regards-cnes-d13.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-access-project.1                   myregistry/rs-access-project:V1.1.0           regards-cnes-d13.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">51</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-gateway.1                          myregistry/rs-gateway:V1.1.0                  regards-cnes-d13.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">jd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-front.1                            myregistry/rs-front:V1.1.0                    regards-cnes-d13.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">y4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">    regards-cnes_rs-admin-instance.1                   myregistry/rs-administration-instance:V1.1.0  regards-cnes-d13.myorganisation.com      Running </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain"> hours ago</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the history, there is no container starting again and again every minutes. That&#x27;s what we&#x27;re expecting in a production environment.<br>
<!-- -->Moreover, we display the number of running containers and the number of expected ones. In this exemple everything is fine (<code>[RUNNING] 25/25</code>).
The current state of these containers is also important. You need to wait 5 to 15 minutes to see if containers succeed to boot, some containers are waiting to others so they usually crash in that short period if there is some files unwritable, COTS not accessible...</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The number of running services depends of your inventory. You may see less actives services than this exemple, but the <code>[RUNNING] X/X</code> must equals 100%.</p></div></div><p>Now, let&#x27;s see how you can debug some microservice.
First, let&#x27;s remove the elasticsearch:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> scale regards-cnes_rs-elasticsearch</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then, reboot dam:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./reboot.sh rs-dam</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now we can read logs of the booting dam to see if it succeed to boot without ElasticSearch :</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$./logs.sh rs-dam -f</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">regards-cnes_rs-dam.1.w5gxg6x1mn2x@regards-cnes-d13.myorganisation.com    </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2020</span><span class="token plain">-05-12 </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain">:49:54,315 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">rs-dam</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">main            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> ERROR o.s.boot.SpringApplication </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">    - Application run failed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">regards-cnes_rs-dam.1.w5gxg6x1mn2x@regards-cnes-d13.myorganisation.com    </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> Caused by: java.net.UnknownHostException: rs-elasticsearch: Try again</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Not, it doesn&#x27;t like it. Now we can restart the ElasticSearch by just running :</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./update-all.sh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now we can run again <code>status.sh</code> :</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ./status.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">HISTORY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> PREVIOUS CONTAINERS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ID      NAME                                               IMAGE                                                                     NODE                                  DESIRED STATE CURRENT STATE </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">86m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">   regards-cnes_rs-fluent.w4pf3rfr47yjny8y2jmvy9n0s   </span><span class="token number" style="color:rgb(247, 140, 108)">172.26</span><span class="token plain">.46.158/regards-fluent:latest@sha256:4e733e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">                    regards-cnes-d12.myorganisation.com   Shutdown      Shutdown </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> minutes ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nhu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">   regards-cnes_rs-fluent.jh7i65fsxbrnce85yjexucna3   </span><span class="token number" style="color:rgb(247, 140, 108)">172.26</span><span class="token plain">.46.158/regards-fluent:latest@sha256:4e733e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">                    regards-cnes-d13.myorganisation.com   Shutdown      Shutdown </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> minutes ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">778</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">   regards-cnes_rs-fluent.iodt1aszolajpqq5f12q12v1w   </span><span class="token number" style="color:rgb(247, 140, 108)">172.26</span><span class="token plain">.46.158/regards-fluent:latest@sha256:4e733e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">                    regards-cnes-d11.myorganisation.com   Shutdown      Shutdown </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> minutes ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ty0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">   regards-cnes_rs-authentication.1                   </span><span class="token number" style="color:rgb(247, 140, 108)">172.26</span><span class="token plain">.46.158/rs-authentication:fast-release-V1.1.0@sha256:875ca2aa</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">   regards-cnes-d13.myorganisation.com   Shutdown      Shutdown </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> minute ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">7yw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">   regards-cnes_rs-access-project.1                   </span><span class="token number" style="color:rgb(247, 140, 108)">172.26</span><span class="token plain">.46.158/rs-access-project:fast-release-V1.1.0@sha256:17a0d7e9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">   regards-cnes-d13.myorganisation.com   Shutdown      Shutdown </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> minute ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">RUNNING</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">25</span><span class="token plain">/25</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We see in the history the last activity starts to be old (2 mins) and there is again 25/25 services deployed.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/RegardsOss/RegardsOss.github.io/edit/master/versioned_docs/version-1.6.0/setup/deprecated/swarm.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a><ul><li><a href="#software-requirements" class="table-of-contents__link toc-highlight">Software requirements</a></li><li><a href="#settings--environnement" class="table-of-contents__link toc-highlight">Settings &amp; Environnement</a></li><li><a href="#cots-versions" class="table-of-contents__link toc-highlight">COTS versions</a></li><li><a href="#users" class="table-of-contents__link toc-highlight">Users</a></li></ul></li><li><a href="#ansible" class="table-of-contents__link toc-highlight">Ansible</a><ul><li><a href="#get-the-source" class="table-of-contents__link toc-highlight">Get the source</a></li><li><a href="#create-your-inventory" class="table-of-contents__link toc-highlight">Create your inventory</a></li><li><a href="#inventory-configuration" class="table-of-contents__link toc-highlight">Inventory configuration</a></li></ul></li><li><a href="#deploy" class="table-of-contents__link toc-highlight">Deploy</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container_grid_bQnQ"><div class="col_1_KTIr"><p><strong>A framework and a set of plugins to build scientific archives.</strong></p><p>REGARDS is an Open Source data valorization product, highly flexible to various themes, modular, efficient, long-lasting, evolutionary and scalable, aims at providing services to Mission Centers and laboratories, and is able to deal with huge amount of data. <br>Our goal is to allow a strong commitment from user community in the development of modules and plugins.</p><p><strong>We welcome <a href="https://github.com/RegardsOss/RegardsOss.github.io/blob/master/CONTRIBUTING.md">your contributions</a> to make these documents better.</strong></p><div><img src="/img/logos/courbe-institutionnelle-signature_y110-inverser.png"></div></div><div class="col_2_Jonb"><h4 class="footer__title">Users</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/user-guide/">Manual</a></li></ul></div><div class="col_2_Jonb"><h4 class="footer__title">Developpers</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/setup/">Install</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/development/backend/architecture/concepts/">Backend</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/development/frontend/introduction/setup/">Frontend</a></li></ul></div><div class="col_2_Jonb"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/RegardsOss/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 REGARDS, OSS. Built with Docusaurus.</div></div></footer></div>
<script src="/assets/js/runtime~main.09813f13.js"></script>
<script src="/assets/js/main.fb73c99e.js"></script>
</body>
</html>