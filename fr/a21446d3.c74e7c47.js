(window.webpackJsonp=window.webpackJsonp||[]).push([[1668],{1738:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return a})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return i}));var l=n(3),b=n(7),c=(n(0),n(2701)),r={id:"depracated-server-configuration",title:"Minimal server configuration",slug:"/setup/deprecated/server-configuration"},a={unversionedId:"setup/deprecated/depracated-server-configuration",id:"version-1.4.0/setup/deprecated/depracated-server-configuration",isDocsHomePage:!1,title:"Minimal server configuration",description:"In this guide, we'll see what is expected by REGARDS components, then we will see how to configure components that we rely on.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-1.4.0/setup/deprecated/configuration.md",slug:"/setup/deprecated/server-configuration",permalink:"/fr/docs/1.4.0/setup/deprecated/server-configuration",editUrl:"https://github.com/RegardsOss/RegardsOss.github.io/edit/master/i18n/fr/docusaurus-plugin-content-docs/version-1.4.0/setup/deprecated/configuration.md",version:"1.4.0"},s=[{value:"Prerequisites",id:"prerequisites",children:[{value:"System",id:"system",children:[]},{value:"Regards",id:"regards",children:[]},{value:"SMTP mail server",id:"smtp-mail-server",children:[]},{value:"Password",id:"password",children:[]}]},{value:"Linux users",id:"linux-users",children:[]},{value:"Postgres",id:"postgres",children:[]},{value:"RabbitMQ",id:"rabbitmq",children:[]},{value:"Elasticsearch",id:"elasticsearch",children:[]},{value:"Kibana",id:"kibana",children:[]},{value:"Reverse proxy",id:"reverse-proxy",children:[{value:"httpd",id:"httpd",children:[]},{value:"NGinx",id:"nginx",children:[]}]},{value:"Security and firewall",id:"security-and-firewall",children:[{value:"Installation on a single server",id:"installation-on-a-single-server",children:[]},{value:"Install on several servers",id:"install-on-several-servers",children:[]}]},{value:"Systemctl",id:"systemctl",children:[{value:"Configuration",id:"configuration",children:[]},{value:"Auto restart services on boot",id:"auto-restart-services-on-boot",children:[]}]}],o={toc:s};function i(e){var t=e.components,n=Object(b.a)(e,["components"]);return Object(c.b)("wrapper",Object(l.a)({},o,n,{components:t,mdxType:"MDXLayout"}),Object(c.b)("p",null,"In this guide, we'll see what is expected by REGARDS components, then we will see how to configure components that we rely on."),Object(c.b)("h2",{id:"prerequisites"},"Prerequisites"),Object(c.b)("h3",{id:"system"},"System"),Object(c.b)("p",null,"For a basic setup, to install REGARDS, PostgreSQL, RabbitMQ and ElasticSearch on a single server, you will need :"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"16Gb RAM"),Object(c.b)("li",{parentName:"ul"},"4 to 8 vCPU")),Object(c.b)("p",null,"We'll assume you want to install REGARDS in ",Object(c.b)("inlineCode",{parentName:"p"},"/opt/regards"),", so don't forget to adapt this path if you install it somewhere else."),Object(c.b)("h3",{id:"regards"},"Regards"),Object(c.b)("p",null,"Any server that hosts a REGARDS component needs:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Java OpenJDK JRE 1.8"),Object(c.b)("li",{parentName:"ul"},"access to the database PostgreSQL"),Object(c.b)("li",{parentName:"ul"},"access to the message broker RabbitMQ"),Object(c.b)("li",{parentName:"ul"},"access to a SMTP mail server")),Object(c.b)("p",null,"And for components ",Object(c.b)("inlineCode",{parentName:"p"},"Data Management")," and ",Object(c.b)("inlineCode",{parentName:"p"},"Catalog"),":"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"access to the ElasticSearch")),Object(c.b)("h3",{id:"smtp-mail-server"},"SMTP mail server"),Object(c.b)("p",null,"You can use any SMTP mail server you want. The connection properties have to be provided during the REGARDS installation."),Object(c.b)("h3",{id:"password"},"Password"),Object(c.b)("p",null,"Components requires a cipher to encrypt some sensible information using AES algorithm."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"mkdir /opt/regards\nopenssl rand -hex 8 > /opt/regards/regards.key\n")),Object(c.b)("p",null,"For maximum security, cipher key should only be readable by user ",Object(c.b)("inlineCode",{parentName:"p"},"regards"),". We strongly advice you to execute the following commands as root:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"chown regards:root /opt/regards/regards.key\nchmod 0400 /opt/regards/regards.key\n")),Object(c.b)("p",null,"The Izpack installer will ask you where is located the ",Object(c.b)("inlineCode",{parentName:"p"},"regards.key")," file, so put it in the REGARDS root folder."),Object(c.b)("h2",{id:"linux-users"},"Linux users"),Object(c.b)("p",null,"If you want to install the component with limited access rights (ie ",Object(c.b)("inlineCode",{parentName:"p"},"Security Level")," to ",Object(c.b)("inlineCode",{parentName:"p"},"Enforce"),"), you need to create users and groups:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"groupadd regards\ngroupadd rsins\ngroupadd rsexec\ngroupadd rsadmin\ngroupadd rsrun\nuseradd rsins -g rsins -G regards,rsexec,rsadmin,rsrun\npasswd rsins\nuseradd rsadmin -g regards -G rsadmin,rsrun\npasswd rsadmin\nuseradd regards --no-create-home --shell=/sbin/nologin -g regards -G rsexec,rsrun\n")),Object(c.b)("p",null,"And you need to update access rights of the installation folder:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"chown :regards /opt/regards\nchmod 1770 /opt/regards\n")),Object(c.b)("h2",{id:"postgres"},"Postgres"),Object(c.b)("p",null,"Install the database ",Object(c.b)("a",{parentName:"p",href:"https://www.postgresql.org/"},"PostgreSQL")," 9.6.X.",Object(c.b)("br",{parentName:"p"}),"\n",Object(c.b)("inlineCode",{parentName:"p"},"Notice :")," Do not use a further version like 10.X."),Object(c.b)("p",null,"You can also install ",Object(c.b)("a",{parentName:"p",href:"http://phppgadmin.sourceforge.net/doku.php"},"phpPgAdmin")," to monitor the database."),Object(c.b)("p",null,"Here is how to init Postgres on Red Hat OS:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"su postgres -s /bin/bash -c '/usr/pgsql-9.6/bin/initdb -D /var/lib/pgsql/9.6/data/'\nsystemctl start postgresql-9.6.service\n")),Object(c.b)("p",null,"This is how to create a postgres user named ",Object(c.b)("inlineCode",{parentName:"p"},"rs_postgres")," using the PostgreSQL cli:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"cd /\nsu postgres\ncreateuser -P --interactive rs_postgres\n# Define that user password, then\n# answer no to all questions\n")),Object(c.b)("p",null,"After your user is created, you have to add the authentication method in the pg_hba.conf. Here under is an exemple for local authentication."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},'# "local" is for Unix domain socket connections only\nlocal   all             rs_postgres                             md5\nlocal   all             postgres                                md5\n# IPv4 local connections:\nhost    all             all             127.0.0.1/32            md5\n')),Object(c.b)("p",null,"You will need at least two databases, one for REGARDS instance and one for the first REGARDS project."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"createdb -O rs_postgres -E UTF8 rs_instance\ncreatedb -O rs_postgres -E UTF8 rs_project1\n")),Object(c.b)("p",null,"If you want to use REGARDS with a large number of projects, you may need to configure the maximum number of connections allowed by your postgres server. Indeed, in REGARDS each project needs a connection pool with at least 3connections per microservice."),Object(c.b)("p",null,"For exemple if you install all REGARDS project microservices (9) you will need 27 (9microservices ","*"," 3connections) connections per project."),Object(c.b)("p",null,"By default a postgres server allows 100 connections per server. So if you not planning to use more than 3 projects you don't need any modifications. So if you plan to create more than 3 projects you have to increase the maximum number of allowed connections.",Object(c.b)("br",{parentName:"p"}),"\n","To do so :"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"Increase max_connection and shared_buffers")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"in /var/lib/pgsql/data/postgresql.conf\nChange\nmax_connections = 100\nshared_buffers = 24MB\n\nto\nmax_connections = 300\nshared_buffers = 80MB\n")),Object(c.b)("ol",{start:2},Object(c.b)("li",{parentName:"ol"},"Change kernel.shmmax")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"In /etc/sysctl.conf\nkernel.shmmax=100663296\n")),Object(c.b)("p",null,"Notice : REGARDS project microservices are ",Object(c.b)("inlineCode",{parentName:"p"},"access-project"),", ",Object(c.b)("inlineCode",{parentName:"p"},"admin"),", ",Object(c.b)("inlineCode",{parentName:"p"},"authentication"),", ",Object(c.b)("inlineCode",{parentName:"p"},"catalog"),", ",Object(c.b)("inlineCode",{parentName:"p"},"dam"),", ",Object(c.b)("inlineCode",{parentName:"p"},"dataprovider"),", ",Object(c.b)("inlineCode",{parentName:"p"},"ingest"),", ",Object(c.b)("inlineCode",{parentName:"p"},"order")," and ",Object(c.b)("inlineCode",{parentName:"p"},"storage")),Object(c.b)("h2",{id:"rabbitmq"},"RabbitMQ"),Object(c.b)("p",null,"Install RabbitMQ Server 3.6.X ",Object(c.b)("a",{parentName:"p",href:"https://www.rabbitmq.com/download.html#installation-guides"},"using the official documentation"),".",Object(c.b)("br",{parentName:"p"}),"\n",Object(c.b)("inlineCode",{parentName:"p"},"Notice :")," Do not use a further version like 3.7.X."),Object(c.b)("p",null,"Then on Red Hat OS, you need to create some basic configuration:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},'# Provide a default configuration\ncp /usr/share/doc/rabbitmq-server-3.6.8/rabbitmq.config.example /etc/rabbitmq/rabbitmq.config.ori\ncp /etc/rabbitmq/rabbitmq.config.ori /etc/rabbitmq/rabbitmq.config\n\n# Create localhost configuration file\necho "\nvm.max_map_count=262144" >> /etc/sysctl.conf\n\n# Allow the rabbitmq default user to manage its config files\nchown -R :rabbitmq  /etc/rabbitmq\nchmod 0770 /etc/rabbitmq\nchmod 0640  /etc/rabbitmq/*\n\n# Configure data & logs directory\n\nWithout configuration rabbitmq will store all is files in /var/lib/rabbitmq. This can be a huge problem in production. To avoid this, follow the configuration here under.\n\necho "\nRABBITMQ_MNESIA_BASE=<data directory>\nRABBITMQ_LOG_BASE=<logs directory>\n" >> /etc/rabbitmq/rabbitmq-env.conf\n\n# Start the service\nsystemctl start rabbitmq-server.service\n')),Object(c.b)("p",null,"We advise the following configuration of RabbitMQ for production environments, in /etc/rabbitmq/rabbitmq.conf:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"vm_memory_high_watermark: 0.4"),Object(c.b)("li",{parentName:"ul"},"disk_free_limit: {mem_relative, 2.0}")),Object(c.b)("p",null,"Once you have installed RabbitMQ, you need to activate the management plugin"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"su rabbitmq -s /bin/bash -c 'rabbitmq-plugins enable rabbitmq_management'\n")),Object(c.b)("p",null,"Then, using the ",Object(c.b)("a",{parentName:"p",href:"https://www.rabbitmq.com/rabbitmqctl.8.html#User_Management"},"RabbitMQ REST API")," or the management console, you need to activate the guest user, or create another one, that can :"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"create ",Object(c.b)("a",{parentName:"li",href:"https://www.rabbitmq.com/vhosts.html"},"vhosts")),Object(c.b)("li",{parentName:"ul"},"add rights to others users")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},'# Create a RabbitMQ admin named regards_adm\nrabbitmqctl add_user regards_adm regards_adm\nrabbitmqctl set_user_tags regards_adm administrator\nrabbitmqctl set_permissions -p / regards_adm "." ".*" "."\n')),Object(c.b)("p",null,"If you want increased security on RabbitMQ, you can run ",Object(c.b)("inlineCode",{parentName:"p"},'rabbitmqctl set_permissions -p / regards_adm "^$" "^$" "^$"')," after REGARDS has been started at least once."),Object(c.b)("h2",{id:"elasticsearch"},"Elasticsearch"),Object(c.b)("p",null,"Install ",Object(c.b)("a",{parentName:"p",href:"https://www.elastic.co/fr/downloads"},"ElasticSearch")," 6.X.",Object(c.b)("br",{parentName:"p"}),"\n",Object(c.b)("inlineCode",{parentName:"p"},"Notice :")," Do not use a further version like 7.X."),Object(c.b)("p",null,"If ",Object(c.b)("inlineCode",{parentName:"p"},"grep vm.max_map_count /etc/sysctl.conf")," returns empty, you need to execute the following:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},'sysctl -w vm.max_map_count=262144\necho "\nvm.max_map_count=262144" >> /etc/sysctl.conf\n')),Object(c.b)("p",null,"We advise the following configuration for production environments:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"change ",Object(c.b)("strong",{parentName:"li"},"network.host")," to ",Object(c.b)("inlineCode",{parentName:"li"},"0.0.0.0")),Object(c.b)("li",{parentName:"ul"},"change ",Object(c.b)("strong",{parentName:"li"},"cluster.name")),Object(c.b)("li",{parentName:"ul"},"change ",Object(c.b)("strong",{parentName:"li"},"node.name")),Object(c.b)("li",{parentName:"ul"},"change ",Object(c.b)("strong",{parentName:"li"},"path.data")),Object(c.b)("li",{parentName:"ul"},"configure manually the list of hosts from the cluster"),Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"gateway.recover_after_node")," should be the number of node deployed in the cluster"),Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"discovery.zen.minimum_master_nodes")," should be ",Object(c.b)("inlineCode",{parentName:"li"},"n/2+1")," when n is the number of node in the cluster"),Object(c.b)("li",{parentName:"ul"},"Elasticsearch being taking advantage of some file system features, if elasticsearch has his dedicated server, ",Object(c.b)("strong",{parentName:"li"},"HEAP_SIZE")," should be no more than half of the server memory."),Object(c.b)("li",{parentName:"ul"},"elasticsearch ",Object(c.b)("strong",{parentName:"li"},"HEAP_SIZE")," should be no more than ",Object(c.b)("inlineCode",{parentName:"li"},"32GB")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"bootstrap.memory_lock")," is set to ",Object(c.b)("inlineCode",{parentName:"li"},"true"))),Object(c.b)("p",null,"For Red Hat OS, you just need to start it :"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"systemctl enable elasticsearch.service\nsystemctl start elasticsearch.service\n")),Object(c.b)("p",null,"If you have trouble we jna while starting Elasticsearch, it may come from the fact that your ",Object(c.b)("inlineCode",{parentName:"p"},"/tmp")," is mounted with ",Object(c.b)("strong",{parentName:"p"},"noexec")," option. In that case, you have to do the following:"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"In ",Object(c.b)("strong",{parentName:"li"},"/etc/sysconfig/elasticsearch"),":")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},'ES_JAVA_OPTS="-Djna.tmpdir=/opt/elasticsearch-jnatmp"\n')),Object(c.b)("ol",{start:2},Object(c.b)("li",{parentName:"ol"},"Create ",Object(c.b)("strong",{parentName:"li"},"/opt/elasticsearch-jnatmp"))),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"mkdir /opt/elasticsearch-jnatmp\nchown elasticsearch:elasticsearc /opt/elasticsearch-jnatmp\n")),Object(c.b)("ol",{start:3},Object(c.b)("li",{parentName:"ol"},"Add a home dir to user elastisearch, in ",Object(c.b)("strong",{parentName:"li"},"/etc/passwd"),":")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"elasticsearch:x:995:154:elasticsearch user:/home/elasticsearch:/sbin/nologin\n")),Object(c.b)("ol",{start:4},Object(c.b)("li",{parentName:"ol"},"Create elasticsearch home dir ",Object(c.b)("strong",{parentName:"li"},"/home/elasticsearch"),", as root:")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"cd /home\nmkdir elasticsearch\nchown elasticsearch:elasticsearch elasticsearch/\n")),Object(c.b)("ol",{start:5},Object(c.b)("li",{parentName:"ol"},"In ",Object(c.b)("strong",{parentName:"li"},"/etc/systemd/system/elasticsearch.service.d/override.conf"))),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"[Service]\nLimitMEMLOCK=infinity\n")),Object(c.b)("h2",{id:"kibana"},"Kibana"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"This COTS is non-mandatory but higly recommended for administrators of REGARDS system.")),Object(c.b)("p",null,"Installation of ",Object(c.b)("a",{parentName:"p",href:"https://www.elastic.co/fr/downloads"},"Kibana")," 5.X.",Object(c.b)("br",{parentName:"p"}),"\n",Object(c.b)("inlineCode",{parentName:"p"},"Notice :")," Do not use a further version like 6.X."),Object(c.b)("p",null,"This web server allows you to manage the content of your elasticsearch indexes."),Object(c.b)("h2",{id:"reverse-proxy"},"Reverse proxy"),Object(c.b)("p",null,"Install ",Object(c.b)("a",{parentName:"p",href:"https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/"},"NGinx")," (1.15+) or ",Object(c.b)("a",{parentName:"p",href:"http://httpd.apache.org/docs/current/fr/install.html"},"httpd")," (2.X+) as a reverse proxy, it handles on a single port (80 or 443) all trafic for the REGARDS."),Object(c.b)("h3",{id:"httpd"},"httpd"),Object(c.b)("p",null,"For httpd, edit the file ",Object(c.b)("inlineCode",{parentName:"p"},"/etc/httpd/conf/httpd.conf"),":"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"<IfModule mod_proxy.c>\n        <Proxy *>\n          Order deny,allow\n          Deny from all\n        </Proxy>\n        ProxyRequests Off\n        ProxyPreserveHost Off\n</IfModule>\n")),Object(c.b)("p",null,"Then create the configuration:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},'cat > /etc/httpd/conf.d/httpd-proxy.conf <<FIN_CAT\nProxyVia On\n<IfModule mod_proxy.c>\n    <VirtualHost *:80>\n        ProxyPass "/kibana/"       "http://localhost:5601/"                connectiontimeout=5 timeout=30\n        ProxyPass "/api/v1/"       "http://localhost:9030/api/v1/"         connectiontimeout=5 timeout=30\n        ProxyPass "/zuul/api/v1/"  "http://localhost:9030/zuul/api/v1/"    connectiontimeout=5 timeout=30\n        ProxyPass "/"              "http://localhost:3333/"                connectiontimeout=5 timeout=30\n        ProxyPreserveHost Off\n    </VirtualHost>\n</IfModule>\n\n<Directory />\n    Options None\n    Order deny,allow\n    deny from all\n    <LimitExcept GET HEAD POST DELETE PUT>\n        order deny,allow\n        deny from all\n    </LimitExcept>\n</Directory>\n\n<Location "/" >\n    Order deny,allow\n    <LimitExcept GET HEAD POST DELETE PUT>\n        order deny,allow\n        deny from all\n    </LimitExcept>\n</Location>\nFIN_CAT\n')),Object(c.b)("p",null,"For Red Hat OS, you need to start it:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"systemctl start httpd.service\n")),Object(c.b)("p",null,"If you are using a ",Object(c.b)("inlineCode",{parentName:"p"},"Red Hat OS")," with ",Object(c.b)("inlineCode",{parentName:"p"},"selinux"),", you will need to autorize httpd to connect to the network, even a local one. If the following property is off :"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"$ getsebool -a | grep httpd_can_network_connect\nhttpd_can_network_connect --\x3e off\n")),Object(c.b)("p",null,"You need to execute the following:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"/usr/sbin/setsebool -P httpd_can_network_connect 1\n")),Object(c.b)("h3",{id:"nginx"},"NGinx"),Object(c.b)("p",null,"For NGinx :"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"worker_processes auto;\n\nuser root root;\npid /run/nginx.pid;\n\nevents {\n    worker_connections 4096;\n    use                epoll;\n    multi_accept       on;\n}\n\nhttp {\n    sendfile            on;\n    tcp_nopush          on;\n    tcp_nodelay         on;\n    keepalive_timeout   65;\n    types_hash_max_size 2048;\n\n    include      /etc/nginx/mime.types;\n    default_type application/octet-stream;\n\n    access_log /var/log/nginx/access.log combined;\n    error_log /var/log/nginx/error.log error;\n\n    gzip         on;\n    gzip_disable \"msie6\";\n\n    client_max_body_size 100M;\n\n    upstream gateway {\n        server rs-gateway:9030;\n    }\n\n    server {\n        listen 80 default_server;\n\n        location /api/v1/ {\n           proxy_set_header X-Forwarded-Host $host:$server_port;\n           proxy_pass http://gateway/api/v1/;\n        }\n\n        location /zuul/api/v1/ {\n           proxy_set_header X-Forwarded-Host $host:$server_port;\n           proxy_pass http://gateway/zuul/api/v1/;\n        }\n\n        location / {\n            root /var/www;\n            # Always serve index.html for any request\n            try_files $uri /index.html;\n            # kill cache\n            add_header Last-Modified $date_gmt;\n            add_header Cache-Control 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';\n            if_modified_since off;\n            expires off;\n            etag off;\n        }\n    }\n}\n")),Object(c.b)("h2",{id:"security-and-firewall"},"Security and firewall"),Object(c.b)("p",null,"If you use iptable as a firewall, we strongly recommand you to deny everything except what is required."),Object(c.b)("h3",{id:"installation-on-a-single-server"},"Installation on a single server"),Object(c.b)("p",null,"You need to open httpd or nginx port in the file ",Object(c.b)("inlineCode",{parentName:"p"},"/etc/sysconfig/iptables"),":"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT\n")),Object(c.b)("h3",{id:"install-on-several-servers"},"Install on several servers"),Object(c.b)("p",null,"Here is a list of all flux needed by each microservice:"),Object(c.b)("table",{class:"table table-striped"},Object(c.b)("tr",null,Object(c.b)("th",{rowspan:"2"},"Protocol"),Object(c.b)("th",{colspan:"1",scope:"colgroup"},"Source"),Object(c.b)("th",{colspan:"2",scope:"colgroup"},"Target"),Object(c.b)("th",{rowspan:"2"},"Flux description")),Object(c.b)("tr",null,Object(c.b)("th",{scope:"col"},"Component"),Object(c.b)("th",{scope:"col"},"Component"),Object(c.b)("th",{scope:"col"},"Port")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-access-instance"),Object(c.b)("td",null,"rs-config"),Object(c.b)("td",null,"9031"),Object(c.b)("td",null,"Get configuration")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-access-instance"),Object(c.b)("td",null,"rs-registry"),Object(c.b)("td",null,"9032"),Object(c.b)("td",null,"Microservice registering")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-access-instance"),Object(c.b)("td",null,"PostgreSQL"),Object(c.b)("td",null,"5432"),Object(c.b)("td",null,"DB access")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"rs-config"),Object(c.b)("td",null,"9031"),Object(c.b)("td",null,"Get configuration")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"rs-registry"),Object(c.b)("td",null,"9032"),Object(c.b)("td",null,"Microservice registering")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"15672"),Object(c.b)("td",null,"AMQP management(exchanges, queues, bindings, vhosts)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"5672"),Object(c.b)("td",null,"sending/receiving AMQP messages")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"PostgreSQL"),Object(c.b)("td",null,"5432"),Object(c.b)("td",null,"DB access")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"9037"),Object(c.b)("td",null,"Access to instance information (tenant/Account)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"rs-config"),Object(c.b)("td",null,"9031"),Object(c.b)("td",null,"Get configuration")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"rs-registry"),Object(c.b)("td",null,"9032"),Object(c.b)("td",null,"Microservice registering")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"15672"),Object(c.b)("td",null,"AMQP management(exchanges, queues, bindings, vhosts)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"5672"),Object(c.b)("td",null,"sending/receiving AMQP messages")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"PostgreSQL"),Object(c.b)("td",null,"5432"),Object(c.b)("td",null,"DB access")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dam"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"9037"),Object(c.b)("td",null,"Access to instance information (tenant/Account)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dam"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"9033"),Object(c.b)("td",null,"Access to project information (User/Role/Notification)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dam"),Object(c.b)("td",null,"rs-config"),Object(c.b)("td",null,"9031"),Object(c.b)("td",null,"Get configuration")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dam"),Object(c.b)("td",null,"rs-registry"),Object(c.b)("td",null,"9032"),Object(c.b)("td",null,"Microservice registering")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dam"),Object(c.b)("td",null,"Elasticsearch"),Object(c.b)("td",null,"9200"),Object(c.b)("td",null,"Access to indexed data")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dam"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"15672"),Object(c.b)("td",null,"AMQP management (exchanges, queues, bindings, vhosts)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dam"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"5672"),Object(c.b)("td",null,"sending/receiving AMQP messages")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dam"),Object(c.b)("td",null,"PostgreSQL"),Object(c.b)("td",null,"5432"),Object(c.b)("td",null,"DB access")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dataprovider"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"9037"),Object(c.b)("td",null,"Access to instance information (tenant/Account)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dataprovider"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"9033"),Object(c.b)("td",null,"Access to project information (User/Role/Notification)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dataprovider"),Object(c.b)("td",null,"rs-config"),Object(c.b)("td",null,"9031"),Object(c.b)("td",null,"Get configuration")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dataprovider"),Object(c.b)("td",null,"rs-ingest"),Object(c.b)("td",null,"9044"),Object(c.b)("td",null,"Sends SIP")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dataprovider"),Object(c.b)("td",null,"rs-registry"),Object(c.b)("td",null,"9032"),Object(c.b)("td",null,"Microservice registering")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dataprovider"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"15672"),Object(c.b)("td",null,"AMQP management(exchanges, queues, bindings, vhosts)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dataprovider"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"5672"),Object(c.b)("td",null,"sending/receiving AMQP messages")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-dataprovider"),Object(c.b)("td",null,"PostgreSQL"),Object(c.b)("td",null,"5432"),Object(c.b)("td",null,"DB access")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-ingest"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"9037"),Object(c.b)("td",null,"Access to instance information (tenant/Account)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-ingest"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"9033"),Object(c.b)("td",null,"Access to project information (User/Role/Notification)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-ingest"),Object(c.b)("td",null,"rs-config"),Object(c.b)("td",null,"9031"),Object(c.b)("td",null,"Get configuration")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-ingest"),Object(c.b)("td",null,"rs-registry"),Object(c.b)("td",null,"9032"),Object(c.b)("td",null,"Microservice registering")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-ingest"),Object(c.b)("td",null,"rs-storage"),Object(c.b)("td",null,"9042"),Object(c.b)("td",null,"Sends AIP")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-ingest"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"15672"),Object(c.b)("td",null,"AMQP management (exchanges, queues, bindings, vhosts)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-ingest"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"5672"),Object(c.b)("td",null,"sending/receiving AMQP messages")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-ingest"),Object(c.b)("td",null,"PostgreSQL"),Object(c.b)("td",null,"5432"),Object(c.b)("td",null,"DB access")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-storage"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"9037"),Object(c.b)("td",null,"Access to instance information (tenant/Account)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-storage"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"9033"),Object(c.b)("td",null,"Access to project information (User/Role/Notification)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-storage"),Object(c.b)("td",null,"rs-catalog"),Object(c.b)("td",null,"9036"),Object(c.b)("td",null,"Plugin CatalogSecurityDelegation")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-storage"),Object(c.b)("td",null,"rs-config"),Object(c.b)("td",null,"9031"),Object(c.b)("td",null,"Get configuration")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-storage"),Object(c.b)("td",null,"rs-registry"),Object(c.b)("td",null,"9032"),Object(c.b)("td",null,"Microservice registering")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-storage"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"15672"),Object(c.b)("td",null,"AMQP management(exchanges, queues, bindings, vhosts)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-storage"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"5672"),Object(c.b)("td",null,"sending/receiving AMQP messages")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-storage"),Object(c.b)("td",null,"PostgreSQL"),Object(c.b)("td",null,"5432"),Object(c.b)("td",null,"DB access")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-access-project"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"9037"),Object(c.b)("td",null,"Access to instance information (tenant/Account)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-access-project"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"9033"),Object(c.b)("td",null,"Access to project information (User/Role/Notification)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-access-project"),Object(c.b)("td",null,"rs-config"),Object(c.b)("td",null,"9031"),Object(c.b)("td",null,"Get configuration")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-access-project"),Object(c.b)("td",null,"rs-registry"),Object(c.b)("td",null,"9032"),Object(c.b)("td",null,"Microservice registering")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-access-project"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"15672"),Object(c.b)("td",null,"AMQP management (exchanges, queues, bindings, vhosts)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-access-project"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"5672"),Object(c.b)("td",null,"sending/receiving AMQP messages")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-access-project"),Object(c.b)("td",null,"PostgreSQL"),Object(c.b)("td",null,"5432"),Object(c.b)("td",null,"DB access")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-authentication"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"9037"),Object(c.b)("td",null,"Access to instance information (tenant/Account)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-authentication"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"9033"),Object(c.b)("td",null,"Access to project information (User/Role/Notification)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-authentication"),Object(c.b)("td",null,"rs-config"),Object(c.b)("td",null,"9031"),Object(c.b)("td",null,"Get configuration")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-authentication"),Object(c.b)("td",null,"rs-registry"),Object(c.b)("td",null,"9032"),Object(c.b)("td",null,"Microservice registering")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-authentication"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"15672"),Object(c.b)("td",null,"AMQP management (exchanges, queues, bindings, vhosts)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-authentication"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"5672"),Object(c.b)("td",null,"sending/receiving AMQP messages")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-authentication"),Object(c.b)("td",null,"PostgreSQL"),Object(c.b)("td",null,"5432"),Object(c.b)("td",null,"DB access")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-catalog"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"9037"),Object(c.b)("td",null,"Access to instance information (tenant/Account)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-catalog"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"9033"),Object(c.b)("td",null,"Access to project information (User/Role/Notification)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-catalog"),Object(c.b)("td",null,"rs-config"),Object(c.b)("td",null,"9031"),Object(c.b)("td",null,"Get configuration")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-catalog"),Object(c.b)("td",null,"rs-dam"),Object(c.b)("td",null,"9035"),Object(c.b)("td",null,"Acc\xe8s aux informations sur les mod\xe8les")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-catalog"),Object(c.b)("td",null,"rs-registry"),Object(c.b)("td",null,"9032"),Object(c.b)("td",null,"Microservice registering")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-catalog"),Object(c.b)("td",null,"Elasticsearch"),Object(c.b)("td",null,"9200"),Object(c.b)("td",null,"Access to indexed data")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-catalog"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"15672"),Object(c.b)("td",null,"AMQP management (exchanges, queues, bindings, vhosts)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-catalog"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"5672"),Object(c.b)("td",null,"sending/receiving AMQP messages")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-catalog"),Object(c.b)("td",null,"PostgreSQL"),Object(c.b)("td",null,"5432"),Object(c.b)("td",null,"DB access")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-access-instance"),Object(c.b)("td",null,"9040"),Object(c.b)("td",null,"Request routing")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-access-project"),Object(c.b)("td",null,"9041"),Object(c.b)("td",null,"Request routing")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"9037"),Object(c.b)("td",null,"Request routing")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"9033"),Object(c.b)("td",null,"Request routing")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-authentication"),Object(c.b)("td",null,"9034"),Object(c.b)("td",null,"Request routing")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-catalog"),Object(c.b)("td",null,"9036"),Object(c.b)("td",null,"Request routing")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-config"),Object(c.b)("td",null,"9031"),Object(c.b)("td",null,"Get configuration")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-dam"),Object(c.b)("td",null,"9035"),Object(c.b)("td",null,"Request routing")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-dataprovider"),Object(c.b)("td",null,"9045"),Object(c.b)("td",null,"Request routing")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-ingest"),Object(c.b)("td",null,"9044"),Object(c.b)("td",null,"Request routing")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-order"),Object(c.b)("td",null,"9043"),Object(c.b)("td",null,"Request routing")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-registry"),Object(c.b)("td",null,"9032"),Object(c.b)("td",null,"Microservice registering")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"rs-storage"),Object(c.b)("td",null,"9042"),Object(c.b)("td",null,"Request routing")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-order"),Object(c.b)("td",null,"rs-admin-instance"),Object(c.b)("td",null,"9037"),Object(c.b)("td",null,"Access to instance information (tenant/Account)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-order"),Object(c.b)("td",null,"rs-admin-project"),Object(c.b)("td",null,"9033"),Object(c.b)("td",null,"Access to project information (User/Role/Notification)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-order"),Object(c.b)("td",null,"rs-catalog"),Object(c.b)("td",null,"9036"),Object(c.b)("td",null,"Access to indexed data")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-order"),Object(c.b)("td",null,"rs-config"),Object(c.b)("td",null,"9031"),Object(c.b)("td",null,"Get configuration")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-order"),Object(c.b)("td",null,"rs-dam"),Object(c.b)("td",null,"9035"),Object(c.b)("td",null,"Acc\xe8s aux informations sur les mod\xe8les")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-order"),Object(c.b)("td",null,"rs-registry"),Object(c.b)("td",null,"9032"),Object(c.b)("td",null,"Microservice registering")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-order"),Object(c.b)("td",null,"rs-storage"),Object(c.b)("td",null,"9042"),Object(c.b)("td",null,"Sends AIP")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-order"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"15672"),Object(c.b)("td",null,"AMQP management (exchanges, queues, bindings, vhosts)")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-order"),Object(c.b)("td",null,"RabbitMQ"),Object(c.b)("td",null,"5672"),Object(c.b)("td",null,"sending/receiving AMQP messages")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"rs-order"),Object(c.b)("td",null,"PostgreSQL"),Object(c.b)("td",null,"5432"),Object(c.b)("td",null,"DB access")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"httpd"),Object(c.b)("td",null,"rs-gateway"),Object(c.b)("td",null,"9030"),Object(c.b)("td",null,"Access to backend")),Object(c.b)("tr",null,Object(c.b)("td",null,"tcp"),Object(c.b)("td",null,"httpd"),Object(c.b)("td",null,"rs-front"),Object(c.b)("td",null,"9029"),Object(c.b)("td",null,"Access to frontend"))),Object(c.b)("p",null,"You can use this ",Object(c.b)("a",{parentName:"p",href:"https://github.com/RegardsOss/regards-deployment/tree/master/security/iptable-generator"},"utility")," developped to ease your security configuration. You just need to provide two CSV configuration files (using ",Object(c.b)("inlineCode",{parentName:"p"},";")," as separator):"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"the above table, ",Object(c.b)("inlineCode",{parentName:"li"},"Flow.csv")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"CompoIp.csv"),", a file describing which component is deployed on which machine (IP)")),Object(c.b)("p",null,"Then you just need to compile the utility (",Object(c.b)("inlineCode",{parentName:"p"},"mvn clean install -Dmaven.test.skip=true"),") and run the following command: ",Object(c.b)("inlineCode",{parentName:"p"},"java -DcompoIpCsv=CompoIp.csv -DflowMatrix=Flow.csv -jar iptable-generator-1.0-SNAPSHOT-jar-with-dependencies.jar"),". This will give a file with iptables correctly configured for each machine."),Object(c.b)("p",null,"Here is an example of ",Object(c.b)("em",{parentName:"p"},"CompoIp.csv"),":"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-csv"},"composant;ip\nrs-config;192.168.0.1\nrs-registry;192.168.0.2\nrs-access-instance;192.168.0.1\nrs-access-project;192.168.0.2\nrs-admin-instance;192.168.0.1\nrs-admin-project;192.168.0.1\nrs-authentication;192.168.0.2\nrs-catalog;192.168.0.2\nrs-config;192.168.0.1\nrs-dam;192.168.0.1\nrs-dataprovider;192.168.0.1\nrs-frontend;192.168.0.2\nrs-gateway;192.168.0.2\nrs-ingest;192.168.0.1\nrs-order;192.168.0.2\nrs-registry;192.168.0.2\nrs-storage;192.168.0.1\nElasticsearch;192.168.0.3\nRabbitMQ;192.168.0.3\nPostgreSQL;192.168.0.3\nhttpd;192.168.0.4\n")),Object(c.b)("p",null,"With this example you'll obtain 4 files:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"REGARDS_iptables_192.168.0.1.txt")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"REGARDS_iptables_192.168.0.2.txt")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"REGARDS_iptables_192.168.0.3.txt")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"REGARDS_iptables_192.168.0.4.txt"))),Object(c.b)("p",null,"Here is an example of the obtained file ",Object(c.b)("inlineCode",{parentName:"p"},"REGARDS_iptables_192.168.0.1.txt")," :"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"# Rules for component rs-dataprovider\n-A INPUT -p tcp -s 192.168.0.1 --dport 9045 -j ACCEPT\n# Rules for component rs-ingest\n-A INPUT -p tcp -s 192.168.0.2 --dport 9044 -j ACCEPT\n-A INPUT -p tcp -s 192.168.0.1 --dport 9044 -j ACCEPT\n# Rules for component rs-config\n-A INPUT -p tcp -s 192.168.0.2 --dport 9031 -j ACCEPT\n-A INPUT -p tcp -s 192.168.0.1 --dport 9031 -j ACCEPT\n# Rules for component rs-dam\n-A INPUT -p tcp -s 192.168.0.1 --dport 9035 -j ACCEPT\n# Rules for component rs-admin-project\n-A INPUT -p tcp -s 192.168.0.1 --dport 9033 -j ACCEPT\n-A INPUT -p tcp -s 192.168.0.2 --dport 9033 -j ACCEPT\n# Rules for component rs-storage\n-A INPUT -p tcp -s 192.168.0.1 --dport 9042 -j ACCEPT\n-A INPUT -p tcp -s 192.168.0.2 --dport 9042 -j ACCEPT\n# Rules for component rs-access-instance\n-A INPUT -p tcp -s 192.168.0.1 --dport 9040 -j ACCEPT\n# Rules for component rs-admin-instance\n-A INPUT -p tcp -s 192.168.0.1 --dport 9037 -j ACCEPT\n-A INPUT -p tcp -s 192.168.0.2 --dport 9037 -j ACCEPT\n")),Object(c.b)("h2",{id:"systemctl"},"Systemctl"),Object(c.b)("h3",{id:"configuration"},"Configuration"),Object(c.b)("p",null,"If you want to interface REGARDS and systemctl, you will need to define the file ",Object(c.b)("inlineCode",{parentName:"p"},"/etc/systemd/system/regards.service")," with the following:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"# Copyright 2017-2019 CNES - CENTRE NATIONAL d'ETUDES SPATIALES\n#\n# This file is part of REGARDS.\n#\n# REGARDS is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or\n# (at your option) any later version.\n#\n# REGARDS is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with REGARDS. If not, see <http://www.gnu.org/licenses/>.\n\n[Unit]\nDescription=REGARDS all installed service\nAfter=\nBefore=\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\n\nExecStart=/opt/regards/REGARDS/sbin/microservice_regards.sh start\nExecStop=/opt/regards/REGARDS/sbin/microservice_regards.sh stop\n\n# Give a reasonable amount of time for the server to start up/shut down\nTimeoutSec=300\n\n[Install]\nWantedBy=multi-user.target\n")),Object(c.b)("p",null,"If you want to define a more specific behavior on one microservice, you can create the file ",Object(c.b)("inlineCode",{parentName:"p"},"/etc/systemd/system/regards-<microservice_type>.service"),", with ",Object(c.b)("inlineCode",{parentName:"p"},"<microservice_type>")," being one of the REGARDS component (config,registry,gateway,admin-instanc,admin,authenticatio,storag,inges,da,catalo,orde,dataprovide,access-instanc,access-project,frontend)"),Object(c.b)("p",null,"Here is an ",Object(c.b)("inlineCode",{parentName:"p"},"regards-order.service")," example:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"# Copyright 2017-2019 CNES - CENTRE NATIONAL d'ETUDES SPATIALES\n#\n# This file is part of REGARDS.\n#\n# REGARDS is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or\n# (at your option) any later version.\n#\n# REGARDS is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with REGARDS. If not, see <http://www.gnu.org/licenses/>.\n\n[Unit]\nDescription=REGARDS all installed service\nAfter=\nBefore=\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\n\nExecStart=/opt/regards/REGARDS/sbin/microservice_regards.sh -t order start\nExecStop=/opt/regards/REGARDS/sbin/microservice_regards.sh -t order stop\n\n# Give a reasonable amount of time for the server to start up/shut down\nTimeoutSec=300\n\n[Install]\nWantedBy=multi-user.target\n")),Object(c.b)("p",null,"Now the installation is over, you can controll all yours microservices threw Systemctl :"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"systemctl <start|stop> regards.service"),", to start/stop all microservices installed on the machine"),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"systemctl restart regards-<microservice_type>.service"),", to restart one of the microservice\n-...")),Object(c.b)("h3",{id:"auto-restart-services-on-boot"},"Auto restart services on boot"),Object(c.b)("p",null,"Don't forget to restart services on (re)boot:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"systemctl enable httpd.service\nsystemctl enable elasticsearch.service\nsystemctl enable rabbitmq-server.service\nsystemctl enable postgresql-9.6.service\nsystemctl enable regards.service\n")))}i.isMDXComponent=!0},2701:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return O}));var l=n(0),b=n.n(l);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,l,b=function(e,t){if(null==e)return{};var n,l,b={},c=Object.keys(e);for(l=0;l<c.length;l++)n=c[l],t.indexOf(n)>=0||(b[n]=e[n]);return b}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(l=0;l<c.length;l++)n=c[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(b[n]=e[n])}return b}var o=b.a.createContext({}),i=function(e){var t=b.a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=i(e.components);return b.a.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return b.a.createElement(b.a.Fragment,{},t)}},j=b.a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,c=e.originalType,r=e.parentName,o=s(e,["components","mdxType","originalType","parentName"]),u=i(n),j=l,O=u["".concat(r,".").concat(j)]||u[j]||d[j]||c;return n?b.a.createElement(O,a(a({ref:t},o),{},{components:n})):b.a.createElement(O,a({ref:t},o))}));function O(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var c=n.length,r=new Array(c);r[0]=j;var a={};for(var s in t)hasOwnProperty.call(t,s)&&(a[s]=t[s]);a.originalType=e,a.mdxType="string"==typeof e?e:l,r[1]=a;for(var o=2;o<c;o++)r[o]=n[o];return b.a.createElement.apply(null,r)}return b.a.createElement.apply(null,n)}j.displayName="MDXCreateElement"}}]);